# アカウント管理機能要件

## 概要
ミニマムリリースに向けて、ユーザーが安心してサービスを利用できるよう、基本的なアカウント管理機能を実装する必要があります。

## 必要な機能一覧

### 1. パスワードリセット機能
**目的**: パスワードを忘れたユーザーが自分でパスワードを再設定できる

**実装要件**:
- ログイン画面に「パスワードを忘れた方はこちら」リンクを設置
- メールアドレス入力フォームを表示
- 登録済みメールアドレスにリセット用URLを送信
- リセット用URLの有効期限設定（24時間）
- 新しいパスワード設定フォーム
- パスワード強度チェック（8文字以上、英数字含む）
- リセット完了後、自動ログイン

**Supabase実装**:
```javascript
// パスワードリセット要求
const { error } = await supabase.auth.resetPasswordForEmail(email, {
  redirectTo: 'https://ooya.tech/reset-password',
});

// 新しいパスワード設定
const { error } = await supabase.auth.updateUser({
  password: newPassword
});
```

### 2. メールアドレス変更機能
**目的**: ユーザーが登録メールアドレスを変更できる

**実装要件**:
- マイページ内にメールアドレス変更セクションを設置
- 現在のパスワード入力による本人確認
- 新しいメールアドレス入力フォーム
- 新しいメールアドレスに確認メール送信
- メール内のリンクをクリックして変更完了
- 変更完了通知を旧メールアドレスにも送信

**Supabase実装**:
```javascript
// メールアドレス変更
const { error } = await supabase.auth.updateUser({
  email: newEmail
});
```

### 3. プロフィール・アカウント情報更新機能
**目的**: ユーザーが基本情報を更新できる

**実装要件**:
- 氏名（表示名）の変更
- プロフィール画像のアップロード
- 自己紹介文の編集
- 通知設定の変更
- 入力値の検証とサニタイゼーション

**実装項目**:
- 表示名：50文字以内
- 自己紹介：500文字以内
- プロフィール画像：5MB以内、jpg/png形式
- 通知設定：メール通知ON/OFF

### 4. アカウント削除・退会機能
**目的**: ユーザーが自分のアカウントを削除できる

**実装要件**:
- マイページ内に「アカウント削除」ボタンを設置
- 削除前の確認ダイアログ表示
- パスワード入力による本人確認
- 削除理由の選択（任意）
- 削除実行前の最終確認
- 削除完了通知メール送信
- 関連データの論理削除または物理削除

**データ削除ポリシー**:
- ユーザーアカウント：物理削除
- 作成したシミュレーション：論理削除（30日後に物理削除）
- 共有データ：匿名化処理
- 決済情報：法的保存期間に従って保持

### 5. 二段階認証（将来実装）
**目的**: セキュリティ強化

**実装要件**:
- SMS認証
- 認証アプリ（Google Authenticator等）
- バックアップコード生成
- 信頼できるデバイス設定

## UI/UX要件

### マイページ・アカウント設定画面
```
マイページ
├── プロフィール設定
│   ├── 表示名
│   ├── プロフィール画像
│   └── 自己紹介
├── アカウント設定
│   ├── メールアドレス変更
│   ├── パスワード変更
│   └── 通知設定
└── アカウント管理
    ├── ログイン履歴
    ├── データエクスポート
    └── アカウント削除
```

### エラーハンドリング
- 適切なエラーメッセージ表示
- ネットワークエラー時の再試行機能
- バリデーションエラーの詳細表示
- 成功時の分かりやすい通知

## セキュリティ要件

### 入力値検証
- メールアドレス形式チェック
- パスワード強度チェック
- XSS対策（HTMLエスケープ）
- SQLインジェクション対策

### 認証・認可
- 現在のパスワード確認
- セッション管理
- CSRF対策
- レート制限

### 監査ログ
- アカウント変更履歴の記録
- 重要な操作の記録
- 異常なアクセスの検知

## 実装優先度

### 高優先度（ミニマムリリース必須）
1. **パスワードリセット機能**
2. **メールアドレス変更機能**
3. **基本的なプロフィール更新**

### 中優先度（リリース後早期実装）
1. **アカウント削除機能**
2. **詳細な通知設定**
3. **ログイン履歴表示**

### 低優先度（将来実装）
1. **二段階認証**
2. **データエクスポート機能**
3. **アカウント復旧機能**

## テスト要件

### 機能テスト
- 正常系：各機能が正しく動作する
- 異常系：不正な入力に対する適切な処理
- 境界値テスト：文字数制限等の境界値

### セキュリティテスト
- 不正なリクエストに対する防御
- 認証回避の試行
- 入力値によるXSS・SQLインジェクション

### ユーザビリティテスト
- 操作の分かりやすさ
- エラーメッセージの適切性
- レスポンシブデザイン

---

**作成日**: 2025年07月07日
**最終更新日**: 2025年07月07日