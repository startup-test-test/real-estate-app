# 環境変数整理ドキュメント

作成日: 2025-08-15

## 1. 現状の環境変数構成

### 1.1 ファイル構成
```
/workspaces/real-estate-app/bolt_front/
├── .env.example     - テンプレートファイル（説明用）
├── .env.local       - ローカル開発環境用
└── .env.production  - 本番環境用
```

### 1.2 GitHub Secrets構成

#### Actions Secrets（CI/CD用）
| シークレット名 | 最終更新 | 用途 |
|--------------|---------|------|
| DEV_API_BASE_URL | 3週間前 | 開発環境API URL |
| DEV_STRIPE_WEBHOOK_SECRET | 3日前 | Stripe Webhook用 |
| DEV_SUPABASE_ANON_KEY | 3週間前 | Supabaseアノニマスキー |
| DEV_SUPABASE_URL | 3週間前 | Supabase URL |
| FTP_HOST | 3週間前 | FTPホスト |
| FTP_PASSWORD | 3週間前 | FTPパスワード |
| FTP_PORT | 3週間前 | FTPポート |
| FTP_USERNAME | 3週間前 | FTPユーザー名 |
| STRIPE_PRICE_ID | 3日前 | Stripe価格ID |
| STRIPE_SECRET_KEY | 3日前 | Stripeシークレットキー |
| STRIPE_WEBHOOK_SECRET_DEV | 3日前 | Stripe Webhook開発用 |
| SUPABASE_ACCESS_TOKEN | 3日前 | Supabaseアクセストークン |
| VITE_GOOGLE_CLIENT_ID | 3日前 | Google OAuth クライアントID |
| VITE_STRIPE_PUBLISHABLE_KEY | 3日前 | Stripe公開可能キー |

#### Codespaces Secrets（開発環境用）
| シークレット名 | 最終更新 | 用途 |
|--------------|---------|------|
| VITE_SUPABASE_ANON_KEY | 2ヶ月前 | Supabaseアノニマスキー |
| VITE_SUPABASE_URL | 2ヶ月前 | Supabase URL |

### 1.3 コード内で使用されている環境変数

| 環境変数名 | 使用箇所 | デフォルト値 | ステータス | 課題・対応方針 |
|-----------|---------|------------|-----------|---------------|
| VITE_SUPABASE_URL | `lib/supabase.ts` | なし | ✅正常 | 認証情報のためデフォルトなしで適切 |
| VITE_SUPABASE_ANON_KEY | `lib/supabase.ts` | なし | ✅正常 | 認証情報のためデフォルトなしで適切 |
| VITE_API_URL | `pages/Simulator.tsx` | `https://real-estate-app-rwf1.onrender.com` | ⚠️要修正 | **本番URLをデフォルト値にすべきでない**<br>→ `http://localhost:8000`に変更推奨 |
| VITE_STRIPE_PRICE_ID | `pages/PremiumPlan.tsx`<br>`components/UpgradeModal.tsx` | `price_1RvChRR8rkVVzR7nAeDvfiur` | ⚠️要修正 | **本番のStripe IDをハードコードすべきでない**<br>→ デフォルト値を削除し、環境変数必須に |
| VITE_GIT_BRANCH | `config/api.config.ts` | `develop` | 🔍要確認 | 使用目的が不明。削除可能か確認必要 |
| VITE_API_URL_PROD | `config/api.config.ts` | `https://your-prod-api.onrender.com` | ❌未使用 | プレースホルダーURLで実質未使用<br>→ 削除検討 |
| VITE_API_URL_DEV | `config/api.config.ts` | `https://your-dev-api.onrender.com` | ❌未使用 | プレースホルダーURLで実質未使用<br>→ 削除検討 |
| VITE_ENABLE_OAUTH | 複数箇所 | なし | ✅正常 | フラグとして適切に使用されている |
| VITE_GOOGLE_CLIENT_ID | OAuth関連 | なし | ✅正常 | 認証情報のためデフォルトなしで適切 |

## 2. 問題点

### 2.1 GitHub Actions内の不整合
**問題**: `deploy-to-xserver.yml`で参照している環境変数名が存在しない

```yaml
# 現在の設定（存在しないシークレット）
VITE_SUPABASE_URL=${{ secrets.PROD_SUPABASE_URL }}      # ❌ 存在しない
VITE_SUPABASE_ANON_KEY=${{ secrets.PROD_SUPABASE_ANON_KEY }}  # ❌ 存在しない
VITE_API_BASE_URL=${{ secrets.PROD_API_BASE_URL }}      # ❌ 存在しない

# 実際に存在するシークレット
DEV_SUPABASE_URL
DEV_SUPABASE_ANON_KEY
DEV_API_BASE_URL
```

### 2.2 環境変数の重複管理
- **Codespaces Secrets**: 開発環境で自動的に利用可能
- **GitHub Actions Secrets**: CI/CDで使用
- **ローカル.envファイル**: バックアップまたは上書き用

#### 重複設定の詳細
| ファイル/設定 | 内容 | ステータス | 対応方針 |
|-------------|------|-----------|---------|
| **Codespaces Secrets** | `VITE_SUPABASE_URL`<br>`VITE_SUPABASE_ANON_KEY` | ✅使用中 | 維持（メイン設定として使用） |
| **bolt_front/.env.local** | 同じ値が重複設定<br>`VITE_SUPABASE_URL`<br>`VITE_SUPABASE_ANON_KEY`<br>`VITE_ENABLE_OAUTH` | ⚠️重複 | **削除可能**<br>Codespaces Secretsが優先されるため不要 |
| **bolt_front/.env.production** | 本番環境用設定<br>（開発環境の値が入っている） | ⚠️不要 | **削除可能**<br>・GitHub Actionsで毎回生成される<br>・本番未リリースのため不要<br>・本番リリース時に新規作成 |
| **bolt_front/.env.example** | テンプレート | ✅必要 | 維持（ドキュメント用） |

### 2.3 命名規則の不統一
- Actions Secretsは`DEV_`プレフィックス付き
- Codespaces Secretsは`VITE_`プレフィックス付き
- 本番環境用の`PROD_`プレフィックス付きシークレットが存在しない

### 2.4 .env.localの不完全な設定
```bash
# 現在の.env.local
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...
VITE_ENABLE_OAUTH=true
# VITE_API_URLが設定されていない ❌
```

### 2.5 未使用の環境変数
- `VITE_API_URL_PROD` / `VITE_API_URL_DEV` - コード内で参照されているが定義されていない
- `VITE_GIT_BRANCH` - 定義されていない

## 3. 現在の動作

### 3.1 開発環境（Codespaces）
1. Codespaces Secretsから`VITE_SUPABASE_URL`と`VITE_SUPABASE_ANON_KEY`が自動的に読み込まれる
2. `.env.local`の設定は上書きされる（Codespaces Secretsが優先）
3. API URLはコード内のデフォルト値が使用される

### 3.2 本番環境（GitHub Actions）
1. デプロイ時にエラーが発生する可能性が高い（存在しないシークレットを参照）
2. `.env.production`ファイルが動的に生成されるはずだが、失敗する

## 4. 推奨される対応

### 4.1 短期的対応
1. **GitHub Actionsの修正**
   - 存在するシークレット名に変更する
   - または、`PROD_`プレフィックス付きのシークレットを追加する

2. **.env.localの完全化**
   ```bash
   VITE_API_URL=http://localhost:8000  # または適切なURL
   ```

### 4.2 中長期的対応
1. **環境変数の命名規則統一**
   - 開発環境: `DEV_VITE_*`
   - 本番環境: `PROD_VITE_*`
   - 共通: `VITE_*`

2. **環境変数の一元管理**
   - GitHub Secretsに統一
   - ローカル.envファイルは開発用テンプレートのみ

3. **ドキュメントの整備**
   - 環境変数設定ガイドの更新
   - 新規開発者向けのセットアップガイド

## 5. 本番リリース時の対応

### 本番環境構築時のTODO
1. **GitHub Secretsに本番用環境変数を追加**
   ```
   PROD_SUPABASE_URL=本番用SupabaseプロジェクトURL
   PROD_SUPABASE_ANON_KEY=本番用Supabaseキー
   PROD_API_BASE_URL=本番用API URL
   PROD_STRIPE_SECRET_KEY=本番用Stripeキー
   など
   ```

2. **本番用GitHub Actionsワークフローの確認**
   - `deploy-to-xserver.yml`のシークレット参照を修正
   - 現在の`PROD_*`参照が正しいことを確認

3. **本番用Supabaseプロジェクトの作成**
   - 新規プロジェクト作成
   - RLSポリシーの設定
   - データベース構造の移行

## 6. 環境変数フロー図

```
開発環境（Codespaces）
├── Codespaces Secrets（優先）
│   ├── VITE_SUPABASE_URL
│   └── VITE_SUPABASE_ANON_KEY
└── .env.local（バックアップ）

本番環境（GitHub Actions）
├── GitHub Actions Secrets
│   ├── DEV_* （現在設定済み）
│   └── PROD_* （未設定・必要）
└── 動的生成される.env.production

ローカル開発環境
└── .env.local（手動設定）
```

## 6. 次のアクション

### 6.0 最優先作業（すぐに実施）

#### Phase 0: ハードコーディングの修正（最初に実施）
**セキュリティリスクを除去してから.envファイル削除を行います**

##### 修正箇所（5分で完了）
```javascript
// 1. src/pages/Simulator.tsx (791行目)
// 変更前
const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://real-estate-app-rwf1.onrender.com';
// 変更後
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';

// 2. src/hooks/useApiCall.ts (42行目) - 確認して削除または修正
const API_BASE_URL = 'https://real-estate-app-1-iii4.onrender.com';
// → 使用されていない場合は削除
```

##### 修正後の確認
- [ ] コードにRender URLが残っていないか確認
- [ ] `npm run dev`で正常に起動するか確認

#### Phase 1: 不要な.envファイルの削除とテスト
**ハードコーディング修正後に実施して、現状の動作を確認します**

##### Step 1: 削除対象ファイルの確認
```bash
# 削除対象
bolt_front/.env.local      # Codespaces Secretsで代替
bolt_front/.env.production  # GitHub Actionsで生成
```

##### Step 2: バックアップ作成
```bash
# 念のためバックアップ
cp bolt_front/.env.local ~/env_local_backup.txt
cp bolt_front/.env.production ~/env_production_backup.txt
```

##### Step 3: ファイル削除
```bash
rm bolt_front/.env.local
rm bolt_front/.env.production
```

##### Step 4: 動作確認テスト
- [ ] Codespaces環境での確認
  - [ ] `npm run dev`で開発サーバー起動
  - [ ] Supabase接続確認（環境変数が読み込まれているか）
  - [ ] ログイン機能テスト
- [ ] GitHub Actionsの確認
  - [ ] developブランチにプッシュ
  - [ ] GitHub Actionsが正常に動作（.env.productionを生成）
  - [ ] dev.ooya.techで動作確認

##### Step 5: 結果確認
- **成功した場合** → 環境変数の整理作業を継続
- **失敗した場合** → バックアップから復元して原因調査

### 6.1 緊急対応（優先度：高）
- [ ] **不要な環境変数ファイルの削除**
  - [ ] `bolt_front/.env.local`を削除（Codespaces Secretsで代替）
  - [ ] `bolt_front/.env.production`を削除（GitHub Actionsで生成・本番未リリース）
- [ ] **コード内のデフォルト値修正**
  - [ ] `Simulator.tsx`: 本番URLのデフォルト値を`http://localhost:8000`に変更
  - [ ] `PremiumPlan.tsx`、`UpgradeModal.tsx`: Stripe IDのデフォルト値を削除
- [ ] **GitHub Actions修正**
  - [ ] 存在しないシークレット参照を修正（`PROD_*` → `DEV_*`）
  - [ ] または本番用シークレットを追加

### 6.2 短期対応（優先度：中）
- [ ] **未使用コードの削除**
  - [ ] `VITE_API_URL_PROD`、`VITE_API_URL_DEV`の参照削除
  - [ ] `VITE_GIT_BRANCH`の必要性確認

### 6.3 中長期対応（優先度：低）
- [ ] **環境変数の命名規則統一**
  - [ ] 開発: `DEV_VITE_*`
  - [ ] 本番: `PROD_VITE_*`
- [ ] **ドキュメント整備**
  - [ ] 環境変数設定ガイドの更新
  - [ ] 新規開発者向けセットアップガイド作成

## 7. セキュリティ上の注意事項

### ⚠️ 絶対にやってはいけないこと
1. **本番環境のURLやIDをデフォルト値にハードコード**
   - セキュリティリスク
   - 意図しない本番環境への接続
   
2. **秘密鍵やトークンをコードに記載**
   - GitHub等で公開されるリスク
   
3. **`.env`ファイルをGitにコミット**
   - `.env.local`、`.env.production`は`.gitignore`に追加必須

### ✅ 推奨されるデフォルト値の方針
| 環境変数の種類 | デフォルト値 | 例 |
|--------------|------------|---|
| 開発用URL | localhost | `http://localhost:8000` |
| 認証情報 | なし | エラーを発生させる |
| 本番URL | なし | 環境変数必須 |
| フィーチャーフラグ | false | 安全側に倒す |

## 8. 環境変数改善計画

### 8.1 未使用の環境変数削除

#### 削除対象
```javascript
// config/api.config.ts
- VITE_API_URL_PROD  // プレースホルダーのみで未使用
- VITE_API_URL_DEV   // プレースホルダーのみで未使用
- VITE_GIT_BRANCH    // 使用目的不明
```

### 8.2 DEV_プレフィックスへの統一

#### 現在の環境変数名 → 変更後
```
VITE_SUPABASE_URL         → DEV_VITE_SUPABASE_URL
VITE_SUPABASE_ANON_KEY    → DEV_VITE_SUPABASE_ANON_KEY
VITE_API_URL              → DEV_VITE_API_URL
VITE_STRIPE_PRICE_ID      → DEV_VITE_STRIPE_PRICE_ID
VITE_STRIPE_PUBLISHABLE_KEY → DEV_VITE_STRIPE_PUBLISHABLE_KEY
VITE_ENABLE_OAUTH         → DEV_VITE_ENABLE_OAUTH
VITE_GOOGLE_CLIENT_ID     → DEV_VITE_GOOGLE_CLIENT_ID
```

#### 変更が必要なファイル
1. **コード内の参照**
   - `bolt_front/src/lib/supabase.ts`
   - `bolt_front/src/pages/Simulator.tsx`
   - `bolt_front/src/pages/PremiumPlan.tsx`
   - `bolt_front/src/components/UpgradeModal.tsx`
   - `bolt_front/src/hooks/useSupabaseAuth.ts`
   - `bolt_front/src/config/api.config.ts`

2. **GitHub Actions**
   - `.github/workflows/deploy-to-xserver-dev.yml`
   - `.github/workflows/deploy-to-xserver.yml`

3. **GitHub Secrets名の変更**
   - Codespaces Secrets
   - Actions Secrets

### 8.3 リスク箇所の修正

#### 本番URLのハードコード削除
```javascript
// 現在（危険）
const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://real-estate-app-rwf1.onrender.com';

// 修正後（安全）
const API_BASE_URL = import.meta.env.DEV_VITE_API_URL || 'http://localhost:8000';
```

#### Stripe IDのハードコード削除
```javascript
// 現在（危険）
const priceId = import.meta.env.VITE_STRIPE_PRICE_ID || 'price_1RvChRR8rkVVzR7nAeDvfiur';

// 修正後（安全）
const priceId = import.meta.env.DEV_VITE_STRIPE_PRICE_ID;
if (!priceId) {
  console.error('Stripe Price ID is not configured');
}
```

### 8.4 実装手順

#### Phase 1: リスク対応（即座に実施）
- [ ] 本番URLのデフォルト値を削除
- [ ] Stripe IDのデフォルト値を削除
- [ ] エラーハンドリングを追加

#### Phase 2: 環境変数名の統一（計画的に実施）
- [ ] 新しい環境変数名でGitHub Secretsを追加
- [ ] コード内の参照を更新
- [ ] GitHub Actionsの参照を更新
- [ ] 動作確認後、古い環境変数を削除

#### Phase 3: 未使用コードの削除
- [ ] `VITE_API_URL_PROD`、`VITE_API_URL_DEV`の削除
- [ ] `VITE_GIT_BRANCH`の削除
- [ ] 関連するコードの整理

### 8.5 移行時の注意事項

#### 環境変数名変更時の段階的移行
```javascript
// 一時的に両方をサポート
const supabaseUrl = import.meta.env.DEV_VITE_SUPABASE_URL || 
                   import.meta.env.VITE_SUPABASE_URL;
```

#### GitHub Secretsの更新順序
1. 新しい名前でSecretを追加（既存はそのまま）
2. コードとActionsを更新
3. 動作確認
4. 古いSecretを削除

### 8.6 dev.ooya.techへの影響

現在のdev.ooya.techは：
- **GitHub Actionsでビルド時に環境変数が埋め込まれている**
- **実行時には環境変数を読み込まない（すでに値が固定）**

変更後も同じ仕組み：
1. developブランチへのプッシュ
2. GitHub Actionsが新しい環境変数名で`.env.production`を生成
3. ビルド時に新しい環境変数名が埋め込まれる
4. FTPでdev.ooya.techにデプロイ

## 9. 環境変数名変更時の影響範囲と修正箇所

### 9.1 Codespaces Secrets名変更時の修正箇所

#### VITE_SUPABASE_URL → DEV_SUPABASE_URL
| ファイル | 修正箇所 | 変更内容 |
|---------|---------|---------|
| `src/lib/supabase.ts` | 3行目 | `import.meta.env.VITE_SUPABASE_URL` → `import.meta.env.DEV_SUPABASE_URL` |
| `src/hooks/useSupabaseAuth.ts` | 74, 109, 154, 218行目 | `import.meta.env.VITE_SUPABASE_URL` → `import.meta.env.DEV_SUPABASE_URL` |

#### VITE_SUPABASE_ANON_KEY → DEV_SUPABASE_KEY_ANON
| ファイル | 修正箇所 | 変更内容 |
|---------|---------|---------|
| `src/lib/supabase.ts` | 4行目 | `import.meta.env.VITE_SUPABASE_ANON_KEY` → `import.meta.env.DEV_SUPABASE_KEY_ANON` |

### 9.2 GitHub Actions Secrets名変更時の修正箇所

#### 開発環境デプロイ（deploy-to-xserver-dev.yml）
| 現在のSecret名 | 新Secret名 | 修正行 |
|---------------|-----------|--------|
| `DEV_SUPABASE_URL` | `DEV_SUPABASE_URL` | 39行目 |
| `DEV_SUPABASE_ANON_KEY` | `DEV_SUPABASE_KEY_ANON` | 40行目 |
| `DEV_API_BASE_URL` | `DEV_API_URL_BACKEND` | 41行目 |

#### 本番環境デプロイ（deploy-to-xserver.yml）
| 現在のSecret名 | 新Secret名 | 修正行 |
|---------------|-----------|--------|
| `PROD_SUPABASE_URL` | `PROD_SUPABASE_URL` | 30行目 |
| `PROD_SUPABASE_ANON_KEY` | `PROD_SUPABASE_KEY_ANON` | 31行目 |
| `PROD_API_BASE_URL` | `PROD_API_URL_BACKEND` | 32行目 |

### 9.3 その他の環境変数修正箇所

#### API URL関連
| ファイル | 現在の変数名 | 新変数名 | 行番号 |
|---------|-------------|----------|--------|
| `src/pages/Simulator.tsx` | `VITE_API_URL` | `DEV_API_URL_BACKEND` | 791行目 |
| `src/config/api.config.ts` | `VITE_API_URL_PROD` | 削除対象 | 9行目 |
| `src/config/api.config.ts` | `VITE_API_URL_DEV` | 削除対象 | 12行目 |

#### Stripe関連
| ファイル | 現在の変数名 | 新変数名 | 行番号 |
|---------|-------------|----------|--------|
| `src/pages/PremiumPlan.tsx` | `VITE_STRIPE_PRICE_ID` | `DEV_STRIPE_ID_PRICE` | 324行目 |
| `src/components/UpgradeModal.tsx` | `VITE_STRIPE_PRICE_ID` | `DEV_STRIPE_ID_PRICE` | 54行目 |

### 9.4 Vite制約への対応

**重要：ViteではVITE_プレフィックスが必須**

GitHub Actionsで環境変数を変換する必要があります：

```yaml
# .github/workflows/deploy-to-xserver-dev.yml
- name: Create .env.production
  run: |
    # 新命名規則のSecretsをVITE_プレフィックス付きで出力
    echo "VITE_SUPABASE_URL=${{ secrets.DEV_SUPABASE_URL }}" > .env.production
    echo "VITE_SUPABASE_ANON_KEY=${{ secrets.DEV_SUPABASE_KEY_ANON }}" >> .env.production
    echo "VITE_API_URL=${{ secrets.DEV_API_URL_BACKEND }}" >> .env.production
```

コード内では：
```javascript
// VITE_プレフィックスで読み込む（Viteの制約）
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
```

### 9.5 段階的移行のための一時的対応

移行期間中は両方の名前をサポート：

```javascript
// src/lib/supabase.ts
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || 
                   import.meta.env.DEV_SUPABASE_URL;

const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || 
                        import.meta.env.DEV_SUPABASE_KEY_ANON;
```

## 10. サービスごとの移行作業手順

### 10.1 作業の基本方針
**サービスごとに「削除」→「名称変更」→「ファイル修正」を完結させる**

メリット：
- 一つのサービスが壊れても他は動作継続
- 影響範囲が明確
- ロールバックが容易

### 10.2 Supabase関連の移行（優先度：高）

#### Step 1: 事前準備
```bash
# 現在の値をバックアップ
echo "SUPABASE_URL: $VITE_SUPABASE_URL" > ~/supabase_backup.txt
echo "SUPABASE_KEY: $VITE_SUPABASE_ANON_KEY" >> ~/supabase_backup.txt
```

#### Step 2: Secrets名変更
| 場所 | 現在 | 新規作成 |
|------|------|---------|
| Codespaces Secrets | `VITE_SUPABASE_URL` | `DEV_SUPABASE_URL` |
| Codespaces Secrets | `VITE_SUPABASE_ANON_KEY` | `DEV_SUPABASE_KEY_ANON` |
| Actions Secrets | `DEV_SUPABASE_URL` | そのまま維持 |
| Actions Secrets | `DEV_SUPABASE_ANON_KEY` | `DEV_SUPABASE_KEY_ANON` |

#### Step 3: GitHub Actions修正
```yaml
# .github/workflows/deploy-to-xserver-dev.yml（39-40行目）
echo "VITE_SUPABASE_URL=${{ secrets.DEV_SUPABASE_URL }}" > .env.production
echo "VITE_SUPABASE_ANON_KEY=${{ secrets.DEV_SUPABASE_KEY_ANON }}" >> .env.production
```

#### Step 4: コード修正（Vite制約対応）
```javascript
// src/lib/supabase.ts（3-4行目）
// 注意：Codespaces用とGitHub Actions用で異なる
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL // Viteの制約でVITE_必須
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY
```

#### Step 5: Codespaces環境変数マッピング
```bash
# .devcontainer/devcontainer.json または起動スクリプト
export VITE_SUPABASE_URL=$DEV_SUPABASE_URL
export VITE_SUPABASE_ANON_KEY=$DEV_SUPABASE_KEY_ANON
```

#### Step 6: 動作確認
- [ ] `npm run dev`で開発サーバー起動
- [ ] Supabase接続確認（ログイン機能）
- [ ] developブランチにプッシュしてdev.ooya.tech確認

#### Step 7: 古いSecrets削除
- [ ] 動作確認後、古いCodespaces Secretsを削除

### 10.3 API関連の移行（優先度：中）

#### Step 1: 未使用の環境変数削除
```javascript
// src/config/api.config.ts から削除
- VITE_API_URL_PROD（9行目）
- VITE_API_URL_DEV（12行目）
- VITE_GIT_BRANCH（5行目）
```

#### Step 2: デフォルト値の修正
```javascript
// src/pages/Simulator.tsx（791行目）
// 変更前（危険）
const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://real-estate-app-rwf1.onrender.com';

// 変更後（安全）
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';
```

#### Step 3: Secrets名変更
| 場所 | 現在 | 新規 |
|------|------|------|
| Actions Secrets | `DEV_API_BASE_URL` | `DEV_API_URL_BACKEND` |

#### Step 4: GitHub Actions修正
```yaml
# .github/workflows/deploy-to-xserver-dev.yml（41行目）
echo "VITE_API_URL=${{ secrets.DEV_API_URL_BACKEND }}" >> .env.production
```

#### Step 5: 動作確認
- [ ] APIエンドポイント接続確認
- [ ] シミュレーター機能テスト

### 10.4 Stripe関連の移行（優先度：低）

#### Step 1: デフォルト値削除
```javascript
// src/pages/PremiumPlan.tsx（324行目）
// 変更前（危険）
const priceId = import.meta.env.VITE_STRIPE_PRICE_ID || 'price_1RvChRR8rkVVzR7nAeDvfiur';

// 変更後（安全）
const priceId = import.meta.env.VITE_STRIPE_PRICE_ID;
if (!priceId) {
  console.error('Stripe Price ID is not configured');
  return;
}

// src/components/UpgradeModal.tsx（54行目）も同様に修正
```

#### Step 2: Secrets名変更（将来）
| 場所 | 現在 | 新規 |
|------|------|------|
| Codespaces Secrets | 未設定 | `DEV_STRIPE_KEY_PUBLIC` |
| Codespaces Secrets | 未設定 | `DEV_STRIPE_ID_PRICE` |
| Actions Secrets | `VITE_STRIPE_PUBLISHABLE_KEY` | `DEV_STRIPE_KEY_PUBLIC` |
| Actions Secrets | `STRIPE_PRICE_ID` | `DEV_STRIPE_ID_PRICE` |

### 10.5 FTP関連の移行（優先度：低）

#### Actions Secretsのみ名称変更
| 現在 | 新規 |
|------|------|
| `FTP_HOST` | `DEV_FTP_HOST` |
| `FTP_USERNAME` | `DEV_FTP_USERNAME` |
| `FTP_PASSWORD` | `DEV_FTP_PASSWORD` |
| `FTP_PORT` | `DEV_FTP_PORT` |

#### GitHub Actions修正
```yaml
# .github/workflows/deploy-to-xserver-dev.yml（68-71行目）
server: ${{ secrets.DEV_FTP_HOST }}
username: ${{ secrets.DEV_FTP_USERNAME }}
password: ${{ secrets.DEV_FTP_PASSWORD }}
port: ${{ secrets.DEV_FTP_PORT }}
```

### 10.6 作業完了チェックリスト

#### Supabase関連 ✅
- [ ] Codespaces Secrets新規作成
- [ ] Actions Secrets新規作成
- [ ] GitHub Actions修正
- [ ] コード修正
- [ ] 動作確認
- [ ] 古いSecrets削除

#### API関連 ⚙️
- [ ] 未使用コード削除
- [ ] デフォルト値修正
- [ ] Actions Secrets新規作成
- [ ] GitHub Actions修正
- [ ] 動作確認
- [ ] 古いSecrets削除

#### Stripe関連 📅
- [ ] デフォルト値削除
- [ ] エラーハンドリング追加
- [ ] Secrets新規作成（将来）
- [ ] 動作確認

#### FTP関連 📦
- [ ] Actions Secrets新規作成
- [ ] GitHub Actions修正
- [ ] デプロイ動作確認
- [ ] 古いSecrets削除

## 11. 環境変数命名規則ガイドライン

### 11.1 基本ルール

#### 命名パターン
```
[環境]_[サービス]_[用途]_[詳細]
```

#### 各要素の説明
- **環境**: DEV（開発）/ PROD（本番）/ TEST（テスト）
- **サービス**: SUPABASE / STRIPE / FTP / API / GOOGLE など
- **用途**: URL / KEY / SECRET / TOKEN / ID など
- **詳細**: PUBLIC / PRIVATE / ANON / WEBHOOK など（必要に応じて）

### 11.2 命名規則一覧

#### Supabase関連
| 現在の名前 | 新しい名前 | 説明 | 使用場所 |
|-----------|-----------|------|---------|
| `VITE_SUPABASE_URL` | `DEV_SUPABASE_URL` | Supabaseプロジェクトのエンドポイント | Codespaces/Actions |
| `VITE_SUPABASE_ANON_KEY` | `DEV_SUPABASE_KEY_ANON` | Supabase公開用アノニマスキー | Codespaces/Actions |
| `SUPABASE_SERVICE_ROLE_KEY` | `DEV_SUPABASE_KEY_SERVICE` | Supabase管理者キー（秘密） | Actions のみ |
| `SUPABASE_ACCESS_TOKEN` | `DEV_SUPABASE_TOKEN_ACCESS` | Supabase CLIアクセストークン | Actions のみ |

#### Stripe関連
| 現在の名前 | 新しい名前 | 説明 | 使用場所 |
|-----------|-----------|------|---------|
| `VITE_STRIPE_PUBLISHABLE_KEY` | `DEV_STRIPE_KEY_PUBLIC` | Stripe公開可能キー | Codespaces/Actions |
| `STRIPE_SECRET_KEY` | `DEV_STRIPE_KEY_SECRET` | Stripe秘密キー | Actions のみ |
| `VITE_STRIPE_PRICE_ID` | `DEV_STRIPE_ID_PRICE` | Stripe料金プランID | Codespaces/Actions |
| `STRIPE_WEBHOOK_SECRET_DEV` | `DEV_STRIPE_SECRET_WEBHOOK` | Stripe Webhookシークレット | Actions のみ |

#### API関連
| 現在の名前 | 新しい名前 | 説明 | 使用場所 |
|-----------|-----------|------|---------|
| `VITE_API_URL` | `DEV_API_URL_BACKEND` | バックエンドAPIのURL | Codespaces/Actions |
| `DEV_API_BASE_URL` | `DEV_API_URL_BASE` | APIベースURL | Actions |

#### FTP関連（デプロイ用）
| 現在の名前 | 新しい名前 | 説明 | 使用場所 |
|-----------|-----------|------|---------|
| `FTP_HOST` | `DEV_FTP_HOST` | FTPサーバーホスト | Actions のみ |
| `FTP_USERNAME` | `DEV_FTP_USERNAME` | FTPユーザー名 | Actions のみ |
| `FTP_PASSWORD` | `DEV_FTP_PASSWORD` | FTPパスワード | Actions のみ |
| `FTP_PORT` | `DEV_FTP_PORT` | FTPポート番号 | Actions のみ |

#### OAuth関連
| 現在の名前 | 新しい名前 | 説明 | 使用場所 |
|-----------|-----------|------|---------|
| `VITE_GOOGLE_CLIENT_ID` | `DEV_GOOGLE_ID_CLIENT` | Google OAuth クライアントID | Codespaces/Actions |
| `VITE_ENABLE_OAUTH` | `DEV_FEATURE_OAUTH` | OAuth機能の有効/無効フラグ | Codespaces/Actions |

### 11.3 命名規則の利点

#### 一目で分かる構造
```
DEV_SUPABASE_KEY_ANON
↑    ↑        ↑    ↑
環境  サービス  種類  詳細
```

#### セキュリティレベルが明確
- `KEY_PUBLIC` = 公開可能
- `KEY_SECRET` = 絶対秘密
- `KEY_ANON` = 匿名アクセス用
- `KEY_SERVICE` = サービス管理者用

#### 環境の混同を防ぐ
- `DEV_` = 開発環境
- `TEST_` = テスト環境  
- `PROD_` = 本番環境

### 11.4 良い例と悪い例

#### 良い例 ✅
```
DEV_SUPABASE_URL          # 開発環境のSupabaseのURL
DEV_STRIPE_KEY_PUBLIC     # 開発環境のStripe公開キー
PROD_FTP_PASSWORD         # 本番環境のFTPパスワード
```

#### 悪い例 ❌
```
SUPABASE_URL             # どの環境か不明
API_KEY                  # サービスも用途も不明
VITE_PROD_KEY            # 環境とサービスが不明確
KEY_123456               # 意味不明
```