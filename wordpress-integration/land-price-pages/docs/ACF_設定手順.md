# Advanced Custom Fields (ACF) 設定手順

## 📋 目的

「地価情報」投稿タイプに、地価データとメタデータを保存するためのカスタムフィールドを追加します。

---

## 前提条件

✅ Custom Post Type UIで「地価情報（chika）」投稿タイプを作成済み

---

## ステップ2: ACFでカスタムフィールドを作成

### 2-1. ACFのメニューを開く

WordPress管理画面の左メニューから：
```
ACF → フィールドグループ → 新規追加
```

---

### 2-2. フィールドグループ名を設定

一番上の入力欄に：
```
地価情報データ（基本+メタデータ）
```

---

### 2-3. フィールドを追加する

「＋ フィールドを追加」ボタンを押して、以下のフィールドを1つずつ作成します。

---

## 📊 基本データフィールド（3つ）

### フィールド1: 平均地価

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `平均地価` |
| **フィールド名** | `heikin_chika` |
| **フィールドタイプ** | `数値` |
| **プレースホルダー** | `例: 253000` |
| **接尾辞** | `円/㎡` |
| **必須** | ✅ チェック |

---

### フィールド2: 坪単価

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `坪単価` |
| **フィールド名** | `tsubo_tanka` |
| **フィールドタイプ** | `数値` |
| **プレースホルダー** | `例: 836000` |
| **接尾辞** | `円/坪` |
| **必須** | ✅ チェック |

---

### フィールド3: 変動率

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `変動率` |
| **フィールド名** | `hendo_ritsu` |
| **フィールドタイプ** | `数値` |
| **プレースホルダー** | `例: 2.5 または -1.2` |
| **接尾辞** | `%` |
| **小数点以下桁数** | `1` |
| **必須** | ✅ チェック |

---

## 📋 メタデータフィールド（4つ）

### フィールド4: データソース

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `データソース` |
| **フィールド名** | `data_source` |
| **フィールドタイプ** | `テキスト` |
| **デフォルト値** | `国土交通省 不動産情報ライブラリAPI` |
| **プレースホルダー** | `データの取得元` |
| **必須** | ✅ チェック |

---

### フィールド5: 最終更新日時

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `最終更新日時` |
| **フィールド名** | `updated_at` |
| **フィールドタイプ** | `テキスト` |
| **プレースホルダー** | `例: 2025-10-16 06:30:05` |
| **必須** | ✅ チェック |

**備考**: 日付選択フィールドではなくテキストにする理由は、Pythonから自動入力するため。

---

### フィールド6: データ件数

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `データ件数` |
| **フィールド名** | `data_count` |
| **フィールドタイプ** | `数値` |
| **プレースホルダー** | `例: 927` |
| **接尾辞** | `件` |
| **必須** | ✅ チェック |

---

### フィールド7: API URL

| 項目 | 入力値 |
|------|--------|
| **フィールドラベル** | `API URL` |
| **フィールド名** | `api_endpoint` |
| **フィールドタイプ** | `URL` |
| **プレースホルダー** | `https://www.reinfolib.mlit.go.jp/...` |
| **必須** | ⬜ オプション |

---

### 2-4. 表示ルールを設定

ページの下部にスクロールして「設定」セクションを見つけます。

**重要**: このフィールドグループをどこに表示するか設定します。

| 項目 | 設定値 |
|------|--------|
| **ルール** | `投稿タイプ` `等しい` `地価情報` |

これで、「地価情報」投稿の編集画面にだけこれらのフィールドが表示されます。

---

### 2-5. 保存

「変更を保存」ボタンをクリック。

**成功メッセージ**:
```
✅ フィールドグループが正常に更新されました。
```

---

## ✅ 確認方法

### 地価情報の編集画面を確認

1. 左メニュー「地価情報」→「新規追加」をクリック
2. タイトル入力欄の下に以下が表示されているか確認：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
地価情報データ（基本+メタデータ）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

基本データ
┌─────────────────────────────┐
│ 平均地価            [    ] 円/㎡ │
│ 坪単価              [    ] 円/坪 │
│ 変動率              [    ] %     │
└─────────────────────────────┘

メタデータ
┌─────────────────────────────┐
│ データソース        [国土交通省 不動産情報ライブラリAPI] │
│ 最終更新日時        [    ]       │
│ データ件数          [    ] 件    │
│ API URL             [    ]       │
└─────────────────────────────┘
```

---

### テスト入力

試しに以下のデータを入力してみます：

| フィールド | 値 |
|-----------|-----|
| タイトル | `テスト：札幌市` |
| 平均地価 | `253000` |
| 坪単価 | `836000` |
| 変動率 | `2.5` |
| データソース | `国土交通省 不動産情報ライブラリAPI` |
| 最終更新日時 | `2025-10-16 06:30:05` |
| データ件数 | `927` |
| API URL | `https://www.reinfolib.mlit.go.jp/ex-api/external/XIT001` |

「公開」ボタンをクリックして保存。

**確認完了！** 次のステップ（テンプレートファイル作成）に進みます。

---

## 🔄 次のステップ

- ⬜ テンプレートファイル（single-chika.php）を作成
  - これらのカスタムフィールドのデータを表示するデザインを作成

---

## 📊 データの流れ

```
┌─────────────────────────────┐
│ Python スクリプト            │
│ generate_csv_with_metadata.py│
└──────────┬──────────────────┘
           ↓
┌─────────────────────────────┐
│ CSV ファイル                 │
│ cities_with_metadata.csv     │
│ - city_name                  │
│ - heikin_chika               │
│ - tsubo_tanka                │
│ - hendo_ritsu                │
│ - data_source                │
│ - updated_at                 │
│ - data_count                 │
│ - api_endpoint               │
└──────────┬──────────────────┘
           ↓
┌─────────────────────────────┐
│ WP All Import                │
│ CSVをWordPressにインポート    │
└──────────┬──────────────────┘
           ↓
┌─────────────────────────────┐
│ WordPress「地価情報」投稿     │
│ 1,900件の市区町村データ       │
│ + メタデータ                 │
└──────────┬──────────────────┘
           ↓
┌─────────────────────────────┐
│ single-chika.php テンプレート│
│ ユーザーに表示               │
└─────────────────────────────┘
```

---

**作成日**: 2025年10月16日
**作成者**: Claude Code
