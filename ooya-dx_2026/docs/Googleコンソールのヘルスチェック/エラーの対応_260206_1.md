# Google Search Console エラー対応

> 作成日: 2026-02-06

---

## Googleコンソールのエラー内容1. 重複しています（ユーザーにより、正規ページとして選択されていません）

### エラー概要

- **該当件数:** 1件
- **該当URL例:** `https://ooya.tech/company`
- **Googleの判定:** `www.ooya.tech` と `ooya.tech` を別サイトとして認識し、重複と判定

### 原因

`www.ooya.tech` と `ooya.tech` の両方でアクセス可能だったため、Googleが「同じ内容のページが2つある」と判定。

### 解決方法

`www.ooya.tech` へのアクセスを `ooya.tech` に301リダイレクトする。

### 実装内容

**対象ファイル:** `middleware.ts`

```typescript
const host = req.headers.get('host') || '';

// www → non-www リダイレクト（SEO正規化）
if (host.startsWith('www.')) {
  const newHost = host.replace('www.', '');
  const url = new URL(req.url);
  url.host = newHost;
  return NextResponse.redirect(url, 301);
}
```

### 確認方法

```bash
curl -I https://www.ooya.tech
# 期待値: HTTP/2 301, location: https://ooya.tech/
```

### 対応状況

✅ 修正済み（2026-02-06）

---

## Googleコンソールのエラー内容2. ソフト 404

### エラー概要

- **該当件数:** 16件
- **該当URL例:** `https://ooya.tech/media/self-management/report`
- **Googleの判定:** HTTPステータスは200だが、内容が「見つかりません」のためエラー

### 原因

存在しない記事URLにアクセスした際、サーバーが「200 OK（正常）」を返しながら、画面には「記事が見つかりません」と表示していた。

**問題のイメージ:**
```
お客さん：「Aという記事を見せて」
サーバー：「はい、どうぞ！（200 OK）」
         → でも画面は「記事が見つかりません」

Google：「200って言ってるのに中身がない...おかしいな（ソフト404）」
```

### 解決方法

存在しない記事URLに対して、正規の「404 Not Found」を返すようにする。

### 実装内容

**対象ファイル:** `app/media/[category]/[slug]/page.tsx`

```typescript
// generateStaticParamsに含まれないパスは自動的に404を返す
export const dynamicParams = false;

export async function generateStaticParams() {
  const paths = getAllArticlePaths();
  return paths.map((path) => ({
    category: path.categorySlug,
    slug: path.slug,
  }));
}
```

**設定の意味:**

| 設定値 | 動作 |
|-------|-----|
| `dynamicParams = true`（デフォルト） | 存在しないURLでもページ生成を試みる → 200 |
| `dynamicParams = false` | 存在しないURLは自動的に404を返す |

### 新規記事追加への影響

**影響なし。** 通常通りMDXファイルを追加してデプロイすれば公開される。

### 確認方法

```bash
curl -s -o /dev/null -w "%{http_code}" https://ooya.tech/media/test/test
# 期待値: 404
```

### 対応状況

✅ 修正済み（2026-02-06）

---

## Googleコンソールのエラー内容3. 検出 - インデックス未登録

### エラー概要

- **該当件数:** 55件
- **該当URL例:** `/company/*`, `/tools/*`, `/contact` など
- **Googleの判定:** URLは発見したが、まだクロールしていない

### 原因

Googleがサイトマップ等でURLを発見したが、まだ実際のページ読み込み（クロール）を行っていない状態。

### 該当URLの分類（2026-02-06確認）

| カテゴリ | URL例 | 件数 | 状態 | 対応 |
|---------|-------|:----:|------|------|
| 会社情報 | `/company`, `/company/service` 等 | 11件 | 現存 | ⏳ クロール待ち |
| ツール | `/tools`, `/tools/roi` 等 | 15件 | 現存 | ⏳ クロール待ち |
| その他ページ | `/contact`, `/faq`, `/pricing`, `/simulator` | 4件 | 現存 | ⏳ クロール待ち |
| 法的ページ | `/legal/privacy`, `/legal/terms` | 2件 | 現存 | ⏳ クロール待ち |
| メディア | `/media/base`, `/media/kodate`, `/media/profile`, `/media/base/estimate-simulation` | 4件 | 現存 | ⏳ クロール待ち |
| **用語集** | `/glossary`, `/glossary/*` | **18件** | **リダイレクト済み** | ✅ 放置でOK |

### 用語集ページについて

用語集（`/glossary/*`）は2026-02-05に廃止済み。関連ツールへ301リダイレクト設定済み。

```bash
curl -sIL https://ooya.tech/glossary | grep -E "HTTP|location"
# 結果: 308 → /tools
```

Googleが再クロールすればリダイレクト先がインデックスされる。

### 解決方法

**現存ページ（37件）:**
1. Google Search Console で「インデックス登録をリクエスト」を送信
2. または、自然にクロールされるのを待つ（数日〜数週間）

**用語集ページ（18件）:**
- 放置でOK（リダイレクト設定済み）

### 対応状況

⏳ Google再クロール待ち（用語集は放置でOK）

---

## Googleコンソールのエラー内容4. 見つかりませんでした（404）

### エラー概要

- **該当件数:** 27件
- **該当URL例:** `/tokushoho`, `/glossary/*`, `/base/*` など
- **Googleの判定:** ページが存在しない（正常な404）

### 原因

削除済みのページ、または旧URL構造のページ。

### 解決方法

**対応不要（放置でOK）**

Googleが数回クロール後、自動的にインデックスから除外する。

### 該当ページ一覧

| URL | 理由 |
|-----|------|
| `/tokushoho` | 特商法ページ（弁護士確認で不要） |
| `/glossary/*` | 用語集（廃止済み、301リダイレクト設定済み） |
| `/base/*` | 旧URL構造 |
| `/category/*` | 旧カテゴリ構造 |
| `/media/genjyo/*` | 削除済み記事 |
| `/media/akiya/*` | 削除済み記事 |

### 対応状況

✅ 放置でOK（自動除外される）

---

## Googleコンソールのエラー内容5. 代替ページ（適切な canonical タグあり）

### エラー概要

- **該当件数:** 1件
- **該当URL:** `https://ooya.tech/media/category/base/?sort=date_desc`
- **Googleの判定:** canonicalタグが正しく設定されている

### 原因

クエリパラメータ付きURL（`?sort=date_desc`）が、canonicalタグで正規URL（`/media/category/base/`）を指している。

### 解決方法

**対応不要（正常な動作）**

これはエラーではなく、canonicalタグが正しく機能している証拠。

### 動作イメージ

```
/media/category/base/?sort=date_desc  ← このURL
  ↓ canonicalタグで指定
/media/category/base/  ← こちらがインデックスされる（正しい）
```

### 対応状況

✅ 正常（対応不要）

---

## Googleコンソールのエラー内容6. noindex タグによって除外されました

### エラー概要

- **該当件数:** 58件
- **該当URL例:** `/media/*/feed/`, `/media/author/tetzlow/`, `/media/category/base/page/*` など
- **Googleの判定:** noindexタグが設定されているため、インデックスしない

### 原因

これらのURLには `<meta name="robots" content="noindex">` タグが設定されており、意図的にGoogleのインデックスから除外されている。

### 該当URLの分類

| パターン | 例 | 理由 |
|---------|-----|------|
| RSSフィード | `/media/base/failure-2ch/feed/` | RSSフィードはインデックス不要 |
| 著者ページ | `/media/author/tetzlow/` | 著者アーカイブはインデックス不要 |
| ページネーション | `/media/category/base/page/2/` | ページネーションは正規ページのみインデックス |
| クエリ付きページ | `/media/category/base/?sort=views` | ソート・フィルター付きは除外 |
| 削除済み記事 | `/media/genjyo/basicenglish/` | 削除済みでnoindex設定 |

### 解決方法

**対応不要（正常な動作）**

これらはSEOのベストプラクティスに従い、意図的にnoindexを設定しているページ。

### noindexが設定されている理由

1. **RSSフィード (`/feed/`):** XMLコンテンツであり、検索結果に表示する必要がない
2. **著者ページ:** 薄いコンテンツになりやすく、メインコンテンツに集中させるため
3. **ページネーション:** 重複コンテンツを防ぎ、1ページ目のみをインデックス
4. **ソート・フィルター付きURL:** 同じコンテンツの重複を防止

### コードベースで noindex を設定しているページ

| ページ | ファイル | noindex設定 | 理由 |
|-------|---------|:-----------:|------|
| `/tools/components` | `app/tools/components/page.tsx` | ✅ あり | 開発用コンポーネント一覧 |
| `/tools/template-demo` | `app/tools/template-demo/page.tsx` | ✅ あり | テンプレートデモページ |

### 重要ページの noindex 確認（2026-02-06確認）

| ページ | noindex | 状態 |
|-------|:-------:|:----:|
| トップページ `/` | なし | ✅ 正常 |
| ツール一覧 `/tools` | なし | ✅ 正常 |
| 各計算ツール `/tools/*` | なし | ✅ 正常 |
| メディア記事 `/media/*` | なし | ✅ 正常 |
| 会社概要 `/company` | なし | ✅ 正常 |
| お問い合わせ `/contact` | なし | ✅ 正常 |
| FAQ `/faq` | なし | ✅ 正常 |
| 料金 `/pricing` | なし | ✅ 正常 |

**結論:** noindex が設定されているのは開発用ページのみ。重要なページは全て正常。

### 対応状況

✅ 正常（対応不要）

---

## Googleコンソールのエラー内容7. ページにリダイレクトがあります

### エラー概要

- **該当件数:** 40件
- **該当URL例:** `/company/`（末尾スラッシュ付き）, `?sort=views` 付きURL など
- **Googleの判定:** このURLは別のURLにリダイレクトされる

### 原因

以下のパターンのURLが、正規URLにリダイレクトされている。

### 該当URLの分類

| パターン | 例 | リダイレクト先 | 理由 |
|---------|-----|--------------|------|
| 末尾スラッシュ付き | `/company/` | `/company` | Next.js の標準動作 |
| クエリパラメータ付き | `?sort=views` | パラメータなしURL | ソート・フィルター |
| アフィリエイトパラメータ | `?a8=...` | パラメータなしURL | トラッキング用 |
| 旧URL構造 | `/kodate/sagashikata-2/` | 404 または新URL | 削除・移動済み |
| 削除済み記事 | `/media/genjyo/*` | 404 | 削除済み |

### 解決方法

**対応不要（正常な動作）**

これらはリダイレクトが正しく機能している証拠。

### リダイレクトの種類

| コード | 意味 | 使用場面 |
|:------:|------|---------|
| 301 | 恒久的な移転 | URL変更、www統一 |
| 308 | 恒久的リダイレクト（メソッド維持） | 末尾スラッシュ正規化 |
| 302 | 一時的な移転 | メンテナンス時など |

### 末尾スラッシュの動作確認

```bash
curl -sI https://ooya.tech/company/ | grep -E "HTTP|location"
# 期待値: HTTP/2 308, location: /company
```

### 対応状況

✅ 正常（対応不要）

---

## Googleコンソールのエラー内容8. リダイレクト エラー

### エラー概要

- **該当件数:** 1件
- **該当URL:** `https://ooya.tech/tools/brokerage`
- **Googleの判定:** リダイレクトに問題がある
- **最終クロール:** 2026/01/14

### 原因

過去にリダイレクト設定に問題があった可能性。

### 現在の状態確認（2026-02-06）

```bash
curl -sIL https://ooya.tech/tools/brokerage | grep -E "HTTP|location"
# 結果: HTTP/2 200
```

**→ 現在は正常に動作（200 OK）**

### Google Search Console での確認結果（2026-02-06）

URL検査で確認した結果：

| 項目 | 状態 |
|-----|------|
| URL登録 | ✅ URL は Google に登録されています |
| インデックス | ✅ ページはインデックスに登録済み |
| HTTPS | ✅ HTTPS で配信されています |
| パンくずリスト | ✅ 1件の有効なアイテムを検出 |
| よくある質問（FAQ） | ✅ 1件の有効なアイテムを検出 |

**結論:** 既に正常にインデックス登録されている。

### 対応状況

✅ 解消済み（インデックス登録完了）

---

## 対応状況サマリー

| No. | エラー内容 | 件数 | 対応状況 |
|:---:|-----------|:----:|---------|
| 1 | 重複しています | 1件 | ✅ 修正済み |
| 2 | ソフト 404 | 16件 | ✅ 修正済み |
| 3 | 検出 - インデックス未登録 | 55件 | ⏳ 待機中 |
| 4 | 見つかりませんでした（404） | 27件 | ✅ 放置でOK |
| 5 | 代替ページ（canonical タグあり） | 1件 | ✅ 正常 |
| 6 | noindex タグによって除外 | 58件 | ✅ 正常 |
| 7 | ページにリダイレクトがあります | 40件 | ✅ 正常 |
| 8 | リダイレクト エラー | 1件 | ✅ 修正済み |
| 9 | クロール済み - インデックス未登録 | 175件 | ✅ 放置でOK |

---

## Googleコンソールのエラー内容9. クロール済み - インデックス未登録

### エラー概要

- **該当件数:** 175件
- **該当URL例:** `/media/genjyo/*`, `/media/tag/*`, `/media/kubun/*` など
- **Googleの判定:** クロールしたが、インデックスする価値がないと判断

### 「検出 - インデックス未登録」との違い

| ステータス | 意味 | 深刻度 |
|-----------|------|:------:|
| 検出 - インデックス未登録 | 発見したがまだクロールしていない | 低（待てば解消） |
| クロール済み - インデックス未登録 | クロールしたが価値なしと判断 | 中〜高（要確認） |

### 該当URLの分類

| パターン | 件数目安 | 状態 | 対応 |
|---------|:-------:|------|------|
| 削除済み記事 `/media/genjyo/*` | 多数 | 削除済み | ✅ 放置でOK |
| 削除済み記事 `/media/akiya/*` | 多数 | 削除済み | ✅ 放置でOK |
| 削除済み記事 `/media/kubun/*` | 多数 | 削除済み | ✅ 放置でOK |
| 削除済み記事 `/media/base/*`（リスト内） | 多数 | 削除済み | ✅ 放置でOK |
| 削除済み記事 `/media/kodate/*`（リスト内） | 数件 | 削除済み | ✅ 放置でOK |
| タグページ `/media/tag/*` | 数件 | 薄いコンテンツ | ✅ 放置でOK |
| カテゴリ+クエリ `?sort=date_desc` | 数件 | 重複扱い | ✅ 放置でOK |
| 日付アーカイブ `/2025/04/` | 数件 | 薄いコンテンツ | ✅ 放置でOK |
| RSSフィード `/feed/` | 数件 | インデックス不要 | ✅ 放置でOK |

### 現存記事との照合結果（2026-02-06確認）

**現存する記事一覧（content/media/）:**

| カテゴリ | 現存する記事 |
|---------|-------------|
| base | accounting-software, bad-2ch, end-user-real-estate, estimate-simulation, excel-template, failure-2ch, neteitou_yabai, profile-sheet-template, rent-roll-template, spreadsheet |
| kodate | kouko, reform, zikoshikin |

**照合結果:** Search Console リスト内の `/media/base/*`、`/media/kodate/*` URL は**全て削除済み記事**であり、現存する記事は含まれていない。

### 解決方法

**対応不要（全て放置でOK）**

175件全てが以下のいずれかに該当：
- 削除済み記事
- タグ・カテゴリページ（インデックス不要）
- RSSフィード（インデックス不要）
- 日付アーカイブ（インデックス不要）

Googleが再クロールを繰り返すうちに、自動的にリストから除外される。

### 対応状況

✅ 放置でOK（コンテンツ改善が必要な現存記事はなし）

---

## 関連ファイル

| ファイル | 役割 |
|---------|------|
| `middleware.ts` | www リダイレクト処理 |
| `app/media/[category]/[slug]/page.tsx` | メディア記事ページ（dynamicParams設定） |
| `app/layout.tsx` | metadataBase 設定 |
| `app/sitemap.ts` | サイトマップ生成 |
