# 日報 2026-01-28

## 作業内容

### 1. Vercelビルドタイムアウト問題の調査・解決

**問題**
- CFシミュレーターのAPIルート追加後、Vercelビルドが45分でタイムアウト
- ローカルビルドは正常に完了（約2分）

**調査結果**
- `vercel.json`に追加した`cf-simulations`の動的ルート設定が原因
- `functions`と`rewrites`の設定がビルドをハングさせていた

**解決策**
- 動的ルート`/api/cf-simulations/[id]`を廃止
- クエリパラメータ方式`/api/cf-simulations?id=xxx`に変更
- `vercel.json`から`cf-simulations`関連の設定を削除

**修正ファイル**
- `app/api/cf-simulations/route.ts` - GET/PUT/DELETEをクエリパラメータ対応に統合
- `app/api/cf-simulations/[id]/route.ts` - 削除
- `hooks/useCFSimulations.ts` - APIエンドポイントをクエリパラメータ方式に変更
- `vercel.json` - cf-simulations設定を削除

---

### 2. CFシミュレーター詳細ページの改善

**修正内容**
1. 入力フォームを常に表示（`isEditMode`条件を削除）
2. ボタンラベルを「シミュレーションを実行する」に統一
3. シミュレーション実行時に自動保存するように変更
4. 「更新を保存」ボタンを削除（自動保存化により不要）

**修正ファイル**
- `app/mypage/cf-simulator/[id]/CFSimulatorDetailClient.tsx`

---

### 3. PWA設定の最適化

**変更内容**
- Vercelプレビュー環境でPWA生成をスキップ
- ビルド時間の短縮を目的

**修正ファイル**
- `next.config.mjs`

---

## コミット履歴

```
75af2c8 fix: CFシミュレーション詳細ページで自動保存に変更し更新ボタンを削除
3c350b3 fix: 詳細ページのボタンラベルを「シミュレーションを実行する」に統一
47232e4 fix: CFシミュレーション詳細ページで入力フォームを常に表示
ae6b0e5 fix: CFシミュレーションAPIをクエリパラメータ方式に変更（動的ルート問題を回避）
d976e35 test: vercel.jsonからcf-simulations設定を削除してAPIルートを復元
0258746 test: CFシミュレーションAPIを一時無効化してビルド検証
8388336 perf: Vercelプレビュー環境でPWAを無効化してビルド高速化
```

---

## 学んだこと・メモ

- Vercelの動的ルート`[id]`は`vercel.json`での設定によってはビルドがハングすることがある
- クエリパラメータ方式は動的ルートより安定している
- Neonデータベースのブランチ機能：開発ブランチと本番ブランチでスキーマが異なる場合がある
- ビルドキャッシュが破損することがある（`Redeploy without cache`で対応可能）

---

## 次回以降の検討事項

- ローン比較シミュレーターの実装
- 税金シミュレーターの実装
- 収益シミュレーションの拡張（売却シナリオ比較機能）

---

## ビルド状況

- Vercel Preview: ✅ 正常（約2分）
- ローカルビルド: ✅ 正常
