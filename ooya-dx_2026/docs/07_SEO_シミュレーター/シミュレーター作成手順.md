# シミュレーター作成手順

新しいシミュレーターを作成する際のステップバイステップガイドです。

---

## 📋 作成フロー概要

```
1. 文言チェックリスト確認（必須・最初に読む）
   ↓
2. リサーチ（計算ロジック・エビデンス収集）
   ↓
3. 設計（入力項目・出力項目・早見表）
   ↓
4. 実装（テンプレートから作成）
   ↓
5. 文言チェック（断定表現・非弁行為の確認）
   ↓
6. テスト（計算結果の検証）
   ↓
7. リーガルチェック依頼
　ooya-dx_2026/docs/14_法律・リーガル/04_法務チェックリスト.mdを参考にする

   ↓どっち
8. 公開
```

---

## Step 1: 文言チェックリスト確認（必須）

**⚠️ シミュレーター作成前に必ず以下を確認してください**

📄 **`docs/07_SEO_シミュレーター/文言チェックリスト.md`**

### 確認すべき内容
- 断定表現はNG（「〜です」→「〜とされています」）
- FAQ/Q&AはNG（削除済み）
- アドバイスはNG（「〜した方がいい」「〜がおすすめ」）
- 数字は「約」をつける
- 免責事項は必須

### 前提の理解
当サイト運営者は税理士・弁護士・宅建士などの資格を保有していないため、
**「情報提供」と「計算ツールの提供」のみ**を行います。

---

## Step 2: リサーチ（計算ロジック・エビデンス収集）

### 1-1. 公式ソースを確認

| カテゴリ | 確認先 |
|---------|--------|
| 税金関連 | 国税庁 https://www.nta.go.jp/ |
| 不動産取引 | 国土交通省 https://www.mlit.go.jp/ |
| 宅建業法 | 宅建業法施行規則 |
| 地方税 | 各都道府県の税務ページ |
| 登記関連 | 法務局 https://houmukyoku.moj.go.jp/ |

### 1-2. 調査テンプレート

以下の項目を調査してメモする：

```markdown
## [ツール名] リサーチメモ

### 基本情報
- 正式名称：
- 根拠法令：
- 管轄省庁：

### 計算式
- 基本計算式：
- 特例・軽減措置：
- 税率・料率：

### エビデンス（公式ソース）
1. [タイトル](URL) - 概要
2. [タイトル](URL) - 概要

### 競合ツール調査
1. [サイト名](URL) - 特徴・差別化ポイント

### 注意点・免責事項に記載すべき内容
-
```

### 1-3. 競合ツール調査

`docs/07_SEO/競合ツール一覧.md` を参照し、以下を確認：
- 競合の入力項目
- 競合の出力形式
- 競合にない付加価値（差別化ポイント）

---

## Step 3: 設計

### 2-1. 入力項目の設計

```markdown
| 項目名 | 型 | 必須 | 単位 | バリデーション |
|--------|-----|------|------|----------------|
| 売買価格 | number | ○ | 万円 | 0以上 |
| 評価額 | number | ○ | 万円 | 0以上 |
| 築年数 | number | - | 年 | 0-100 |
```

#### ⚠️ 金額入力は必ず「万円」単位を使用（必須ルール）

**円単位の入力はNG。全シミュレーターで万円単位に統一してください。**

| NG | OK |
|----|-----|
| `unit="円"` placeholder="10,500,000" | `unit="万円"` placeholder="1050" |
| `unit="円"` placeholder="30,000,000" | `unit="万円"` placeholder="3000" |

**理由:**
- ユーザーが桁数を間違えにくい
- 入力が簡単（1050 vs 10,500,000）
- 表示の統一感

**実装例:**
```tsx
// state変数名に「InMan」を付けて万円であることを明示
const [priceInMan, setPriceInMan] = useState<number>(0)

// 計算時に円に変換
const priceInYen = priceInMan * 10000

// NumberInputは万円単位で
<NumberInput
  label="売買価格"
  value={priceInMan}
  onChange={setPriceInMan}
  unit="万円"
  placeholder="3000"
/>
```

### 2-2. 出力項目の設計

```markdown
| 項目名 | 計算式 | 表示形式 |
|--------|--------|----------|
| 税額（税抜） | price * rate | ○○円 |
| 消費税 | tax * 0.1 | ○○円 |
| 合計（税込） | tax + consumption | ○○円（強調表示） |
```

### 2-3. 早見表データ

よく検索される価格帯（SEOキーワードから逆算）：
- 「仲介手数料 3000万」→ 3,000万円を含める
- 「贈与税 1000万」→ 1,000万円を含める

### 2-4. 金額表示ルール（必須）

**⚠️ 全シミュレーターで以下の表示ルールを統一してください。**

#### 基本ルール

| 金額の種類 | 表示形式 | 例 |
|-----------|---------|-----|
| 月額・小さい金額 | 小数点第1位まで + 「約」 | 約13.5万円 |
| 年額・中程度の金額 | 小数点第1位まで + 「約」 | 約162.4万円 |
| 総額・大きい金額 | 整数（万円単位）+ 「約」 | 約5,684万円 |

#### 実装例

```tsx
// 月額・小さい金額（小数点第1位）
約{(result.monthlyPayment / 10000).toFixed(1)}万円

// 年額（小数点第1位）
約{(result.annualPayment / 10000).toFixed(1)}万円

// 総額・大きい金額（整数）
約{Math.round(result.totalPayment / 10000).toLocaleString()}万円
```

#### ポイント
- **「約」を必ずつける** - 概算であることを明示
- **小数点以下3桁以上は表示しない** - 「1,184.094万円」はNG
- **円単位の詳細表示は不要** - 「= 135,034円」は削除

---

## Step 4: 実装

### 3-1. テンプレートコピー

```bash
# ツール名: gift-tax（贈与税の例）
mkdir app/tools/gift-tax
cp app/tools/_template/page.tsx app/tools/gift-tax/
cp app/tools/_template/ToolNameCalculator.tsx app/tools/gift-tax/GiftTaxCalculator.tsx
cp lib/calculators/_template.ts lib/calculators/gift-tax.ts
```

### 3-2. 編集箇所チェックリスト

- [ ] `page.tsx`: メタデータ（title, description, keywords, OGP）
- [ ] `page.tsx`: 構造化データ（WebApplication, BreadcrumbList）
- [ ] `Calculator.tsx`: コンポーネント名
- [ ] `Calculator.tsx`: 早見表データ
- [ ] `Calculator.tsx`: パンくず
- [ ] `Calculator.tsx`: タイトル・説明文
- [ ] `Calculator.tsx`: 入力項目
- [ ] `Calculator.tsx`: 計算ロジック呼び出し
- [ ] `Calculator.tsx`: 結果表示
- [ ] `Calculator.tsx`: **計算式表示（必須）**
- [ ] `Calculator.tsx`: 解説セクション
- [ ] `calculator.ts`: 計算ロジック実装

### 3-2-1. 見出し構造ルール（h1/h2/h3）

**📄 詳細: `docs/07_SEO_シミュレーター/見出し構造ルール.md`**

#### h1（ページタイトル）

| 項目 | ルール |
|------|--------|
| 数 | 1ページに1つのみ |
| 文字数 | 25〜35文字 |
| 形式 | `[対象] 計算シミュレーション｜[付加価値]` |

**例:**
```
不動産売買の仲介手数料 計算シミュレーション｜早見表付き
不動産の贈与税 計算シミュレーション｜早見表・特例対応
```

#### h2/h3の基本ルール

| 見出し | 役割 | 数の目安 | 文字数 | 余白（Tailwind） |
|--------|------|----------|--------|------------------|
| h2 | 大テーマ・章 | 3〜7個 | 10〜25文字 | `mt-12 mb-4 scroll-mt-24` |
| h3 | h2の詳細・節 | 各h2下に0〜4個 | 10〜20文字 | `mt-8 mb-3 scroll-mt-24` |

#### h2の決め方

**h2 = ユーザーが検索しそうなキーワード・質問**

| パターン | 例 |
|----------|-----|
| 「〇〇とは」 | 仲介手数料とは |
| 「〇〇の計算方法」 | 贈与税の計算方法 |
| 「〇〇年の法改正」 | 2024年の法改正について |
| 「〇〇がかからないケース」 | 仲介手数料がかからないケース |

#### 推奨構造テンプレート

```
h1: [ツール名] 計算シミュレーション｜[付加価値]

h2: 1. [ツール対象]とは
├── h3: 1-1. 計算方法
├── h3: 1-2. 税率・料率
└── h3: 1-3. 具体的な計算例

h2: 2. [特例・控除]について

h2: 3. [法改正・注意点]

h2: 4. [関連する知識]
```

#### 見出しチェックリスト

- [ ] h1は1つのみか
- [ ] h2は3〜7個の範囲か
- [ ] h2に検索キーワードが含まれているか
- [ ] h3が孤立していないか（h2の下に1つだけは避ける）
- [ ] `scroll-mt-24` でアンカーリンクのスクロール位置を調整しているか

### 3-3. 計算式表示の実装（必須）

**弁護士推奨により、全シミュレーターに計算式の表示が必須です。**

```tsx
{/* 計算式表示 */}
{hasInput && (
  <div className="mt-4 pt-4 border-t border-gray-200">
    <p className="text-xs text-gray-500 mb-2">計算式</p>
    <div className="text-sm text-gray-700 font-mono space-y-1">
      <p>【ステップ1】{value1} × {rate} = {result1}</p>
      <p>【合計】{result1} + {result2} = {total}</p>
    </div>
  </div>
)}
```

#### 計算式表示のポイント
- 結果表示セクションの下部に配置
- `font-mono` クラスで等幅フォント使用
- 計算のステップを段階的に表示
- 入力がある場合のみ表示（条件付きレンダリング）

### 3-4. 計算結果注記コンポーネントの使用（必須）

**シミュレーターボックス直下に `CalculatorNote` コンポーネントを配置してください。**

```tsx
import { CalculatorNote } from '@/components/tools/CalculatorNote'

// シミュレーターボックスの閉じタグ直後に配置
</div>  {/* シミュレーターボックスの終わり */}

{/* 計算結果の注記 */}
<CalculatorNote />
```

#### 表示内容（自動）
- ※本計算結果は概算値です。実際の金額は異なる場合があります。
- ※最終的な判断は専門家（税理士・宅建業者・司法書士等）にご相談ください。

#### 配置場所
シミュレーターの青いボックス（bg-blue-50）の外、早見表セクションの前に配置します。

---

### 3-5. 免責事項コンポーネントの使用（必須）

**記事末尾に共通の `ToolDisclaimer` コンポーネントを使用してください。**

```tsx
import { ToolDisclaimer } from '@/components/tools/ToolDisclaimer'

// 基本の使い方（デフォルト値を使用）
<ToolDisclaimer />

// カスタマイズする場合
<ToolDisclaimer
  lastUpdated="2026年1月15日"
  infoDate="2025年1月"
  additionalItems={[
    '金利は実際の金融機関の条件により異なります',
    '団体信用生命保険料は含まれていません',
  ]}
/>
```

#### ToolDisclaimer Props

| プロパティ | 型 | デフォルト値 | 説明 |
|-----------|-----|-------------|------|
| `lastUpdated` | string | "2026年1月15日" | 最終更新日 |
| `infoDate` | string | "2025年1月" | 情報の基準時点 |
| `additionalItems` | string[] | [] | ツール固有の追加免責事項 |

#### 標準の免責事項（自動表示）
- 本シミュレーションは、{infoDate}時点の情報をもとに試算
- 結果は概算値であり、実際の金額は条件により異なる
- 税金や費用の詳細については、税理士・不動産会社等の専門家に相談
- 最終更新日の表示

#### 配置場所
免責事項は記事コンテンツの最後、関連シミュレーターセクションの直前に配置します。

---

### 3-6. 関連シミュレーターコンポーネントの使用（必須）

**免責事項の直後に `RelatedTools` コンポーネントを配置してください。**

```tsx
import { RelatedTools } from '@/components/tools/RelatedTools'

// 免責事項の直後に配置
<ToolDisclaimer />

{/* 関連シミュレーター */}
<RelatedTools currentPath="/tools/xxx" />

{/* CTA */}
```

#### RelatedTools Props

| プロパティ | 型 | デフォルト値 | 説明 |
|-----------|-----|-------------|------|
| `currentPath` | string | **必須** | 現在のページのパス（例: `/tools/gift-tax`） |
| `maxItems` | number | 6 | 表示する最大件数 |

#### 表示ロジック（自動）
- 同じカテゴリのツールを優先表示（`navigation.ts` のカテゴリを参照）
- 同じカテゴリで足りない場合は他のカテゴリから補完
- `available: true` のツールのみ表示
- 現在のページは自動的に除外

#### カテゴリ一覧（lib/navigation.ts）

| カテゴリ | 含まれるツール |
|----------|---------------|
| 物件購入・収益分析 | 賃貸経営シミュレーター |
| 融資・ローン | 住宅ローン |
| 税金 | 不動産取得税、登録免許税、印紙税、減価償却、法人税、贈与税、相続税 |
| 売却 | 仲介手数料、譲渡所得税 |

#### 配置場所
免責事項（ToolDisclaimer）の直後、CTAセクションの直前に配置します。

---

## Step 5: 文言チェック

### 5-1. 断定表現の確認

`文言チェックリスト.md` を参照し、以下を確認：

- [ ] 「〜です」の断定が最小限
- [ ] 「一般的に」「約」「程度」「とされています」を使用
- [ ] FAQ/Q&Aセクションがないこと
- [ ] アドバイス表現（「〜すべき」「おすすめ」）がないこと
- [ ] 免責事項が記載されていること

### 5-2. 非弁行為チェック

- [ ] 法律相談・法的アドバイスに該当しないこと
- [ ] 税務相談・節税アドバイスに該当しないこと
- [ ] 「情報提供」と「計算ツール提供」の範囲に留まっていること

### 5-3. 法改正情報の掲載ルール

**⚠️ 法改正は弁護士の領域です。以下のルールを厳守してください。**

#### 掲載OK
- [ ] 公式ソース（国土交通省・国税庁等）のエビデンスリンクがある
- [ ] 本人（運営者）が内容を確認・理解できている
- [ ] 参照リンクを明記している

#### 掲載NG
- [ ] エビデンスが不明確・不透明
- [ ] 本人が内容を確認できない
- [ ] 法改正の解釈が必要な内容

**判断に迷う場合は、法改正情報の掲載を見送り、弁護士に確認してください。**

---

## Step 6: テスト

### 4-1. 計算結果の検証

| テストケース | 入力値 | 期待値 | 実際の値 | 結果 |
|-------------|--------|--------|---------|------|
| ケース1 | 1,000万円 | 〇〇円 | | |
| ケース2 | 3,000万円 | 〇〇円 | | |
| 境界値 | 400万円 | 〇〇円 | | |

### 4-2. 検証方法

1. 公式の計算例と照合
2. 競合ツールの結果と比較
3. 税理士・専門家に確認（可能であれば）

---

## Step 7: リーガルチェック依頼

### 5-1. チェック依頼テンプレート

```
【シミュレーター名】〇〇シミュレーター
【URL】https://www.ooya.tech/tools/xxx

【確認事項】
1. 計算ロジックの正確性
2. 免責事項の文言
3. 法改正への対応状況

【参照した公式ソース】
- [国税庁](URL)
- ...

【懸念点】
- ...
```

### 5-2. ステータス更新

`docs/07_SEO/シミュレーターステータス一覧.md` を更新

---

## Step 8: 公開

### 8-1. 公開前チェックリスト

- [ ] 計算結果が正確
- [ ] 早見表データが正確
- [ ] 文言チェック完了（断定表現なし、非弁行為なし）
- [ ] メタデータが設定済み
- [ ] 構造化データが出力される
- [ ] モバイル表示確認
- [ ] リーガルチェック完了（または依頼済み）
- [ ] `シミュレーターステータス一覧.md` 更新

### 8-2. サイトマップ（自動）

**XMLサイトマップは自動生成されます。手動更新は不要です。**

📄 **`app/sitemap.ts`**

新しいツールを `app/tools/[ツール名]/page.tsx` に作成すると、ビルド時に自動的に `sitemap.xml` に追加されます。

#### 自動検出の条件
- `app/tools/` 直下のディレクトリ
- `page.tsx` ファイルが存在する
- ディレクトリ名が `_` で始まらない（`_template` は除外）
- `components`、`template-demo` は除外

---

### 8-3. リンク追加（必須）

**新しいシミュレーターを公開したら、以下のファイルにリンクを追加：**

📄 **`lib/navigation.ts`**（一元管理）

このファイルに追加するだけで、以下すべてに自動反映されます：
- フッターのリンク一覧
- `/tools` ページのツール一覧

```tsx
// lib/navigation.ts の calculatorTools 配列に追加
export const calculatorTools: NavigationItem[] = [
  // ...既存のツール
  { name: '〇〇税', description: '〇〇を計算', href: '/tools/xxx', available: true },  // ← 追加
];
```

#### 追加項目の説明

| プロパティ | 説明 | 例 |
|-----------|------|-----|
| `name` | ツール名（短く） | `'贈与税'` |
| `description` | 簡潔な説明 | `'不動産贈与時の税金を計算'` |
| `href` | ツールのパス | `'/tools/gift-tax'` |
| `available` | 公開状態 | `true`（公開）/ `false`（準備中） |

### 8-3. 公開後

- Google Search Console でインデックス登録リクエスト
- アクセス解析で効果測定

---

## 📁 関連ファイル

| ファイル | 用途 |
|---------|------|
| **`docs/07_SEO_シミュレーター/文言チェックリスト.md`** | **⚠️ 必読：断定表現・非弁行為チェック** |
| **`lib/navigation.ts`** | **⚠️ ツール一覧の一元管理（フッター・ツール一覧ページに自動反映）** |
| `app/tools/_template/` | テンプレートファイル |
| `app/tools/template-demo/` | テンプレートデモページ |
| `lib/calculators/` | 計算ロジック |
| `components/tools/CalculatorNote.tsx` | **計算結果注記コンポーネント（シミュレーター直下）** |
| `components/tools/ToolDisclaimer.tsx` | **免責事項コンポーネント（記事末尾）** |
| `components/tools/RelatedTools.tsx` | **関連シミュレーターコンポーネント（免責事項の直後）** |
| `components/tools/NumberInput.tsx` | 数値入力コンポーネント |
| `components/tools/ResultCard.tsx` | 結果表示カードコンポーネント |
| `components/tools/QuickReferenceTable.tsx` | 早見表コンポーネント |
| `components/landing-footer.tsx` | フッターコンポーネント（navigation.tsを参照） |
| `app/tools/page.tsx` | ツール一覧ページ（navigation.tsを参照） |
| `docs/07_SEO_シミュレーター/シミュレーターステータス一覧.md` | 進捗管理 |
| `docs/07_SEO_シミュレーター/03_競合調査/競合ツール一覧.md` | 競合調査 |

