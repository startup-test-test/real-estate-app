# Vercelデプロイ障害レポート（2026-02-08）

> ステータス: **未解決**
> プロジェクト: ooya-dx_2026（`prj_rKZBQb3W4r0RZuUkk1iEDC5mfAz7`）
> リージョン: iad1（Washington, D.C., USA East）

---

## 概要

構造化データの軽微な修正（4行削除）をプッシュしたところ、Vercelのビルドが「Cloning completed」の後でハングし、デプロイできなくなった。ローカルビルドは正常に成功する。

---

## 経緯

| 時刻 | 操作 | コミット | 結果 |
|------|------|----------|------|
| 12:28頃 | mainにプッシュ | `c17007d` | **成功（2m 13s）** — 本日最後の正常デプロイ |
| 12:28頃 | mainEntity削除（4行修正）をプッシュ | `b66f31a` | **ハング（10分超）** → キャンセル |
| 12:35頃 | 空コミットでリトライ | `91f0ca0` | **ハング（10分超）** → キャンセル |
| 12:40頃 | CLIから `vercel --prod` でデプロイ | - | 成功したが**別プロジェクト（real-estate-app）に配信**され本番未反映 |
| 12:45頃 | キャッシュなしで Redeploy | - | **ハング（6分超）** → キャンセル |
| 13:03頃 | 重複プロジェクトのGit連携解除後、再プッシュ | `876b546` | **ハング** → キャンセル |
| 13:39頃 | キャッシュなし + 空コミットで再プッシュ | `f97ccab` | **ハング** → キャンセル |
| 13:46頃 | Build Machine設定確認後、Redeploy | - | **ハング（10分超）** → キャンセル |

---

## 症状

ビルドログが**毎回5行で停止**する：

```
Running build in Washington, D.C., USA (East) – iad1
Build machine configuration: 4 cores, 8 GB
Cloning github.com/startup-test-test/real-estate-app (Branch: ..., Commit: ...)
Cloning completed: 8.xxxs
(Skipping build cache / Restored build cache)
```

- `npm install` や `next build` が**一切始まらない**
- 10分以上経っても次のログが出ない
- Production / Preview どちらも同じ症状

---

## 切り分け結果

| 確認項目 | 結果 | 詳細 |
|----------|------|------|
| ローカルビルド | **正常に成功** | `npx next build` で全ページビルド完了 |
| コード変更 | 軽微 | ToolStructuredData.tsx から mainEntity を4行削除しただけ |
| キャッシュなし再デプロイ | **ハング** | キャッシュ破損ではない |
| 重複プロジェクト解除 | **ハング** | `real-estate-app` プロジェクトのGit連携を解除済み。改善なし |
| Build Machine設定 | 不一致 | 設定: Turbo（30 vCPUs）→ 実際のログ: 4 cores/8GB（Standard） |
| Root Directory | 正常 | `ooya-dx_2026` に設定済み |
| Include files outside root | 無効 | チェックなし |
| Vercel Status Page | 正常表示 | 「All Systems Operational」（障害報告なし） |
| Python依存 | 問題なし | requirements.txt は実質空（コメントのみ） |
| Gitリポジトリサイズ | 問題なし | 242MB（クローンは8秒で完了） |
| Node.js バージョン | 24.x | 正常デプロイ時と同じ |

---

## 発見された副次的問題

### 重複プロジェクト問題

同じGitリポジトリに2つのVercelプロジェクトが紐づいていた：

| プロジェクト | 役割 | ドメイン | 状態 |
|-------------|------|---------|------|
| `ooya-dx_2026` | 本番 | ooya.tech | ビルドハング中 |
| `real-estate-app` | 不要な重複 | real-estate-app-seven-silk.vercel.app | Git連携**解除済み** |

- push のたびに2つのビルドが同時に走り、ビルド時間を浪費していた
- Build Minutes が月26時間（$21.99）に膨れていた原因の一つ
- **対応済み**: `real-estate-app` のGit連携を `vercel git disconnect` で解除

### Build Machine 設定の不一致

- ダッシュボード設定: **Turbo performance**（30 vCPUs, 60 GB）— $0.126/分
- 実際のビルドログ: **4 cores, 8 GB**（Standard相当）
- Turbo料金が課金されているのにStandard性能で動いている可能性

---

## 現在の本番状態

- `ooya.tech` は `c17007d`（12:28の正常デプロイ）で稼働中
- 構造化データの mainEntity 修正（`b66f31a`）は**未反映**
- mainEntity が残っていてもペナルティではなく「一部無効」表示のみ（緊急性は低い）

---

## 次のアクション

- [ ] **時間をおいて再デプロイ**（30分〜1時間後にリトライ）
- [ ] **Vercelサポートに問い合わせ**
  - プロジェクトID: `prj_rKZBQb3W4r0RZuUkk1iEDC5mfAz7`
  - 症状: iad1リージョンで「Cloning completed」後にビルドがハング
  - Build Machine設定（Turbo）と実際のログ（4 cores）の不一致
- [ ] **ビルドリージョンの変更**（iad1 → 別リージョン）が可能か確認
- [ ] **Build Machine をStandardに明示変更**して料金の無駄を防ぐ
- [ ] 不要プロジェクト `real-estate-app` の削除を検討

---

## 参考

- Vercel Status: https://vercel-status.com/
- リッチリザルトテスト: https://search.google.com/test/rich-results
