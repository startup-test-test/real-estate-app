# 日報 2026-01-08

## 本日の作業サマリー

テスト環境の構築（Neon Branch + Vercel Preview + Git develop）、リポジトリ整理、Stripe環境変数の設定を完了。2つのVercelプロジェクト間の設定差異を発見・解決。

---

## 完了タスク

### 1. テスト環境構築

**Neon Database Branch:**
- `development` ブランチ作成済み（ep-spring-tree-a1rdq8uw）
- 本番DBとは独立したテスト用データベース
- `prisma db push` でスキーマ同期完了

**Vercel Preview環境:**
- DATABASE_URL を Production/Preview で分離設定
- Basic Auth を両環境に設定
- Stripe環境変数を追加（Production + Preview）

**Git ブランチ:**
- `develop` ブランチ作成・プッシュ完了
- developへのプッシュでPreviewデプロイが自動実行

**ドキュメント作成:**
- `docs/04_環境設定/テスト環境構築ガイド.md` 作成

### 2. リポジトリ整理

**アーカイブ:**
- `bolt_front/` → `_archive/`
- `supabase/` → `_archive/`
- `docs_md/` → `_archive/`
- `.devcontainer/` 削除
- `.github/` → `_archive/`
- ルートレベルの重複フォルダ削除

**docs整理:**
- 番号付きフォルダ構成に変更
  - `01_サイト構成/`
  - `02_メディア/`
  - `03_設計書/`
  - `04_環境設定/`
  - `05_SEO調査/`
  - `06_計算ツール/`
  - `07_法務/`
  - `08_運用/`

### 3. SEO対応

**カテゴリページ作成:**
- `/media/[category]/page.tsx` 作成
- `/media/base` - 不動産投資の基礎
- `/media/kodate` - 戸建て投資

**サイトマップ作成:**
- `docs/01_サイト構成/sitemap.md` - 全38ページ
- `docs/02_メディア/media-pages.md` - メディア16ページ一覧

### 4. Stripe環境変数設定

**発見した問題:**
- VercelにStripe環境変数が設定されていなかった
- ローカル（.env）では動作、本番（Vercel）では未設定
- `real-estate-app` と `ooya-dx_2026` の2プロジェクト混在

**解決:**
- `ooya-dx_2026` プロジェクトにStripe環境変数を追加
  - STRIPE_SECRET_KEY
  - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
  - STRIPE_PRICE_ID
  - STRIPE_WEBHOOK_SECRET
- Production と Preview 両方に設定

---

## 進捗状況

| タスク | 状態 |
|--------|------|
| Neon developmentブランチ設定 | ✅ 完了 |
| Vercel Preview環境設定 | ✅ 完了 |
| Git developブランチ作成 | ✅ 完了 |
| リポジトリ整理（アーカイブ） | ✅ 完了 |
| docs番号付きフォルダ整理 | ✅ 完了 |
| カテゴリページ作成（SEO） | ✅ 完了 |
| サイトマップ作成 | ✅ 完了 |
| Stripe環境変数設定 | ✅ 完了 |
| テスト環境構築ガイド作成 | ✅ 完了 |

---

## 環境比較

| 項目 | Production (main) | Preview (develop) |
|------|-------------------|-------------------|
| URL | ooya-dx2026.vercel.app | ooya-dx2026-git-develop-*.vercel.app |
| DATABASE | ep-sparkling-tooth (本番) | ep-spring-tree (development) |
| Stripe | サンドボックス | サンドボックス（同一） |
| Basic Auth | 有効 | 有効 |

---

## Git コミット履歴

| コミット | 内容 |
|---------|------|
| `16c18fa` | Stripe環境変数反映のための再デプロイ |
| `e5e84c0` | Stripe本番/開発環境分離を課題に追加 |
| `dfb3979` | テスト環境構築・ドキュメント整備 |
| `3522a48` | ランディングページ用コンポーネントと記事コンテンツの追加 |

---

## 課題管理

### 新規発見した課題

1. **Stripe環境変数のエラー** [要対応]
   - エラー: `Invalid character in header content ["Authorization"]`
   - 原因: 環境変数に不正な文字（改行等）が含まれている可能性
   - 対応: Vercel Dashboardで環境変数を再設定
   - 優先度: 最高

### 追加した課題

1. **Stripe 本番/開発環境分離** [未着手]
   - 本番リリース時にmain=本番キー、develop=サンドボックスに分離
   - 優先度: 中

### 進行中の課題

1. **Stripe アクセス制御** [進行中]
   - シミュレーターの有料会員限定アクセス実装
   - 優先度: 最高

### 未着手の主要課題

| 課題 | 優先度 |
|------|--------|
| シミュレーション保存機能 | 高 |
| Stripe複数サービス対応 | 高 |
| 計算ツール開発（SEO集客） | 高 |
| トップページ改修（総合ポータル化） | 高 |
| WordPress → Vercel完全移行 | 中 |
| Resendメール送信設定 | 中 |

---

## 技術メモ

### テスト環境アーキテクチャ

```
[開発者]
    ↓ git push develop
[GitHub develop branch]
    ↓ webhook
[Vercel Preview]
    ↓ 環境変数: Preview
[Neon development branch]
    ↓ 独立DB
[Preview URL で確認]
```

### Vercel環境変数の管理

```bash
# 追加
npx vercel env add <NAME> <production|preview|development>

# 一覧
npx vercel env ls

# 削除
npx vercel env rm <NAME> <environment>
```

### 発見した問題

**2つのVercelプロジェクト:**
- `real-estate-app` → 旧プロジェクト
- `ooya-dx_2026` → 新プロジェクト（現在使用中）

環境変数は各プロジェクトで独立しているため、移行時に再設定が必要。

---

## 明日のタスク

### 優先度：最高
1. **Stripe アクセス制御の完了**
   - シミュレーターページのサブスク確認ロジック実装
   - 動作確認（未契約・トライアル・有料会員）

### 優先度：高
2. **シミュレーション保存機能**
   - Prismaスキーマ更新
   - API作成

3. **計算ツール開発**
   - 贈与税計算
   - 不動産取得税計算

---

## 所感

テスト環境の構築が完了し、develop→mainのワークフローが確立できた。Stripe環境変数がVercelに設定されていなかった問題を発見・解決。ローカル開発では.envファイルで動作するため気づきにくい問題だった。

2つのVercelプロジェクト（real-estate-app / ooya-dx_2026）の存在も判明。今後は ooya-dx_2026 に統一して運用する。

---

**作業時間:** 19:00 - 20:00（約1時間）
