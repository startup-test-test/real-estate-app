# ユーザーフロー検証チェックリスト

**最終更新**: 2026年1月10日

---

## 概要

新規会員登録 → ログイン → 決済までの一連のユーザーフローを検証するためのチェックリスト。
本番リリース前に全項目を確認すること。

---

## 検証環境

| 環境 | URL | 認証機能 | 決済機能 | 用途 |
|------|-----|---------|---------|------|
| localhost | http://localhost:3002 | OK | OK（Stripe CLI必要） | 全機能テスト |
| Vercelプレビュー | https://ooya-dx2026-git-develop-xxx.vercel.app | 制限あり※ | OK | UI確認 |
| 本番 | （独自ドメイン設定後） | OK | OK | 最終確認 |

※Basic認証環境ではログアウト等が403エラー。詳細: `Basic認証とNeonAuth仕様.md`

---

## 1. 認証機能

### 1.1 新規会員登録

#### 1.1.1 メール/パスワード登録

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | 有効な情報で登録 | 登録成功、確認メール送信 | ⬜ | ⬜ |
| 2 | 正常系 | 確認メールのリンククリック | 認証完了、ログイン可能 | ⬜ | ⬜ |
| 3 | 異常系 | 必須項目未入力 | エラーメッセージ表示 | ⬜ | ⬜ |
| 4 | 異常系 | 無効なメール形式 | フォーマットエラー表示 | ⬜ | ⬜ |
| 5 | 異常系 | パスワード要件不足 | 要件エラー表示 | ⬜ | ⬜ |
| 6 | 異常系 | 利用規約未同意 | 同意必須エラー表示 | ⬜ | ⬜ |
| 7 | 異常系 | 登録済みメールで再登録 | 「既に登録済み」エラー | ⬜ | ⬜ |

#### 1.1.2 Google OAuth登録

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | Google認証で新規登録 | ユーザー作成、マイページ遷移 | ⬜ | ⬜ |
| 2 | 正常系 | 登録済みGoogleアカウントで登録 | 既存アカウントでログイン | ⬜ | ⬜ |
| 3 | 異常系 | Google認証をキャンセル | 登録ページに戻る | ⬜ | ⬜ |

---

### 1.2 ログイン

#### 1.2.1 メール/パスワードログイン

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | 正しい情報でログイン | ログイン成功、マイページ遷移 | ⬜ | ⬜ |
| 2 | 正常系 | セッション維持（ブラウザ再読み込み） | ログイン状態維持 | ⬜ | ⬜ |
| 3 | 異常系 | 間違ったパスワード | 認証エラー表示 | ⬜ | ⬜ |
| 4 | 異常系 | 存在しないメールアドレス | 認証エラー表示 | ⬜ | ⬜ |
| 5 | 異常系 | メール未認証アカウント | 認証メール再送案内 | ⬜ | ⬜ |

#### 1.2.2 Google OAuthログイン

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | 登録済みアカウントでログイン | ログイン成功 | ⬜ | ⬜ |
| 2 | 異常系 | 未登録Googleアカウントでログイン | 新規登録として処理 | ⬜ | ⬜ |

---

### 1.3 パスワードリセット

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | リセットメール送信 | メール送信成功メッセージ | ⬜ | ⬜ |
| 2 | 正常系 | リセットリンクから新パスワード設定 | パスワード変更完了 | ⬜ | ⬜ |
| 3 | 正常系 | 新パスワードでログイン | ログイン成功 | ⬜ | ⬜ |
| 4 | 異常系 | 未登録メールでリセット要求 | エラー表示（またはセキュリティ上同じメッセージ） | ⬜ | ⬜ |
| 5 | 異常系 | 期限切れリンク使用 | 期限切れエラー表示 | ⬜ | ⬜ |

---

### 1.4 ログアウト

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | ログアウト実行 | セッション破棄、トップページ遷移 | ⬜ | ⬜ |
| 2 | 正常系 | ログアウト後に認証必須ページアクセス | ログインページにリダイレクト | ⬜ | ⬜ |

---

## 2. 決済機能（Stripe）

### 2.1 課金ページ

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 表示 | 未契約ユーザー | 料金プラン、「今すぐ登録」ボタン表示 | ⬜ | ⬜ |
| 2 | 表示 | トライアル中ユーザー | 「トライアル中」、期間終了日表示 | ⬜ | ⬜ |
| 3 | 表示 | 有料会員（active） | 「契約中」、次回更新日表示 | ⬜ | ⬜ |
| 4 | 表示 | 解約予約中ユーザー | 「解約予定」、利用可能終了日表示 | ⬜ | ⬜ |
| 5 | 表示 | 解約済みユーザー | 「未契約」、再登録ボタン表示 | ⬜ | ⬜ |

---

### 2.2 決済フロー（新規契約）

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | Checkout画面遷移 | Stripe Checkout表示 | ⬜ | ⬜ |
| 2 | 正常系 | テストカードで決済成功 | 決済完了、リダイレクト | ⬜ | ⬜ |
| 3 | 正常系 | Webhook受信・DB更新 | Subscription作成、status=trialing | ⬜ | ⬜ |
| 4 | 異常系 | カード拒否 | エラーメッセージ表示 | ⬜ | ⬜ |
| 5 | 異常系 | 決済途中でキャンセル | 課金ページに戻る | ⬜ | ⬜ |
| 6 | 異常系 | Webhook失敗時のリカバリ | 手動同期ボタンで復旧 | ⬜ | ⬜ |

---

### 2.3 アクセス制御

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 未契約 | シミュレーターアクセス | 課金ページにリダイレクト | ⬜ | ⬜ |
| 2 | trialing | シミュレーターアクセス | シミュレーター表示 | ⬜ | ⬜ |
| 3 | active | シミュレーターアクセス | シミュレーター表示 | ⬜ | ⬜ |
| 4 | past_due | シミュレーターアクセス | （要件による）警告表示 or リダイレクト | ⬜ | ⬜ |
| 5 | canceled | シミュレーターアクセス | 課金ページにリダイレクト | ⬜ | ⬜ |
| 6 | 解約予約中 | シミュレーターアクセス | 期間終了まで利用可能 | ⬜ | ⬜ |

---

### 2.4 サブスクリプション管理

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | Customer Portal遷移 | Stripeポータル表示 | ⬜ | ⬜ |
| 2 | 正常系 | 支払い方法変更 | カード情報更新成功 | ⬜ | ⬜ |
| 3 | 正常系 | 請求履歴表示 | 過去の請求一覧表示 | ⬜ | ⬜ |

---

### 2.5 解約フロー（Stripe Customer Portal経由）

**実装方法**: Stripe Customer Portal（ホスティング型）で解約処理

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | Customer Portalで解約予約 | cancelAtPeriodEnd=true | ⬜ | ⬜ |
| 2 | 正常系 | 解約予約後のアクセス | 期間終了まで利用可能 | ⬜ | ⬜ |
| 3 | 正常系 | Webhook受信 | customer.subscription.updated受信 | ⬜ | ⬜ |
| 4 | 正常系 | 期間終了後 | status=canceled、Webhook受信 | ⬜ | ⬜ |

---

### 2.6 自動更新（Stripe自動処理）

**実装方法**: Stripeが自動で課金処理 → Webhook経由でDB更新

| # | 分類 | 検証項目 | 期待結果 | localhost | 本番 |
|---|------|---------|---------|-----------|------|
| 1 | 正常系 | トライアル終了後の自動課金 | invoice.payment_succeeded Webhook受信 | ⬜ | ⬜ |
| 2 | 正常系 | DB更新確認 | status=active、currentPeriodEnd更新 | ⬜ | ⬜ |
| 3 | 異常系 | 更新時決済失敗 | invoice.payment_failed Webhook受信 | ⬜ | ⬜ |

**注意**: 自動更新のテストにはStripeのテストクロック機能を使用

---

## 3. UI/UX

### 3.1 ページ表示

| # | ページ | 検証項目 | 期待結果 | localhost | 本番 |
|---|--------|---------|---------|-----------|------|
| 1 | トップページ | 未ログイン時 | 「無料登録」「ログイン」ボタン表示 | ⬜ | ⬜ |
| 2 | トップページ | ログイン時 | ユーザーアイコン、ドロップダウン表示 | ⬜ | ⬜ |
| 3 | マイページ | 未ログインでアクセス | ログインページにリダイレクト | ⬜ | ⬜ |
| 4 | マイページ | ログイン時 | サイドバー、コンテンツ表示 | ⬜ | ⬜ |

### 3.2 レスポンシブ

| # | デバイス | 検証項目 | 期待結果 | localhost | 本番 |
|---|---------|---------|---------|-----------|------|
| 1 | PC | 全ページ表示 | 正常表示 | ⬜ | ⬜ |
| 2 | タブレット | 全ページ表示 | 正常表示 | ⬜ | ⬜ |
| 3 | スマートフォン | 全ページ表示 | 正常表示、タッチ操作可能 | ⬜ | ⬜ |

---

## 4. 統合テスト（エンドツーエンド）

### 4.1 新規ユーザージャーニー

| # | ステップ | 操作 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 訪問 | トップページにアクセス | サービス概要表示 | ⬜ | ⬜ |
| 2 | 登録開始 | 「無料登録」クリック | 登録ページ遷移 | ⬜ | ⬜ |
| 3 | アカウント作成 | メール/パスワード入力・送信 | 登録成功 | ⬜ | ⬜ |
| 4 | メール認証 | 確認メールのリンククリック | 認証完了 | ⬜ | ⬜ |
| 5 | ログイン | 登録情報でログイン | マイページ表示 | ⬜ | ⬜ |
| 6 | シミュレーター試行 | サイドバーからアクセス | 課金ページにリダイレクト | ⬜ | ⬜ |
| 7 | トライアル開始 | 「今すぐ登録」クリック | Stripe Checkout表示 | ⬜ | ⬜ |
| 8 | 決済完了 | テストカード入力・決済 | 成功、課金ページに戻る | ⬜ | ⬜ |
| 9 | シミュレーター利用 | 再度アクセス | シミュレーター表示 | ⬜ | ⬜ |
| 10 | 機能確認 | 物件情報入力・計算 | 結果表示 | ⬜ | ⬜ |
| 11 | ログアウト | ヘッダーからログアウト | トップページに戻る | ⬜ | ⬜ |
| 12 | 再ログイン | 同じアカウントでログイン | マイページ、契約状態維持 | ⬜ | ⬜ |

### 4.2 既存ユーザー再訪

| # | ステップ | 操作 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 訪問 | トップページにアクセス | ログイン状態維持（Cookie有効時） | ⬜ | ⬜ |
| 2 | マイページ | 直接アクセス | 正常表示 | ⬜ | ⬜ |
| 3 | シミュレーター | 直接アクセス | 契約状態に応じた表示 | ⬜ | ⬜ |

---

## テストカード情報（Stripeサンドボックス）

| カード番号 | 結果 | 用途 |
|-----------|------|------|
| `4242 4242 4242 4242` | 成功 | 正常系テスト |
| `4000 0000 0000 0002` | カード拒否 | 異常系テスト |
| `4000 0000 0000 9995` | 残高不足 | 異常系テスト |
| `4000 0025 0000 3155` | 3Dセキュア | 追加認証テスト |

**有効期限**: 未来の任意の日付（例: 12/34）
**CVC**: 任意の3桁（例: 123）

---

## 検証記録

| 日付 | 検証者 | 環境 | 対象セクション | 結果 | 備考 |
|------|--------|------|---------------|------|------|
| | | | | | |

---

## 将来実装予定（未実装機能）

以下の機能は現時点で未実装。実装後に検証項目を追加すること。

### アカウント管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| プロフィール編集 | 名前・メール・パスワード変更 | 中 |
| アカウント削除 | ユーザー自身でアカウント削除 | 中 |
| セッション管理 | アクティブセッション一覧・強制ログアウト | 低 |

### その他

| 機能 | 説明 | 優先度 |
|------|------|--------|
| シミュレーション保存 | 計算結果の保存・再利用 | 高 |
| 通知設定 | メール通知のオン/オフ | 低 |

---

## 関連ドキュメント

- `docs/03_課金システム/Stripe課金システム設計.md` - 課金システム詳細設計
- `docs/08_運用/課題管理表.md` - 実装状況・課題一覧
- `docs/08_運用/Basic認証とNeonAuth仕様.md` - 認証環境の制限事項