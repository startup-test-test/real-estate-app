# 実装計画

## フェーズ概要

| フェーズ | 内容 | 対象 |
|----------|------|------|
| Phase 1 | UI共通コンポーネント作成 | `components/calculators/ui/` |
| Phase 2 | レイアウト共通コンポーネント作成 | `components/tools/` |
| Phase 3 | BrokerageCalculatorをリファクタリング | 動作検証 |
| Phase 4 | 他のツールページに展開 | 全24ツール |

---

## Phase 1: UI共通コンポーネント作成

### 作成するファイル

```
components/calculators/ui/
├── CalculatorContainer.tsx
├── CalculatorTitle.tsx
├── CalculatorInputField.tsx
├── CalculatorResultBox.tsx
├── CalculatorResultRow.tsx
├── CalculatorMainResult.tsx
├── CalculatorFormula.tsx
├── CalculatorCopyButton.tsx
├── CalculatorWarning.tsx
└── index.ts
```

### 作業手順

1. `components/calculators/ui/` ディレクトリ作成
2. 各コンポーネントを作成
3. `index.ts` でエクスポート
4. 単体テスト（Storybook or 直接確認）

---

## Phase 2: レイアウト共通コンポーネント作成

### 作成・更新するファイル

```
components/tools/
├── ContentPageLayout.tsx      ← 新規
├── ToolPageHeader.tsx      ← 新規
├── ToolSidebar.tsx         ← 新規
├── ToolMobileSidebar.tsx   ← 新規
├── ToolCategoryList.tsx    ← 新規
├── SimulatorCTA.tsx        ← 新規
├── ToolsBreadcrumb.tsx     ← 既存（そのまま）
├── ToolDisclaimer.tsx      ← 既存（そのまま）
├── CompanyProfileCompact.tsx ← 既存（そのまま）
├── CalculatorNote.tsx      ← 既存（そのまま）
└── ShareButtons.tsx        ← 既存（そのまま）
```

### データ移動

`BrokerageCalculator.tsx` 内の `toolCategories` を共通データとして移動：

```
lib/
└── navigation.ts  ← toolCategories を追加
```

---

## Phase 3: BrokerageCalculatorリファクタリング

### Before

```tsx
// 420行のモノリシックなコンポーネント
export function BrokerageCalculator() {
  return (
    <div className="min-h-screen...">
      <LandingHeader />
      {/* 全て直接記述 */}
    </div>
  )
}
```

### After

```tsx
// シンプルな構成
export function BrokerageCalculator() {
  return (
    <ContentPageLayout
      title={PAGE_TITLE}
      toolPath="/tools/brokerage"
      publishDate="2026-01-15"
      additionalContent={
        <>
          <BrokerageQuickReference />
          <BrokerageExplanation />
          <BrokerageFAQ />
          <BrokerageGuideLink />
        </>
      }
    >
      <BrokerageCalculatorCompact showTitle={false} />
    </ContentPageLayout>
  )
}
```

### 検証項目

- [ ] PC表示が崩れていないか
- [ ] SP表示が崩れていないか
- [ ] 計算が正しく動作するか
- [ ] シェアボタンが動作するか
- [ ] コピーボタンが動作するか
- [ ] スティッキーサイドバーが動作するか

---

## Phase 4: 他のツールページに展開

### 対象ツール（24種類）

#### 利回り系
- [ ] /tools/yield - 表面利回り・実質利回り
- [ ] /tools/cap-rate - キャップレート
- [ ] /tools/income-approach - 収益還元（直接還元法）
- [ ] /tools/cost-approach - 積算評価
- [ ] /tools/replacement-cost - 再調達価格

#### 収益分析系
- [ ] /tools/noi - NOI（営業純収益）
- [ ] /tools/ccr - CCR（自己資金配当率）
- [ ] /tools/dscr - DSCR（返済余力）
- [ ] /tools/npv - NPV（正味現在価値）
- [ ] /tools/roi - ROI（投資利益率）

#### ローン系
- [ ] /tools/loan - 住宅ローン返済額
- [ ] /tools/ltv - LTV（借入比率）
- [ ] /tools/cashflow - CF（キャッシュフロー）

#### 税金・費用系
- [ ] /tools/acquisition-tax - 不動産取得税
- [ ] /tools/registration-tax - 登録免許税
- [ ] /tools/stamp-duty - 印紙税
- [x] /tools/brokerage - 仲介手数料 ← Phase 3で完了
- [ ] /tools/corporate-tax - 法人税

#### 売却系
- [ ] /tools/sale-proceeds - 売却手取り
- [ ] /tools/transfer-income-tax - 譲渡所得税
- [ ] /tools/depreciation - 減価償却

#### 長期収支系
- [ ] /tools/irr - IRR（内部収益率）
- [ ] /tools/dcf - DCF法
- [ ] /tools/dead-cross - デッドクロス

---

## 優先順位

### 高優先度（よく使われるツール）
1. /tools/yield
2. /tools/loan
3. /tools/acquisition-tax
4. /tools/registration-tax
5. /tools/stamp-duty

### 中優先度
6. /tools/noi
7. /tools/ccr
8. /tools/cashflow
9. /tools/depreciation
10. /tools/irr

### 低優先度（専門的なツール）
11. その他

---

## 注意事項

1. **段階的に展開** - 一気に全ツールを変更せず、動作確認しながら進める
2. **既存機能を壊さない** - 計算ロジックは変更しない
3. **デザイン統一** - 細かい差異をなくし、ユーザー体験を統一
4. **パフォーマンス** - 不要な再レンダリングを避ける
