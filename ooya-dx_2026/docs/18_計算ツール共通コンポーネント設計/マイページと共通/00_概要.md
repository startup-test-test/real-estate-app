# 計算ツール共通コンポーネント設計 - 概要

## 目的

現在の計算ツール（`/tools/*`）をコンポーネント化し、以下の場所で再利用可能にする：

1. **SEOページ**（`/tools/*`） - 現在の用途
2. **賃貸経営シミュレーション**（`/mypage/cf-simulator`） - 新規用途

## 背景・課題

### 現状の構造

```
app/tools/brokerage/
├── page.tsx                    # メタデータ設定のみ
└── BrokerageCalculator.tsx     # 実質「ページ全体」を含む
    ├── LandingHeader
    ├── パンくず
    ├── h1タイトル
    ├── SEO解説文
    ├── 入力フォーム          ← 再利用したい部分
    ├── 計算結果表示          ← 再利用したい部分
    ├── 早見表
    ├── 関連ツール
    └── LandingFooter
```

### 問題点

- `XxxCalculator.tsx` は「コンポーネント」と呼んでいるが、実態は「ページテンプレート」
- ヘッダー/フッター/SEOコンテンツを含むため、他の場所に埋め込めない
- 計算ロジックは `lib/calculators/*.ts` に分離済みだが、UIが再利用できない

## 解決策

### 新しいアーキテクチャ

```
lib/calculators/
└── brokerage.ts                      # 計算ロジック（既存・変更なし）

components/calculators/
└── BrokerageCalculatorCompact.tsx    # UIコンポーネント（新規作成）
    ├── 入力フォーム
    └── 計算結果表示

app/tools/brokerage/
├── page.tsx                          # SEOページ
└── BrokerageCalculator.tsx           # ページテンプレート
    ├── LandingHeader
    ├── SEO解説文
    ├── ★BrokerageCalculatorCompact   ← コンポーネントを使用
    └── LandingFooter

app/mypage/cf-simulator/
└── page.tsx                          # シミュレーション画面
    ├── CFシミュレーター本体
    └── ★BrokerageCalculatorCompact   ← 同じコンポーネントを使用
```

### メリット

| 観点 | 効果 |
|------|------|
| **再利用性** | SEOページとシミュレーション画面で同じUIを使用 |
| **保守性** | 計算ロジック・UIを一箇所で管理、修正が全体に反映 |
| **データ連携** | シミュレーション画面から初期値を渡せる |
| **プロダクト価値** | 有料機能として計算ツール統合を提供可能 |

## 対象ツール一覧

| カテゴリ | ツール名 | 優先度 |
|----------|----------|--------|
| **諸費用** | 仲介手数料 | 高 |
| | 不動産取得税 | 高 |
| | 登録免許税 | 高 |
| | 印紙税 | 高 |
| **収益指標** | 利回り | 高 |
| | NOI | 高 |
| | CCR | 中 |
| | DSCR | 中 |
| | IRR | 中 |
| **税金** | 減価償却 | 高 |
| | 譲渡所得税 | 中 |
| | 法人税 | 低 |
| | 相続税 | 低 |
| | 贈与税 | 低 |
| **ローン** | 住宅ローン | 中 |
| | LTV | 低 |
| **その他** | デッドクロス | 中 |
| | 売却手取り | 中 |

## 実装方針

### 採用案: B案（完全共通化）

SEOページ（`/tools/*`）とマイページ（`/mypage/cf-simulator`）の両方で、同じコンパクト版コンポーネントを使用する。

```
components/calculators/
└── BrokerageCalculatorCompact.tsx  ← 共通コンポーネント

/tools/brokerage (SEOページ)
└── page.tsx
    ├── BrokerageCalculatorCompact  ← コンポーネント使用
    └── SEOコンテンツ（解説文、関連用語など）

/mypage/cf-simulator (シミュレーション画面)
└── BrokerageCalculatorCompact  ← 同じコンポーネント使用
```

**メリット:**
- UIの修正・改善が1箇所で全体に反映
- SEOページとマイページで同じ見た目・挙動
- コンポーネント単体でテストすれば品質担保
- 計算ロジック変更時も1箇所の修正でOK

### 実装ステップ

1. **段階的に実装** - 優先度「高」のツールから着手
2. **コンパクト版作成** - `components/calculators/XxxCalculatorCompact.tsx`
3. **SEOページ反映** - 既存の`/tools/*`をリファクタリング
4. **マイページ反映** - `/mypage/cf-simulator`に組み込み
5. **テスト** - 各コンポーネントの動作確認

## 関連ドキュメント

- [コンパクト版コンポーネント仕様](./01_コンパクト版コンポーネント仕様.md)
- [実装状況](./02_実装状況.md)
