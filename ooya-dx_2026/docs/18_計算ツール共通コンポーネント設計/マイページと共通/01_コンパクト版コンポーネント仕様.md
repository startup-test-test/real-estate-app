# コンパクト版コンポーネント仕様

## 概要

SEOページ（`/tools/*`）と賃貸経営シミュレーション（`/mypage/cf-simulator`）の両方で使用できる、軽量な計算UIコンポーネントの仕様。

## ファイル配置

```
components/calculators/
├── CalculatorBase.tsx              # 共通ベースコンポーネント
├── BrokerageCalculatorCompact.tsx  # 仲介手数料
├── AcquisitionTaxCalculatorCompact.tsx  # 不動産取得税
├── RegistrationTaxCalculatorCompact.tsx # 登録免許税
├── StampTaxCalculatorCompact.tsx   # 印紙税
├── YieldRateCalculatorCompact.tsx  # 利回り
├── NOICalculatorCompact.tsx        # NOI
├── DepreciationCalculatorCompact.tsx # 減価償却
└── index.ts                        # エクスポート
```

## 共通インターフェース

### ベースProps

```typescript
interface CalculatorCompactBaseProps {
  /** 親コンポーネントからのクラス名追加 */
  className?: string;

  /** コンパクト表示モード（trueでより小さく） */
  compact?: boolean;

  /** タイトル表示の有無 */
  showTitle?: boolean;

  /** 計算結果が変わった時のコールバック */
  onResultChange?: (result: any) => void;
}
```

### 各ツール固有のProps例

```typescript
// 仲介手数料
interface BrokerageCalculatorCompactProps extends CalculatorCompactBaseProps {
  /** 初期の売買価格（万円） */
  initialPrice?: number;
}

// 不動産取得税
interface AcquisitionTaxCalculatorCompactProps extends CalculatorCompactBaseProps {
  /** 初期の物件価格（万円） */
  initialPrice?: number;
  /** 初期の用途 */
  initialUsage?: 'residential' | 'non-residential';
  /** 初期の築年数 */
  initialAge?: number;
}
```

## コンポーネント設計

### 基本構造

```tsx
'use client'

import { useState, useMemo, useEffect } from 'react'
import { NumberInput } from '@/components/tools/NumberInput'
import { calculateBrokerageFee } from '@/lib/calculators/brokerage'

interface BrokerageCalculatorCompactProps {
  className?: string
  compact?: boolean
  showTitle?: boolean
  initialPrice?: number
  onResultChange?: (result: BrokerageResult) => void
}

export function BrokerageCalculatorCompact({
  className = '',
  compact = false,
  showTitle = true,
  initialPrice = 0,
  onResultChange,
}: BrokerageCalculatorCompactProps) {
  const [priceInMan, setPriceInMan] = useState(initialPrice)

  // 計算実行
  const result = useMemo(() => {
    return calculateBrokerageFee(priceInMan * 10000)
  }, [priceInMan])

  // 結果が変わったら親に通知
  useEffect(() => {
    onResultChange?.(result)
  }, [result, onResultChange])

  // 親から初期値が変わった場合に同期
  useEffect(() => {
    setPriceInMan(initialPrice)
  }, [initialPrice])

  return (
    <div className={`bg-gray-50 rounded-lg p-4 ${compact ? 'p-3' : 'p-4'} ${className}`}>
      {showTitle && (
        <h3 className={`font-bold text-gray-900 ${compact ? 'text-sm mb-2' : 'text-base mb-3'}`}>
          仲介手数料
        </h3>
      )}

      {/* 入力エリア */}
      <div className="space-y-3">
        <NumberInput
          label="売買価格"
          value={priceInMan}
          onChange={setPriceInMan}
          unit="万円"
          placeholder="例：3000"
          size={compact ? 'sm' : 'md'}
        />
      </div>

      {/* 結果表示 */}
      {priceInMan > 0 && result && (
        <div className={`mt-4 pt-4 border-t border-gray-200 ${compact ? 'mt-3 pt-3' : ''}`}>
          <div className="flex justify-between items-center">
            <span className="text-gray-600 text-sm">仲介手数料（税込）</span>
            <span className={`font-bold text-blue-600 ${compact ? 'text-lg' : 'text-xl'}`}>
              {result.feeWithTax.toLocaleString()}円
            </span>
          </div>
          <div className="flex justify-between items-center mt-1">
            <span className="text-gray-500 text-xs">税抜</span>
            <span className="text-gray-600 text-sm">
              {result.feeWithoutTax.toLocaleString()}円
            </span>
          </div>
        </div>
      )}
    </div>
  )
}
```

## 使用例

### SEOページでの使用

```tsx
// app/tools/brokerage/BrokerageCalculator.tsx
import { BrokerageCalculatorCompact } from '@/components/calculators'

export function BrokerageCalculator() {
  return (
    <div className="min-h-screen">
      <LandingHeader />

      <main>
        <h1>仲介手数料シミュレーター</h1>

        {/* コンパクト版コンポーネントを使用 */}
        <BrokerageCalculatorCompact showTitle={false} />

        {/* SEO用コンテンツ */}
        <section>
          <h2>仲介手数料とは</h2>
          <p>...</p>
        </section>
      </main>

      <LandingFooter />
    </div>
  )
}
```

### シミュレーション画面での使用

```tsx
// app/mypage/cf-simulator/[id]/page.tsx
import {
  BrokerageCalculatorCompact,
  AcquisitionTaxCalculatorCompact,
  RegistrationTaxCalculatorCompact,
} from '@/components/calculators'

export default function SimulatorPage() {
  const [propertyPrice, setPropertyPrice] = useState(5000)
  const [totalCosts, setTotalCosts] = useState({
    brokerage: 0,
    acquisitionTax: 0,
    registrationTax: 0,
  })

  return (
    <div>
      <h1>収益シミュレーション</h1>

      {/* メインのCFシミュレーション */}
      <CashflowSimulator
        propertyPrice={propertyPrice}
        onPriceChange={setPropertyPrice}
      />

      {/* 諸費用計算ツール群 */}
      <section className="mt-8">
        <h2>諸費用シミュレーション</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <BrokerageCalculatorCompact
            initialPrice={propertyPrice}
            compact
            onResultChange={(r) => setTotalCosts(prev => ({ ...prev, brokerage: r.feeWithTax }))}
          />
          <AcquisitionTaxCalculatorCompact
            initialPrice={propertyPrice}
            compact
            onResultChange={(r) => setTotalCosts(prev => ({ ...prev, acquisitionTax: r.tax }))}
          />
          <RegistrationTaxCalculatorCompact
            initialPrice={propertyPrice}
            compact
            onResultChange={(r) => setTotalCosts(prev => ({ ...prev, registrationTax: r.total }))}
          />
        </div>

        {/* 合計表示 */}
        <div className="mt-4 p-4 bg-blue-50 rounded-lg">
          <div className="flex justify-between">
            <span>諸費用合計</span>
            <span className="font-bold text-xl">
              {Object.values(totalCosts).reduce((a, b) => a + b, 0).toLocaleString()}円
            </span>
          </div>
        </div>
      </section>
    </div>
  )
}
```

## スタイルガイドライン

### サイズバリエーション

| モード | padding | タイトル | 結果文字サイズ |
|--------|---------|----------|----------------|
| 通常 (`compact: false`) | p-4 | text-base | text-xl |
| コンパクト (`compact: true`) | p-3 | text-sm | text-lg |

### カラー

| 要素 | カラー |
|------|--------|
| 背景 | `bg-gray-50` |
| タイトル | `text-gray-900` |
| ラベル | `text-gray-600` |
| 結果（メイン） | `text-blue-600` |
| 結果（サブ） | `text-gray-600` |
| ボーダー | `border-gray-200` |

## 注意事項

1. **計算ロジックの変更**
   - `lib/calculators/*.ts` を変更すれば、SEOページとシミュレーション画面の両方に反映される

2. **初期値の同期**
   - `initialPrice` が親から変わった場合、`useEffect` で内部stateを同期する

3. **パフォーマンス**
   - `useMemo` で計算結果をメモ化し、不要な再計算を防ぐ
   - `onResultChange` は結果が実際に変わった時のみ呼び出す

4. **アクセシビリティ**
   - 入力フィールドには適切なラベルを設定
   - フォーカス状態を明確に
