# 大家DX 課題管理表

**最終更新**: 2026年1月8日

---

## 完了済みタスク

### [完了] Render から Vercel への移行

| 項目 | 内容 |
|------|------|
| 完了日 | 2025/01/07 |
| コミット | `2467708` |
| 内容 | Python API を Render から Vercel Python Functions へ完全移行 |

**実施内容:**
- [x] `backend/` フォルダ削除（property-api, simulator-api）
- [x] `lib/config/api.ts` から Render URL 参照を削除
- [x] `lib/config/api.config.ts` を Vercel 用に更新
- [x] `hooks/useApiCall.ts` を Vercel Python Functions 用に更新
- [x] Vercel CLI を dev dependency に追加
- [x] `npm run dev:vercel` スクリプト追加
- [x] Render サービス削除完了（2025/01/07）
- [x] Render 支払い方法削除完了

**動作確認済み:**
- [x] `/api/health` エンドポイント → 正常動作
- [x] `/api/simulate` エンドポイント → 正常動作（バリデーション応答確認）

**本番URL:** https://real-estate-app-seven-silk.vercel.app

---

### [完了] Stripe 決済設定

| 項目 | 内容 |
|------|------|
| 完了日 | 2025/01/07 |
| 環境 | サンドボックス（テストモード） |

**設定済み項目:**
- [x] Stripe API キー設定（.env）
- [x] Price ID 設定: `price_1SjwexBKdvisvdVlavZIUFwn`
- [x] Webhook Secret 設定
- [x] Stripe CLI ログイン・Webhook リスナー動作確認
- [x] 決済フロー動作確認（テスト決済成功）

**注意:** 現在はサンドボックス（テスト）環境です。本番リリース時に本番キーへの切り替えが必要。

---

## 進行中タスク

### [進行中] Stripe アクセス制御

| 項目 | 内容 |
|------|------|
| 優先度 | 最高 |
| 依存 | Stripe設定（完了済み） |
| 設計書 | `docs/Stripe課金システム設計.md` |

**概要:**
有料会員（active/trialing）のみシミュレーターを利用可能にするアクセス制御を実装。

**必要な作業:**
- [ ] `/mypage/simulator/page.tsx` にサブスク確認ロジック追加
- [ ] 未契約ユーザーを `/mypage/billing` へリダイレクト
- [ ] `active` または `trialing` のステータスを許可
- [ ] 動作確認（未契約・トライアル・有料会員）

**実装方法:** サーバーサイド（Server Component）

---

## 未着手タスク

### [未着手] シミュレーション保存機能

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | Stripe アクセス制御 |
| 設計書 | `docs/シミュレーション保存機能設計.md` |

**概要:**
ユーザーが実行したシミュレーション結果をNeonに保存し、後から閲覧・再利用できるようにする。

**必要な作業:**

Phase 1: バックエンド
- [ ] Prisma スキーマに Simulation モデル追加
- [ ] マイグレーション実行
- [ ] `/api/simulations` API 作成（CRUD）

Phase 2: フロントエンド
- [ ] `hooks/useSimulations.ts` 作成
- [ ] SimulatorClient.tsx の保存機能実装
- [ ] 保存済み一覧ページ `/mypage/simulations` 作成

---

### [未着手] Stripe 複数サービス対応

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | なし |
| 設計書 | `docs/Stripe複数サービス設計.md` |

**概要:**
現在のDBスキーマは1ユーザー1契約のみ対応。複数サービス（シミュレーター、AI市場分析、公示地価検索など）を個別契約できるよう拡張が必要。

**必要な作業:**

Phase 1: DB変更
- [ ] `schema.prisma` の更新
  - `userId` の `@unique` 削除
  - `serviceName` カラム追加
  - `stripeCustomerId` の `@unique` 削除
  - 複合ユニーク制約 `@@unique([userId, serviceName])` 追加
- [ ] マイグレーション実行
- [ ] 既存データの移行（`serviceName` に `"simulator"` を設定）

Phase 2: API変更
- [ ] `/api/stripe/checkout` 修正（`serviceName` パラメータ追加）
- [ ] `/api/stripe/webhook` 修正（メタデータに `serviceName` 含める）
- [ ] `/api/stripe/subscription` 修正（サービス別取得対応）

Phase 3: フロントエンド
- [ ] 課金管理ページ更新（複数契約表示）
- [ ] サービス別アクセス制御実装
- [ ] 料金ページ更新

Phase 4: 検証
- [ ] サンドボックス環境でテスト
- [ ] 本番環境へデプロイ

**参考:** 詳細設計は `docs/Stripe複数サービス設計.md` を参照

---

### [未着手] Stripe 本番/開発環境分離

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | テスト環境構築（完了済み） |

**概要:**
現在、本番（main）と開発（develop）で同じStripeサンドボックス環境を使用。本番リリース時に環境を分離する必要あり。

**必要な作業:**
- [ ] Stripe本番アカウントの準備
- [ ] 本番環境（main）にStripe本番キーを設定
- [ ] 開発環境（develop）はサンドボックスを継続使用
- [ ] Webhook URLの環境別設定
- [ ] 動作確認（本番・開発それぞれで決済テスト）

**現状:**
- main: Stripeサンドボックス
- develop: Stripeサンドボックス（同じアカウント）

---

### [未着手] Resend メール送信設定

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | なし |
| 見積り | - |

**必要な作業:**
- [ ] Resend アカウント作成/ログイン
- [ ] API キー取得
- [ ] `.env` に `RESEND_API_KEY` 設定
- [ ] 送信元ドメイン設定（ooya.tech）
- [ ] DNS レコード設定（SPF, DKIM）
- [ ] メールテンプレート作成
  - [ ] ウェルカムメール
  - [ ] パスワードリセット
  - [ ] 契約完了通知
  - [ ] 支払い確認
- [ ] 動作確認

**参考:** StartPack の Resend 実装を使用

---

### [未着手] トップページ改修（総合ポータル化）

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | なし |

**概要:**
現在のシミュレーター特化型から、複数サービス・集客コンテンツを含む総合ポータル型へ改修

**必要な作業:**
- [ ] ヒーローセクション（大家DXブランドメッセージ）
- [ ] サービス一覧カード（シミュレーター、将来サービス）
- [ ] 集客コンテンツ・記事セクション（メディア連携）
- [ ] 料金プラン比較セクション
- [ ] お客様の声・実績セクション
- [ ] FAQ セクション
- [ ] 会社概要セクション

---

### [未着手] WordPress → Vercel 完全移行（メディア機能）

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | トップページ改修 |
| 現状 | ooya.tech/media/ が Xserver + WordPress |

**概要:**
WordPressを廃止し、Vercel上でブログ/メディア機能をスクラッチ開発。Xserver解約可能に。

**必要な作業:**

Phase 1: ブログ機能開発
- [ ] `/media` ルート作成（記事一覧ページ）
- [ ] `/media/[slug]` 作成（記事詳細ページ）
- [ ] MDXファイル管理構造の構築
- [ ] 記事一覧・カテゴリ・タグ機能
- [ ] OGP・SEO対応（メタタグ、サイトマップ）
- [ ] RSS フィード生成

Phase 2: 既存記事移行
- [ ] WordPress記事をMDX形式にエクスポート
- [ ] 画像ファイルの移行
- [ ] 旧URL（ooya.tech/media/*）のリダイレクト設定

Phase 3: ドメイン・DNS設定
- [ ] ooya.tech を Vercel に向ける
- [ ] Xserver 解約

**技術構成:**
```
app/media/
├── page.tsx              ← 記事一覧
└── [slug]/
    └── page.tsx          ← 記事詳細

content/posts/
├── article-1.mdx
├── article-2.mdx
└── ...
```

---

### [未着手] 利用規約の整理

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | トップページ改修 |
| 見積り | - |

**必要な作業:**
- [ ] 統一規約方式 or 商品別規約方式を決定
- [ ] 共通利用規約の作成/更新
- [ ] プライバシーポリシーの更新
- [ ] 特定商取引法に基づく表記の更新
- [ ] 商品固有の規定追加（必要に応じて）

---

### [未着手] 計算ツール開発（SEO集客）

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | なし |
| 参考資料 | `docs/SEO調査/競合ツール一覧_詳細.csv` |

**概要:**
smlt.jp、CASIO等の競合分析に基づき、不動産関連計算ツールを開発。SEO流入でユーザー獲得 → シミュレーター誘導の導線を構築。

**法的確認:** 2026/01/07 弁護士確認済み
- 計算ツール提供 → OK（税理士法・宅建業法・金融商品取引法いずれも問題なし）
- 税務相談・投資助言はしない（免責事項を記載）

**Phase 1: 高トラフィック（smlt.jp競合）**
- [x] 仲介手数料計算（/tools/brokerage）← 作成済み
- [ ] 贈与税計算
- [ ] 不動産取得税計算
- [ ] 登録免許税計算

**Phase 2: 中トラフィック**
- [ ] 譲渡所得税計算
- [ ] 印紙税計算（4種: 不動産契約書、工事請負、その他契約書、領収書）
- [ ] 住宅ローン計算（元利均等）

**Phase 3: 専門系**
- [ ] 相続税計算
- [ ] 法人税計算
- [ ] 減価償却計算
- [ ] 路線価計算（3種）
- [ ] 建物評価（積算価格、標準価格、再調達価格）
- [ ] 消費税按分（3種）

**Phase 4: 大家DXオリジナル**
- [ ] IRR計算（内部収益率）
- [ ] CCR計算（自己資本収益率）
- [ ] DSCR計算（返済余裕率）
- [ ] 積算評価シミュレーション
- [ ] 収益還元法計算

**URL設計:** `/tools/calculators/[tool-name]`

---

### [未着手] 追加サービス実装

| 項目 | 内容 |
|------|------|
| 優先度 | 低 |
| 依存 | トップページ改修、利用規約 |
| 見積り | - |

**計画中のサービス:**
- [ ] サービスB（月額500円）- 内容未定
- [ ] サービスC（月額2,000円）- 内容未定

---

### [未着手] ご利用ガイドページの文言修正

| 項目 | 内容 |
|------|------|
| 優先度 | 低 |
| 依存 | なし |

**概要:**
ご利用ガイドページ（`/mypage/guide`）の「全て無料」等の記載を、現在の料金体系（有料プラン）に合わせて修正。

**必要な作業:**
- [ ] FAQセクションの料金プラン説明を更新
- [ ] 「無料プラン」「無制限」等の記載を確認・修正
- [ ] 有料プラン（月額980円）の説明を正確に記載

---

## 技術的負債

### クリーンアップ済み

- [x] ネストフォルダ削除（`ooya-dx_2026/ooya-dx_2026/`）
- [x] CLAUDE.md を .gitignore に追加

### 残タスク

- [ ] react-joyride の React 19 対応（チュートリアル機能）
- [ ] ローカル開発環境での Python Functions テスト方法確立

---

## 環境情報

| 環境 | URL | 備考 |
|------|-----|------|
| 本番 | https://real-estate-app-seven-silk.vercel.app | Vercel |
| ローカル | http://localhost:3002 | `npm run dev` |
| Stripe | サンドボックス | テストモード |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2025/01/07 | Render → Vercel 移行完了 |
| 2025/01/07 | Stripe サンドボックス設定完了 |
| 2025/01/07 | 課題管理表作成 |
| 2025/01/07 | Render サービス・支払い方法削除完了 |
| 2025/01/07 | ダッシュボードサイドバーナビゲーション追加 |
| 2025/01/07 | Stripe 複数サービス対応を課題に追加 |
| 2025/01/07 | WordPress → Vercel 完全移行を課題に追加 |
| 2025/01/07 | トップページ改修（総合ポータル化）を課題に追加 |
| 2026/01/07 | サイト構造リニューアル完了（ポータル化、/mypage構造） |
| 2026/01/07 | 計算ツール開発（SEO集客）を課題に追加 |
| 2026/01/07 | SEO競合調査完了（smlt.jp、CASIO） |
| 2026/01/08 | Stripe アクセス制御を課題に追加（進行中） |
| 2026/01/08 | シミュレーション保存機能を課題に追加 |
| 2026/01/08 | Stripe課金システム設計.md 作成 |
| 2026/01/08 | シミュレーション保存機能設計.md 作成 |
| 2026/01/08 | billingページのレイアウト二重適用を修正 |
| 2026/01/08 | ご利用ガイドページを/mypage/guideに移動・サイドバーリンク修正 |
| 2026/01/08 | ご利用ガイドページの文言修正を課題に追加 |
| 2026/01/08 | テスト環境構築完了（Neon Branch + Vercel Preview + Git develop） |
| 2026/01/08 | Stripe環境変数をPreview環境に追加 |
| 2026/01/08 | Stripe本番/開発環境分離を課題に追加 |
