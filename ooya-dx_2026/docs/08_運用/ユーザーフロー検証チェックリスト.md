# ユーザーフロー検証チェックリスト

**最終更新**: 2026年1月10日

---

## 概要

新規会員登録 → ログイン → 決済までの一連のユーザーフローを検証するためのチェックリスト。
本番リリース前に全項目を確認すること。

---

## 検証環境

| 環境 | URL | 用途 |
|------|-----|------|
| localhost | http://localhost:3002 | 全機能テスト可能 |
| Vercelプレビュー | https://ooya-dx2026-git-develop-xxx.vercel.app | UI確認用（Auth制限あり） |
| 本番 | （独自ドメイン設定後） | 最終確認 |

**注意**: Basic認証環境（Vercelプレビュー）ではログアウト等が403エラーになる仕様。詳細は `Basic認証とNeonAuth仕様.md` を参照。

---

## フロー1: 新規会員登録

### 1-A: メール/パスワード登録

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 登録ページ表示 | `/auth/signup` にアクセス | 登録フォームが表示される | ⬜ | ⬜ |
| 2 | バリデーション | 空欄で送信 | エラーメッセージ表示 | ⬜ | ⬜ |
| 3 | パスワード要件 | 短いパスワード入力 | 要件不足のエラー表示 | ⬜ | ⬜ |
| 4 | 利用規約同意 | チェックなしで送信 | 同意必須のエラー表示 | ⬜ | ⬜ |
| 5 | 登録実行 | 有効な情報で登録 | 登録成功 | ⬜ | ⬜ |
| 6 | 確認メール受信 | メールボックス確認 | Resendから確認メール届く | ⬜ | ⬜ |
| 7 | メール認証 | メール内リンクをクリック | 認証完了画面表示 | ⬜ | ⬜ |
| 8 | 重複登録防止 | 同じメールで再登録 | 「既に登録済み」エラー | ⬜ | ⬜ |

### 1-B: Google OAuth登録

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | Googleボタン表示 | `/auth/signup` にアクセス | Googleで登録ボタン表示 | ⬜ | ⬜ |
| 2 | Google認証画面 | ボタンをクリック | Google認証画面にリダイレクト | ⬜ | ⬜ |
| 3 | 認証許可 | Googleアカウント選択・許可 | アプリに戻る | ⬜ | ⬜ |
| 4 | ユーザー作成 | 認証完了後 | ユーザーが作成される | ⬜ | ⬜ |
| 5 | マイページ遷移 | 登録完了後 | `/mypage` に遷移 | ⬜ | ⬜ |

---

## フロー2: ログイン

### 2-A: メール/パスワードログイン

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | ログインページ表示 | `/auth/signin` にアクセス | ログインフォーム表示 | ⬜ | ⬜ |
| 2 | 認証失敗 | 間違ったパスワード入力 | エラーメッセージ表示 | ⬜ | ⬜ |
| 3 | 認証成功 | 正しい情報でログイン | ログイン成功 | ⬜ | ⬜ |
| 4 | セッション維持 | ページ更新 | ログイン状態維持 | ⬜ | ⬜ |
| 5 | マイページアクセス | `/mypage` にアクセス | 正常に表示 | ⬜ | ⬜ |

### 2-B: Google OAuthログイン

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | Googleボタン表示 | `/auth/signin` にアクセス | Googleでログインボタン表示 | ⬜ | ⬜ |
| 2 | Google認証 | ボタンをクリック | Google認証画面にリダイレクト | ⬜ | ⬜ |
| 3 | ログイン完了 | アカウント選択 | マイページに遷移 | ⬜ | ⬜ |

### 2-C: パスワードリセット

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | リセットリンク表示 | ログインページ確認 | 「パスワードを忘れた方」リンク表示 | ⬜ | ⬜ |
| 2 | リセットページ | リンクをクリック | メール入力フォーム表示 | ⬜ | ⬜ |
| 3 | リセットメール送信 | メールアドレス入力・送信 | 「メールを送信しました」表示 | ⬜ | ⬜ |
| 4 | リセットメール受信 | メールボックス確認 | リセットリンク付きメール届く | ⬜ | ⬜ |
| 5 | 新パスワード設定 | リンクをクリック・新パスワード入力 | パスワード変更完了 | ⬜ | ⬜ |
| 6 | 新パスワードでログイン | 新しいパスワードでログイン | ログイン成功 | ⬜ | ⬜ |

### 2-D: ログアウト

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | ログアウトボタン | ヘッダーのユーザーメニュー確認 | ログアウトボタン表示 | ⬜ | ⬜ |
| 2 | ログアウト実行 | ボタンをクリック | ログアウト成功 | ⬜ | ⬜ |
| 3 | セッション破棄 | `/mypage` にアクセス | ログインページにリダイレクト | ⬜ | ⬜ |

---

## フロー3: 決済（Stripe）

### 3-A: 課金ページアクセス

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 課金ページ表示 | ログイン後 `/mypage/billing` にアクセス | 料金プラン表示 | ⬜ | ⬜ |
| 2 | 未契約状態 | 新規ユーザーで確認 | 「今すぐ登録」ボタン表示 | ⬜ | ⬜ |
| 3 | プラン詳細 | ページ内容確認 | 月額980円、1ヶ月無料トライアル表示 | ⬜ | ⬜ |

### 3-B: 決済フロー（トライアル登録）

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | Checkout開始 | 「今すぐ登録」クリック | Stripe Checkoutにリダイレクト | ⬜ | ⬜ |
| 2 | 決済情報入力 | カード情報入力 | 入力フォーム正常動作 | ⬜ | ⬜ |
| 3 | テストカード | `4242 4242 4242 4242` 使用 | 決済処理開始 | ⬜ | ⬜ |
| 4 | 決済完了 | 送信ボタンクリック | 成功画面表示 | ⬜ | ⬜ |
| 5 | リダイレクト | 決済完了後 | `/mypage/billing?success=true` に遷移 | ⬜ | ⬜ |
| 6 | Webhook処理 | サーバーログ確認 | `checkout.session.completed` 受信 | ⬜ | ⬜ |
| 7 | DB更新 | Subscriptionテーブル確認 | レコード作成、status=trialing | ⬜ | ⬜ |
| 8 | 契約状態表示 | 課金ページ再読み込み | 「トライアル中」表示 | ⬜ | ⬜ |

### 3-C: シミュレーターアクセス制御

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 未契約でアクセス | 未契約ユーザーで `/mypage/simulator` | `/mypage/billing` にリダイレクト | ⬜ | ⬜ |
| 2 | トライアル中アクセス | トライアル中ユーザーでアクセス | シミュレーター表示 | ⬜ | ⬜ |
| 3 | 有料会員アクセス | active状態ユーザーでアクセス | シミュレーター表示 | ⬜ | ⬜ |
| 4 | 解約後アクセス | canceled状態ユーザーでアクセス | `/mypage/billing` にリダイレクト | ⬜ | ⬜ |

### 3-D: サブスクリプション管理

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 管理ボタン表示 | 契約中に課金ページ確認 | 「サブスクリプションを管理」ボタン表示 | ⬜ | ⬜ |
| 2 | Customer Portal | ボタンをクリック | Stripe Customer Portal開く | ⬜ | ⬜ |
| 3 | プラン確認 | ポータル内確認 | 現在のプラン表示 | ⬜ | ⬜ |
| 4 | 支払い方法変更 | カード変更 | 正常に更新 | ⬜ | ⬜ |
| 5 | 請求履歴 | 履歴タブ確認 | 過去の請求表示 | ⬜ | ⬜ |

### 3-E: 解約フロー

| # | 検証項目 | 手順 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | 解約ボタン | Customer Portalで確認 | 「プランをキャンセル」ボタン表示 | ⬜ | ⬜ |
| 2 | 解約実行 | キャンセルをクリック | 確認画面表示 | ⬜ | ⬜ |
| 3 | 解約確定 | 確認ボタンクリック | 解約予約完了 | ⬜ | ⬜ |
| 4 | Webhook処理 | サーバーログ確認 | `customer.subscription.updated` 受信 | ⬜ | ⬜ |
| 5 | DB更新 | Subscriptionテーブル確認 | `cancelAtPeriodEnd=true` | ⬜ | ⬜ |
| 6 | 期間終了まで利用可能 | シミュレーターアクセス | 引き続き利用可能 | ⬜ | ⬜ |
| 7 | 期間終了後 | 期間終了日経過後 | アクセス不可、status=canceled | ⬜ | ⬜ |

---

## フロー4: 統合テスト（エンドツーエンド）

### 完全な新規ユーザージャーニー

| # | ステップ | 詳細 | 期待結果 | localhost | 本番 |
|---|---------|------|---------|-----------|------|
| 1 | トップページ訪問 | `/` にアクセス | サービス概要表示 | ⬜ | ⬜ |
| 2 | 無料登録クリック | ヘッダーの「無料登録」 | 登録ページに遷移 | ⬜ | ⬜ |
| 3 | アカウント作成 | メール/パスワードで登録 | 登録成功 | ⬜ | ⬜ |
| 4 | メール認証 | 確認メールのリンククリック | 認証完了 | ⬜ | ⬜ |
| 5 | シミュレーターへ | `/mypage/simulator` クリック | 課金ページにリダイレクト | ⬜ | ⬜ |
| 6 | トライアル開始 | 「今すぐ登録」クリック | Stripe Checkout表示 | ⬜ | ⬜ |
| 7 | 決済情報入力 | テストカード入力 | 決済成功 | ⬜ | ⬜ |
| 8 | シミュレーター利用 | `/mypage/simulator` アクセス | シミュレーター表示 | ⬜ | ⬜ |
| 9 | シミュレーション実行 | 物件情報入力・計算 | 結果表示 | ⬜ | ⬜ |
| 10 | ログアウト | ヘッダーからログアウト | トップページに戻る | ⬜ | ⬜ |
| 11 | 再ログイン | 同じアカウントでログイン | マイページ表示 | ⬜ | ⬜ |
| 12 | 契約確認 | `/mypage/billing` 確認 | トライアル中表示 | ⬜ | ⬜ |

---

## テストカード情報（Stripeサンドボックス）

| カード番号 | 説明 |
|-----------|------|
| `4242 4242 4242 4242` | 成功 |
| `4000 0000 0000 0002` | カード拒否 |
| `4000 0000 0000 9995` | 残高不足 |
| `4000 0025 0000 3155` | 3Dセキュア認証 |

**有効期限**: 未来の任意の日付（例: 12/34）
**CVC**: 任意の3桁（例: 123）

---

## 検証記録

### 検証実施日

| 日付 | 検証者 | 環境 | 結果 | 備考 |
|------|--------|------|------|------|
| | | | | |

### 発見した問題

| # | 発見日 | 問題内容 | 対応状況 | 修正日 |
|---|--------|---------|---------|--------|
| | | | | |

---

## 関連ドキュメント

- `docs/03_課金システム/Stripe課金システム設計.md` - 課金システム詳細設計
- `docs/08_運用/課題管理表.md` - 実装状況・課題一覧
- `docs/08_運用/Basic認証とNeonAuth仕様.md` - 認証環境の制限事項
- `docs/09_トラブルシューティング/troubleshooting-neon-auth.md` - 認証トラブルシューティング
