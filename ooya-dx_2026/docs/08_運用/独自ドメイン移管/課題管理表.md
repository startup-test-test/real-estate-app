# 大家DX 課題管理表

**最終更新**: 2026年1月9日

---

## 完了済みタスク

### [完了] Render から Vercel への移行

| 項目 | 内容 |
|------|------|
| 完了日 | 2025/01/07 |
| コミット | `2467708` |
| 内容 | Python API を Render から Vercel Python Functions へ完全移行 |

**実施内容:**
- [x] `backend/` フォルダ削除（property-api, simulator-api）
- [x] `lib/config/api.ts` から Render URL 参照を削除
- [x] `lib/config/api.config.ts` を Vercel 用に更新
- [x] `hooks/useApiCall.ts` を Vercel Python Functions 用に更新
- [x] Vercel CLI を dev dependency に追加
- [x] `npm run dev:vercel` スクリプト追加
- [x] Render サービス削除完了（2025/01/07）
- [x] Render 支払い方法削除完了

**動作確認済み:**
- [x] `/api/health` エンドポイント → 正常動作
- [x] `/api/simulate` エンドポイント → 正常動作（バリデーション応答確認）

**本番URL:** https://real-estate-app-seven-silk.vercel.app

---

### [完了] Stripe 決済設定

| 項目 | 内容 |
|------|------|
| 完了日 | 2025/01/07 |
| 環境 | サンドボックス（テストモード） |

**設定済み項目:**
- [x] Stripe API キー設定（.env）
- [x] Price ID 設定: `price_1SjwexBKdvisvdVlavZIUFwn`
- [x] Webhook Secret 設定
- [x] Stripe CLI ログイン・Webhook リスナー動作確認
- [x] 決済フロー動作確認（テスト決済成功）

**注意:** 現在はサンドボックス（テスト）環境です。本番リリース時に本番キーへの切り替えが必要。

---

### [完了] トップページ改修（総合ポータル化）

| 項目 | 内容 |
|------|------|
| 完了日 | 2026/01/09 |
| コミット | `6ebc34f` |

**実施内容:**
- [x] GMO賃貸DXスタイルにリニューアル
- [x] ヒーローセクション（大家DXブランドメッセージ）
- [x] サービス一覧カード
- [x] メディア掲載・ニュースセクション
- [x] 計算ツールセクション
- [x] 運営情報セクション

---

### [完了] 認証ページデザイン刷新

| 項目 | 内容 |
|------|------|
| 完了日 | 2026/01/09 |
| コミット | `6ebc34f` |

**実施内容:**
- [x] signin/signupページを本番デザインに統一
- [x] 大家DXロゴ + タグライン
- [x] Googleログイン/登録ボタン
- [x] アイコン付き入力フォーム
- [x] 利用規約同意チェックボックス
- [x] SSL暗号化通信の表示

---

### [完了] プロフィールページ作成

| 項目 | 内容 |
|------|------|
| 完了日 | 2026/01/09 |
| コミット | `6ebc34f` |

**実施内容:**
- [x] `/media/profile/` ページを本番サイトに合わせて作成
- [x] 投資用不動産と自己居住用の購入実績を分離
- [x] 物件画像・詳細情報を追加
- [x] メディア出演リンク追加

---

### [完了] 名称変更・リンク修正

| 項目 | 内容 |
|------|------|
| 完了日 | 2026/01/09 |
| コミット | `6ebc34f` |

**実施内容:**
- [x] 「収益シミュレーター」→「賃貸経営シミュレーター」に名称変更
- [x] フッターリンク修正: /terms → /legal/terms 等
- [x] scroll-smooth削除（記事ページのスクロール問題修正）
- [x] Newsセクション幅をmax-w-7xlに統一

---

## 進行中タスク

### [進行中] Stripe アクセス制御

| 項目 | 内容 |
|------|------|
| 優先度 | 最高 |
| 依存 | Stripe設定（完了済み） |
| 設計書 | `docs/Stripe課金システム設計.md` |

**概要:**
有料会員（active/trialing）のみシミュレーターを利用可能にするアクセス制御を実装。

**必要な作業:**
- [ ] `/mypage/simulator/page.tsx` にサブスク確認ロジック追加
- [ ] 未契約ユーザーを `/mypage/billing` へリダイレクト
- [ ] `active` または `trialing` のステータスを許可
- [ ] 動作確認（未契約・トライアル・有料会員）

**実装方法:** サーバーサイド（Server Component）

---

### [進行中] シミュレーション保存機能

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | Stripe アクセス制御 |
| 設計書 | `docs/シミュレーション保存機能設計.md` |

**概要:**
ユーザーが実行したシミュレーション結果をNeonに保存し、後から閲覧・再利用できるようにする。

**進捗:**

Phase 1: バックエンド ✅ 完了
- [x] Prisma スキーマに Simulation モデル追加
- [x] マイグレーション実行
- [x] `/api/simulations` API 作成（CRUD）

Phase 2: フロントエンド 🔄 一部完了
- [ ] `hooks/useSimulations.ts` 作成
- [ ] SimulatorClient.tsx の保存機能実装
- [ ] 保存済み一覧ページ `/mypage/simulations` 作成

---

## 未着手タスク

### [未着手] Stripe 複数サービス対応

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | なし |
| 設計書 | `docs/Stripe複数サービス設計.md` |

**概要:**
現在のDBスキーマは1ユーザー1契約のみ対応。複数サービス（シミュレーター、AI市場分析、公示地価検索など）を個別契約できるよう拡張が必要。

**必要な作業:**

Phase 1: DB変更
- [ ] `schema.prisma` の更新
  - `userId` の `@unique` 削除
  - `serviceName` カラム追加
  - `stripeCustomerId` の `@unique` 削除
  - 複合ユニーク制約 `@@unique([userId, serviceName])` 追加
- [ ] マイグレーション実行
- [ ] 既存データの移行（`serviceName` に `"simulator"` を設定）

Phase 2: API変更
- [ ] `/api/stripe/checkout` 修正（`serviceName` パラメータ追加）
- [ ] `/api/stripe/webhook` 修正（メタデータに `serviceName` 含める）
- [ ] `/api/stripe/subscription` 修正（サービス別取得対応）

Phase 3: フロントエンド
- [ ] 課金管理ページ更新（複数契約表示）
- [ ] サービス別アクセス制御実装
- [ ] 料金ページ更新

Phase 4: 検証
- [ ] サンドボックス環境でテスト
- [ ] 本番環境へデプロイ

**参考:** 詳細設計は `docs/Stripe複数サービス設計.md` を参照

---

### [未着手] Stripe 本番/開発環境分離

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | テスト環境構築（完了済み） |

**概要:**
現在、本番（main）と開発（develop）で同じStripeサンドボックス環境を使用。本番リリース時に環境を分離する必要あり。

**必要な作業:**
- [ ] Stripe本番アカウントの準備
- [ ] 本番環境（main）にStripe本番キーを設定
- [ ] 開発環境（develop）はサンドボックスを継続使用
- [ ] Webhook URLの環境別設定
- [ ] 動作確認（本番・開発それぞれで決済テスト）

**現状:**
- main: Stripeサンドボックス
- develop: Stripeサンドボックス（同じアカウント）

---

### [進行中] 独自ドメイン移行・Vercel本番設定

| 項目 | 内容 |
|------|------|
| 優先度 | 最高 |
| 依存 | Resend設定、Neon Auth設定 |

**概要:**
独自ドメインへの移行とVercel本番環境の設定。認証・決済機能の本番稼働に必要な設定を段階的に実施。

---

#### 1. 新規会員登録機能

| ステップ | 環境 | 作業内容 | 状態 |
|---------|------|----------|------|
| 1-1 | 開発 | メール/パスワード登録実装 | ✅ 完了 |
| 1-2 | 開発 | Google OAuth登録実装 | ✅ 完了 |
| 1-3 | 開発 | Resend APIキー取得・設定 | ✅ 完了 |
| 1-4 | 開発 | Neon Auth Custom SMTP設定（dev） | ✅ 完了 |
| 1-5 | 開発 | Verify at Sign-up有効化 | ✅ 完了 |
| 1-6 | 開発 | Vercel PreviewのDomain追加 | ✅ 完了 |
| 1-7 | 開発 | メール認証フローテスト | ⏳ 確認中 |
| 1-8 | 本番 | Neon Auth Custom SMTP設定（prod） | ⬜ 未着手 |
| 1-9 | 本番 | 独自ドメインをNeon Auth Domainsに追加 | ⬜ 未着手 |
| 1-10 | 本番 | Resend独自ドメイン設定（DNS） | ⬜ 未着手 |
| 1-11 | 本番 | 本番環境でメール認証テスト | ⬜ 未着手 |

---

#### 2. ログイン機能

| ステップ | 環境 | 作業内容 | 状態 |
|---------|------|----------|------|
| 2-1 | 開発 | メール/パスワードログイン実装 | ✅ 完了 |
| 2-2 | 開発 | Google OAuthログイン実装 | ✅ 完了 |
| 2-3 | 開発 | セッション管理確認 | ✅ 完了 |
| 2-4 | 開発 | パスワードリセット機能 | ✅ 完了 |
| 2-5 | 本番 | 本番環境でログインテスト | ⬜ 未着手 |
| 2-6 | 本番 | Google OAuth本番設定（リダイレクトURI） | ⬜ 未着手 |

---

#### 3. Stripe決済機能

| ステップ | 環境 | 作業内容 | 状態 |
|---------|------|----------|------|
| 3-1 | 開発 | Stripeサンドボックス設定 | ✅ 完了 |
| 3-2 | 開発 | Checkout Session実装 | ✅ 完了 |
| 3-3 | 開発 | Webhook受信・処理実装 | ✅ 完了 |
| 3-4 | 開発 | サブスクリプション管理実装 | ✅ 完了 |
| 3-5 | 開発 | Customer Portal連携 | ✅ 完了 |
| 3-6 | 本番 | Stripe本番アカウント作成 | ⬜ 未着手 |
| 3-7 | 本番 | 本番APIキー取得・Vercel設定 | ⬜ 未着手 |
| 3-8 | 本番 | 本番Price ID作成 | ⬜ 未着手 |
| 3-9 | 本番 | 本番Webhook Endpoint設定 | ⬜ 未着手 |
| 3-10 | 本番 | 本番環境で決済テスト | ⬜ 未着手 |

---

#### 4. 独自ドメイン設定

| ステップ | 作業内容 | 状態 |
|---------|----------|------|
| 4-1 | ドメイン取得（ooya-dx.com等） | ⬜ 未着手 |
| 4-2 | VercelにCustom Domain追加 | ⬜ 未着手 |
| 4-3 | DNS設定（CNAMEレコード） | ⬜ 未着手 |
| 4-4 | SSL証明書自動発行確認 | ⬜ 未着手 |
| 4-5 | Neon Auth Domainsに独自ドメイン追加 | ⬜ 未着手 |
| 4-6 | Google OAuthリダイレクトURI更新 | ⬜ 未着手 |
| 4-7 | Stripe Webhook URL更新 | ⬜ 未着手 |
| 4-8 | Resend送信元ドメイン設定 | ⬜ 未着手 |

---

#### 環境変数一覧（本番設定が必要なもの）

| 変数名 | 開発 | 本番 | 備考 |
|--------|------|------|------|
| `NEXT_PUBLIC_NEON_AUTH_URL` | development | production | ブランチ別 |
| `NEON_AUTH_BASE_URL` | development | production | ブランチ別 |
| `RESEND_API_KEY` | dev用キー | main用キー | 用途別 |
| `STRIPE_SECRET_KEY` | sk_test_xxx | sk_live_xxx | 本番キー必要 |
| `STRIPE_PUBLISHABLE_KEY` | pk_test_xxx | pk_live_xxx | 本番キー必要 |
| `STRIPE_PRICE_ID` | テスト用 | 本番用 | 要作成 |
| `STRIPE_WEBHOOK_SECRET` | テスト用 | 本番用 | 要作成 |

---

### [完了] Resend メール送信設定

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 完了日 | 2026/01/10 |

**完了した作業:**
- [x] Resend アカウント作成/ログイン
- [x] API キー取得（main/dev分離）
- [x] `.env` に `RESEND_API_KEY` 設定
- [x] Neon Auth Custom SMTP設定

**残作業（独自ドメイン移行時）:**
- [ ] 送信元ドメイン設定（ooya-dx.com等）
- [ ] DNS レコード設定（SPF, DKIM）

---

### [未着手] WordPress → Vercel 完全移行（メディア機能）

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | トップページ改修（完了） |
| 現状 | ooya.tech/media/ が Xserver + WordPress |

**概要:**
WordPressを廃止し、Vercel上でブログ/メディア機能をスクラッチ開発。Xserver解約可能に。

**進捗:**

Phase 1: ブログ機能開発 ✅ 完了
- [x] `/media` ルート作成（記事一覧ページ）
- [x] `/media/[category]/[slug]` 作成（記事詳細ページ）
- [x] MDXファイル管理構造の構築
- [x] 記事一覧・カテゴリ機能
- [x] `/media/profile` プロフィールページ作成

Phase 2: 既存記事移行 ✅ 完了
- [x] WordPress記事をMDX形式にエクスポート（13記事）
- [x] 画像ファイルの移行

Phase 3: ドメイン・DNS設定 ⏳ 未着手
- [ ] ooya.tech を Vercel に向ける
- [ ] 旧URL（ooya.tech/media/*）のリダイレクト設定
- [ ] Xserver 解約

---

### [未着手] 利用規約の整理

| 項目 | 内容 |
|------|------|
| 優先度 | 中 |
| 依存 | なし |
| 見積り | - |

**必要な作業:**
- [ ] 統一規約方式 or 商品別規約方式を決定
- [ ] 共通利用規約の作成/更新
- [ ] プライバシーポリシーの更新
- [ ] 特定商取引法に基づく表記の更新
- [ ] 商品固有の規定追加（必要に応じて）

---

### [未着手] 計算ツール開発（SEO集客）

| 項目 | 内容 |
|------|------|
| 優先度 | 高 |
| 依存 | なし |
| 参考資料 | `docs/SEO調査/競合ツール一覧_詳細.csv` |

**概要:**
smlt.jp、CASIO等の競合分析に基づき、不動産関連計算ツールを開発。SEO流入でユーザー獲得 → シミュレーター誘導の導線を構築。

**法的確認:** 2026/01/07 弁護士確認済み
- 計算ツール提供 → OK（税理士法・宅建業法・金融商品取引法いずれも問題なし）
- 税務相談・投資助言はしない（免責事項を記載）

**Phase 1: 高トラフィック（smlt.jp競合）**
- [x] 仲介手数料計算（/tools/brokerage）← 作成済み
- [ ] 贈与税計算
- [ ] 不動産取得税計算
- [ ] 登録免許税計算

**Phase 2: 中トラフィック**
- [ ] 譲渡所得税計算
- [ ] 印紙税計算（4種: 不動産契約書、工事請負、その他契約書、領収書）
- [ ] 住宅ローン計算（元利均等）

**Phase 3: 専門系**
- [ ] 相続税計算
- [ ] 法人税計算
- [ ] 減価償却計算
- [ ] 路線価計算（3種）
- [ ] 建物評価（積算価格、標準価格、再調達価格）
- [ ] 消費税按分（3種）

**Phase 4: 大家DXオリジナル**
- [ ] IRR計算（内部収益率）
- [ ] CCR計算（自己資本収益率）
- [ ] DSCR計算（返済余裕率）
- [ ] 積算評価シミュレーション
- [ ] 収益還元法計算

**URL設計:** `/tools/calculators/[tool-name]`

---

### [未着手] 追加サービス実装

| 項目 | 内容 |
|------|------|
| 優先度 | 低 |
| 依存 | Stripe複数サービス対応、利用規約 |
| 見積り | - |

**計画中のサービス:**
- [ ] サービスB（月額500円）- 内容未定
- [ ] サービスC（月額2,000円）- 内容未定

---

### [未着手] ご利用ガイドページの文言修正

| 項目 | 内容 |
|------|------|
| 優先度 | 低 |
| 依存 | なし |

**概要:**
ご利用ガイドページ（`/mypage/guide`）の「全て無料」等の記載を、現在の料金体系（有料プラン）に合わせて修正。

**必要な作業:**
- [ ] FAQセクションの料金プラン説明を更新
- [ ] 「無料プラン」「無制限」等の記載を確認・修正
- [ ] 有料プラン（月額980円）の説明を正確に記載

---

## 技術的負債

### クリーンアップ済み

- [x] ネストフォルダ削除（`ooya-dx_2026/ooya-dx_2026/`）
- [x] CLAUDE.md を .gitignore に追加

### 残タスク

- [ ] react-joyride の React 19 対応（チュートリアル機能）
- [ ] チュートリアルを非表示にする（react-joyride対応まで）
- [ ] ローカル開発環境での Python Functions テスト方法確立

---

## 環境情報

| 環境 | URL | 備考 |
|------|-----|------|
| 本番 | https://real-estate-app-seven-silk.vercel.app | Vercel |
| ローカル | http://localhost:3002 | `npm run dev` |
| Stripe | サンドボックス | テストモード |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2025/01/07 | Render → Vercel 移行完了 |
| 2025/01/07 | Stripe サンドボックス設定完了 |
| 2025/01/07 | 課題管理表作成 |
| 2025/01/07 | Render サービス・支払い方法削除完了 |
| 2025/01/07 | ダッシュボードサイドバーナビゲーション追加 |
| 2025/01/07 | Stripe 複数サービス対応を課題に追加 |
| 2025/01/07 | WordPress → Vercel 完全移行を課題に追加 |
| 2025/01/07 | トップページ改修（総合ポータル化）を課題に追加 |
| 2026/01/07 | サイト構造リニューアル完了（ポータル化、/mypage構造） |
| 2026/01/07 | 計算ツール開発（SEO集客）を課題に追加 |
| 2026/01/07 | SEO競合調査完了（smlt.jp、CASIO） |
| 2026/01/08 | Stripe アクセス制御を課題に追加（進行中） |
| 2026/01/08 | シミュレーション保存機能を課題に追加 |
| 2026/01/08 | Stripe課金システム設計.md 作成 |
| 2026/01/08 | シミュレーション保存機能設計.md 作成 |
| 2026/01/08 | billingページのレイアウト二重適用を修正 |
| 2026/01/08 | ご利用ガイドページを/mypage/guideに移動・サイドバーリンク修正 |
| 2026/01/08 | ご利用ガイドページの文言修正を課題に追加 |
| 2026/01/08 | テスト環境構築完了（Neon Branch + Vercel Preview + Git develop） |
| 2026/01/08 | Stripe環境変数をPreview環境に追加 |
| 2026/01/08 | Stripe本番/開発環境分離を課題に追加 |
| 2026/01/09 | トップページ改修（GMO賃貸DXスタイル）完了 |
| 2026/01/09 | プロフィールページ作成完了 |
| 2026/01/09 | 認証ページデザイン刷新完了 |
| 2026/01/09 | 名称変更・リンク修正完了 |
| 2026/01/09 | シミュレーション保存機能を進行中に変更（バックエンド完了、フロントエンド一部残） |
| 2026/01/09 | WordPress移行を進行中に変更（記事移行完了、DNS設定残） |
