<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç’°å¢ƒåˆ¤å®šãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .info-box {
            background: #f0f8ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-title {
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
        }
        .result {
            font-family: 'Courier New', monospace;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f2f2f2;
            font-weight: bold;
        }
        .api-url {
            color: #2196F3;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ APIç’°å¢ƒåˆ¤å®šãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="info-box">
            <strong>ã“ã®ãƒšãƒ¼ã‚¸ã¯ç’°å¢ƒåˆ¤å®šæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</strong><br>
            ç¾åœ¨ã®ãƒ›ã‚¹ãƒˆåã‹ã‚‰é©åˆ‡ãªRender APIã‚’é¸æŠã—ã¾ã™ã€‚
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“ ç¾åœ¨ã®ç’°å¢ƒæƒ…å ±</div>
            <div id="current-env" class="result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸŒ ãƒ›ã‚¹ãƒˆåˆ¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
            <p>å„ç’°å¢ƒã§ã©ã®APIãŒé¸æŠã•ã‚Œã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š</p>
            <table id="simulation-table">
                <thead>
                    <tr>
                        <th>ãƒ›ã‚¹ãƒˆå</th>
                        <th>åˆ¤å®šã•ã‚Œã‚‹ç’°å¢ƒ</th>
                        <th>ä½¿ç”¨ã•ã‚Œã‚‹API</th>
                    </tr>
                </thead>
                <tbody id="simulation-results"></tbody>
            </table>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸš€ APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</div>
            <button onclick="testApiConnection()">APIãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</button>
            <div id="api-test-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“‹ ãƒ‡ãƒãƒƒã‚°æƒ…å ±</div>
            <button onclick="showDebugInfo()">è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º</button>
            <div id="debug-info" class="result" style="display:none;"></div>
        </div>
    </div>

    <script type="module">
        // ç’°å¢ƒåˆ¤å®šã®ãƒ†ã‚¹ãƒˆå®Ÿè£…
        const Environment = {
            PRODUCTION: 'production',
            DEVELOPMENT: 'development',
            CODESPACES: 'codespaces',
            LOCAL: 'local'
        };

        const API_URLS = {
            [Environment.PRODUCTION]: 'https://real-estate-app-1-iii4.onrender.com',
            [Environment.DEVELOPMENT]: 'https://real-estate-app-rwf1.onrender.com',
            [Environment.CODESPACES]: 'https://real-estate-app-rwf1.onrender.com',
            [Environment.LOCAL]: 'https://real-estate-app-rwf1.onrender.com'
        };

        function getEnvironment(hostname) {
            if (hostname === 'ooya.tech') {
                return Environment.PRODUCTION;
            }
            if (hostname === 'dev.ooya.tech') {
                return Environment.DEVELOPMENT;
            }
            if (hostname.includes('.app.github.dev')) {
                return Environment.CODESPACES;
            }
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return Environment.LOCAL;
            }
            return Environment.DEVELOPMENT;
        }

        function getApiUrl(hostname) {
            const env = getEnvironment(hostname);
            return API_URLS[env];
        }

        // ç¾åœ¨ã®ç’°å¢ƒã‚’è¡¨ç¤º
        function displayCurrentEnvironment() {
            const hostname = window.location.hostname;
            const port = window.location.port;
            const env = getEnvironment(hostname);
            const apiUrl = getApiUrl(hostname);

            const html = `
                <table>
                    <tr><td><strong>ãƒ›ã‚¹ãƒˆå:</strong></td><td>${hostname}</td></tr>
                    <tr><td><strong>ãƒãƒ¼ãƒˆ:</strong></td><td>${port || '(ãªã—)'}</td></tr>
                    <tr><td><strong>ç’°å¢ƒ:</strong></td><td><span class="success">${env}</span></td></tr>
                    <tr><td><strong>API URL:</strong></td><td><a href="${apiUrl}" target="_blank" class="api-url">${apiUrl}</a></td></tr>
                </table>
            `;
            document.getElementById('current-env').innerHTML = html;
        }

        // ãƒ›ã‚¹ãƒˆåˆ¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateEnvironments() {
            const testCases = [
                { hostname: 'localhost', description: 'ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º' },
                { hostname: '127.0.0.1', description: 'ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆIPï¼‰' },
                { hostname: 'ominous-happiness-q7r697r6gq93xjxq-5173.app.github.dev', description: 'Codespaces' },
                { hostname: 'dev.ooya.tech', description: 'é–‹ç™ºç’°å¢ƒ' },
                { hostname: 'ooya.tech', description: 'æœ¬ç•ªç’°å¢ƒ' },
                { hostname: 'unknown.domain.com', description: 'ä¸æ˜ãªãƒ‰ãƒ¡ã‚¤ãƒ³' }
            ];

            const tbody = document.getElementById('simulation-results');
            tbody.innerHTML = '';

            testCases.forEach(test => {
                const env = getEnvironment(test.hostname);
                const apiUrl = getApiUrl(test.hostname);
                const row = `
                    <tr>
                        <td>${test.hostname}<br><small>${test.description}</small></td>
                        <td>${env}</td>
                        <td><small>${apiUrl}</small></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        window.testApiConnection = async function() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ ãƒ†ã‚¹ãƒˆä¸­...';

            const hostname = window.location.hostname;
            const apiUrl = getApiUrl(hostname);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${apiUrl}/`, {
                    method: 'GET',
                    mode: 'cors'
                });
                const endTime = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <span class="success">âœ… æ¥ç¶šæˆåŠŸ!</span><br>
                        ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${endTime - startTime}ms<br>
                        APIãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${JSON.stringify(data, null, 2)}
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ ã‚¨ãƒ©ãƒ¼: HTTP ${response.status}</span><br>
                        ${response.statusText}
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼</span><br>
                    ${error.message}<br>
                    <small>CORSã‚¨ãƒ©ãƒ¼ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</small>
                `;
            }
        };

        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
        window.showDebugInfo = function() {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.style.display = 'block';
            
            const info = {
                'User Agent': navigator.userAgent,
                'Protocol': window.location.protocol,
                'Hostname': window.location.hostname,
                'Port': window.location.port || '(default)',
                'Pathname': window.location.pathname,
                'Full URL': window.location.href,
                'Environment': getEnvironment(window.location.hostname),
                'API URL': getApiUrl(window.location.hostname),
                'Timestamp': new Date().toISOString()
            };

            let html = '<table>';
            for (const [key, value] of Object.entries(info)) {
                html += `<tr><td><strong>${key}:</strong></td><td>${value}</td></tr>`;
            }
            html += '</table>';
            
            debugDiv.innerHTML = html;
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        displayCurrentEnvironment();
        simulateEnvironments();
    </script>
</body>
</html>