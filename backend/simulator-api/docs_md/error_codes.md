# エラーコード一覧

## 概要
本ドキュメントでは、不動産投資シミュレーターAPIで発生する可能性のあるエラーコードとその対処法を説明します。

## エラーコード体系

エラーコードは以下の体系で分類されています：

- **E4xxx**: バリデーションエラー（入力値の検証エラー）
- **E5xxx**: 計算エラー（シミュレーション計算中のエラー）
- **E55xx**: システムエラー（サーバー側の内部エラー）
- **E6xxx**: 外部APIエラー（外部サービス連携のエラー）

## バリデーションエラー (E4xxx)

### E4001: 必須項目未入力
**説明**: 必須項目が入力されていません。  
**対処法**: 赤色で表示されている必須項目を入力してください。  
**発生例**: 物件名、所在地などの必須フィールドが空の場合

### E4002: 入力値範囲外
**説明**: 入力値が有効範囲外です。  
**対処法**: 入力値を有効な範囲内に修正してください。  
**発生例**: 
- 金額がマイナス値
- パーセンテージが0-100の範囲外
- 年数が異常に大きい値

### E4003: 入力形式不正
**説明**: 入力形式が正しくありません。  
**対処法**: 正しい形式で入力してください。  
**発生例**: 数値項目に文字列が入力された場合

### E4004: HTMLタグ検出
**説明**: セキュリティ上の理由でHTMLタグは許可されていません。  
**対処法**: HTMLタグを除去して再入力してください。  
**発生例**: メモ欄にHTMLタグが含まれている場合

### E4005: URL形式不正
**説明**: URLの形式が正しくありません。  
**対処法**: https://で始まる正しいURL形式で入力してください。  
**発生例**: 物件URLが不正な形式の場合

### E4006: 画像サイズ超過
**説明**: 画像サイズが大きすぎます。  
**対処法**: 10MB以下の画像を使用してください。  
**発生例**: 物件画像が10MBを超えている場合

### E4007: 文字数超過
**説明**: 文字数が制限を超えています。  
**対処法**: 文字数を減らして再入力してください。  
**発生例**: 
- 物件名が100文字超
- メモが1000文字超

## 計算エラー (E5xxx)

### E5001: ゼロ除算エラー
**説明**: 計算中にゼロ除算が発生しました。  
**対処法**: 入力値を確認し、0以外の値を入力してください。  
**発生例**: Cap Rateが0の場合の収益還元価格計算

### E5002: 計算パラメータ不正
**説明**: 計算パラメータが不正です。  
**対処法**: 入力値を確認し、正しい値を入力してください。  
**発生例**: 
- ローン金額が購入価格を超えている
- 保有年数がローン年数を超えている

### E5003: オーバーフロー
**説明**: 計算結果がオーバーフローしました。  
**対処法**: より小さな値を入力してください。  
**発生例**: 極端に大きな金額での計算

### E5004: 負の値エラー
**説明**: 負の値が許可されていない項目です。  
**対処法**: 0以上の値を入力してください。  
**発生例**: 購入価格、家賃などがマイナス値

### E5005: ローン計算エラー
**説明**: ローン計算でエラーが発生しました。  
**対処法**: ローン条件を確認してください。  
**発生例**: 
- 金利が異常に高い
- ローン年数が0

### E5006: IRR計算失敗
**説明**: IRR計算が収束しませんでした。  
**対処法**: 投資条件を見直してください。  
**発生例**: キャッシュフローが全てマイナスの場合

### E5007: 税金計算エラー
**説明**: 税金計算でエラーが発生しました。  
**対処法**: 税率設定を確認してください。  
**発生例**: 実効税率が100%を超えている

### E5008: 減価償却計算エラー
**説明**: 減価償却計算でエラーが発生しました。  
**対処法**: 建物価格と耐用年数を確認してください。  
**発生例**: 耐用年数が0年の場合

## システムエラー (E55xx)

### 年間価格下落率
: 一般的なシステムエラー
**説明**: システムエラーが発生しました。  
**対処法**: しばらく待ってから再度お試しください。  
**発生例**: 予期しない内部エラー

### E5501: データベースエラー
**説明**: データベースエラーが発生しました。  
**対処法**: システム管理者にお問い合わせください。  
**発生例**: データベース接続エラー

### E5502: タイムアウト
**説明**: 処理がタイムアウトしました。  
**対処法**: 入力データを簡略化するか、時間をおいて再試行してください。  
**発生例**: 複雑な計算で処理時間が長すぎる場合

### E5503: メモリ不足
**説明**: メモリ不足エラーが発生しました。  
**対処法**: システム管理者にお問い合わせください。  
**発生例**: サーバーリソース不足

### E5504: 依存サービスエラー
**説明**: 依存サービスでエラーが発生しました。  
**対処法**: しばらく待ってから再度お試しください。  
**発生例**: 外部サービスの障害

## 外部APIエラー (E6xxx)

### E6001: API接続エラー
**説明**: 外部APIへの接続に失敗しました。  
**対処法**: ネットワーク接続を確認してください。  
**発生例**: ネットワーク障害

### E6002: APIタイムアウト
**説明**: 外部APIへのリクエストがタイムアウトしました。  
**対処法**: しばらく待ってから再度お試しください。  
**発生例**: 外部APIの応答が遅い

### E6003: API不正レスポンス
**説明**: 外部APIから不正なレスポンスを受信しました。  
**対処法**: システム管理者にお問い合わせください。  
**発生例**: APIの仕様変更

### E6004: APIレート制限
**説明**: APIのレート制限に達しました。  
**対処法**: しばらく待ってから再度お試しください。  
**発生例**: 短時間に大量のAPIリクエスト

## 実装方法

### バックエンド実装例

```python
from error_codes import ErrorCode, SimulatorError, create_error_response

# カスタムエラーを発生させる
if loan_amount > purchase_price:
    raise SimulatorError(
        ErrorCode.CALC_INVALID_PARAMETER,
        detail="ローン金額が購入価格を超えています",
        field="loan_amount",
        value=loan_amount
    )

# エラーレスポンスを作成
error_response = create_error_response(
    ErrorCode.VALIDATION_REQUIRED_FIELD,
    status_code=400,
    field="property_name"
)
```

### フロントエンド実装例

```typescript
// エラーレスポンスの処理
if (errorData.error_code) {
  setErrorModalData({
    isOpen: true,
    errorCode: errorData.error_code,
    message: errorData.message,
    solution: errorData.solution,
    details: errorData.details
  });
}
```

## エラー対応フロー

1. **エラー発生時**
   - エラーコードとメッセージを確認
   - 対処法に従って修正

2. **解決しない場合**
   - エラーコードをメモ
   - 入力内容を確認
   - サポートに問い合わせ（エラーコードを伝える）

3. **サポート問い合わせ時に必要な情報**
   - エラーコード
   - 発生日時
   - 実行していた操作
   - 入力していた値（個人情報を除く）

## 更新履歴

- 2025-08-06: 初版作成
- エラーコード体系の確立
- 基本的なエラーコードの定義
- フロントエンド連携の実装