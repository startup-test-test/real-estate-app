# 🎯 品質ゲート定義書

## 🚀 品質ゲートとは

品質ゲートは、次のステップに進む前に**必ず満たすべき条件**です。
条件を満たさない場合は、問題を修正するか、ロールバックを実施します。

## 📋 共通品質ゲート（全ステップ適用）

### 🔴 Gate 1: ビルド・コンパイル品質
**条件**: 全項目がパスすること
- [ ] `npm run build` が成功する（警告含めて）
- [ ] TypeScriptコンパイルエラーが0件
- [ ] ESLint致命的エラーが0件
- [ ] 開発サーバーが正常起動する

**失敗時の対応**: 即座にロールバック

### 🟡 Gate 2: 基本機能品質
**条件**: 全項目がパスすること
- [ ] シミュレーターページにアクセスできる
- [ ] サンプル物件選択が動作する
- [ ] シミュレーション実行が完了する
- [ ] 結果が正常表示される

**失敗時の対応**: 1時間以内に修正、不可能なら即座にロールバック

### 🟢 Gate 3: UI/UX品質
**条件**: 85%以上の項目がパスすること
- [ ] レイアウトが元と同じ
- [ ] 色・フォントが保持されている
- [ ] レスポンシブ対応が維持されている
- [ ] ツールチップが正常動作
- [ ] ローディング状態が適切
- [ ] エラー表示が適切

**失敗時の対応**: 2時間以内に修正、不可能なら修正後に再開

### 🔵 Gate 4: データ整合性品質
**条件**: 全項目がパスすること
- [ ] テストケース1で正常計算
- [ ] テストケース2で正常計算
- [ ] テストケース3で正常計算
- [ ] 計算結果が期待範囲内
- [ ] データ変換が正常動作

**失敗時の対応**: 即座にロールバック

## 🔍 ステップ別専用品質ゲート

### Phase 0: リファクタリング基盤整備
**追加条件**:
- [ ] テストデータファイルが正常作成
- [ ] 検証チェックリストが利用可能
- [ ] 自動テストスクリプトが実行可能
- [ ] ロールバック手順書が整備済み

**進行判定**: 全項目パス必須

### Step 1-1: ユーティリティ関数抽出
**追加条件**:
- [ ] 抽出した関数が独立して動作
- [ ] 元の機能が全て保持されている
- [ ] インポート文が正常解決
- [ ] 関数の型定義が適切

**進行判定**: 全項目パス必須

### Step 1-2: 定数・設定データ抽出
**追加条件**:
- [ ] 定数ファイルが正常読み込み
- [ ] サンプル物件データが正常動作
- [ ] ツールチップが正常表示
- [ ] メトリクスしきい値が正常動作

**進行判定**: 全項目パス必須

### Step 1-3: 型定義の分離
**追加条件**:
- [ ] 型ファイルが正常読み込み
- [ ] 型チェックが正常動作
- [ ] IDE補完が正常動作
- [ ] 循環参照が発生しない

**進行判定**: 全項目パス必須

### Step 1-4: カスタムフック抽出
**追加条件**:
- [ ] フックが独立して動作
- [ ] 状態管理が正常動作
- [ ] 副作用処理が正常動作
- [ ] 依存関係が適切

**進行判定**: 全項目パス必須

### Step 1-5: 最小コンポーネント抽出
**追加条件**:
- [ ] コンポーネントが独立して動作
- [ ] プロパティ受け渡しが正常
- [ ] イベント処理が正常
- [ ] スタイルが保持されている

**進行判定**: 全項目パス必須

## ⚠️ 例外処理ルール

### 🔴 Critical Issues（即座にロールバック）
- システムクラッシュ
- データ破損
- セキュリティ問題
- ビルド不可能

### 🟡 Major Issues（1時間制限で修正試行）
- 主要機能停止
- 明らかな計算エラー
- 重大なUI問題
- パフォーマンス著しい劣化

### 🟢 Minor Issues（継続可能、後で修正）
- 軽微なスタイル変更
- 警告メッセージ
- 軽微なパフォーマンス劣化
- ドキュメントの更新漏れ

## 📊 品質ゲート評価シート

### テンプレート
```
## 品質ゲート評価

**評価日時**: YYYY/MM/DD HH:MM
**対象ステップ**: [Phase-0 / Step-1-1 / etc.]
**評価者**: [名前]

### Gate 1: ビルド・コンパイル品質
- npm run build: [ PASS / FAIL ]
- TypeScript: [ PASS / FAIL ]
- ESLint: [ PASS / FAIL ]
- 開発サーバー: [ PASS / FAIL ]
**結果**: [ PASS / FAIL ]

### Gate 2: 基本機能品質
- ページアクセス: [ PASS / FAIL ]
- サンプル選択: [ PASS / FAIL ]
- シミュレーション実行: [ PASS / FAIL ]
- 結果表示: [ PASS / FAIL ]
**結果**: [ PASS / FAIL ]

### Gate 3: UI/UX品質
- レイアウト: [ PASS / FAIL ]
- スタイル: [ PASS / FAIL ]
- レスポンシブ: [ PASS / FAIL ]
- ツールチップ: [ PASS / FAIL ]
- ローディング: [ PASS / FAIL ]
- エラー表示: [ PASS / FAIL ]
**結果**: [ PASS / FAIL ] (パス率: XX%)

### Gate 4: データ整合性品質
- テストケース1: [ PASS / FAIL ]
- テストケース2: [ PASS / FAIL ]
- テストケース3: [ PASS / FAIL ]
- 計算結果: [ PASS / FAIL ]
- データ変換: [ PASS / FAIL ]
**結果**: [ PASS / FAIL ]

### ステップ別専用ゲート
[ステップ固有の条件を記載]
**結果**: [ PASS / FAIL ]

### 総合判定
- [ ] 次のステップに進む（全ゲートPASS）
- [ ] 修正後に再評価（Minor Issues）
- [ ] ロールバック実施（Major/Critical Issues）

### 問題・改善点
[問題があれば詳細記載]

### 次回への申し送り
[次のステップで注意すべき点]
```

## 🎯 品質ゲート運用ルール

### 📋 評価タイミング
1. **各ステップ完了時**: 必須評価
2. **問題発生時**: 即座に評価
3. **1日の作業終了時**: 安全確認
4. **ブランチマージ前**: 最終確認

### 👥 評価者
1. **実装者**: 自己評価必須
2. **レビュアー**: 可能であれば第三者評価
3. **ユーザー**: UI/UX品質の最終確認

### 📊 品質メトリクス
- **ゲート通過率**: 80%以上維持
- **ロールバック率**: 20%以下維持
- **修正時間**: 平均2時間以下
- **再評価回数**: 平均2回以下

---

**🎯 目標**: 品質を担保しながら、安全で効率的なリファクタリングを実現する