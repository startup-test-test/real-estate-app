# 環境変数 開発/本番環境 比較表

作成日: 2025年8月17日  
目的: 開発環境と本番環境の環境変数の違いを明確化

## 📊 環境別 環境変数一覧

### ✅ 現在設定済み

| カテゴリ | 環境変数名 | 開発環境 (develop) | 本番環境 (main) | 備考 |
|---------|-----------|-------------------|----------------|------|
| **Supabase** | | | | |
| | Supabase URL | `DEV_SUPABASE_URL` ✅ | `PROD_SUPABASE_URL` ✅ | MAIN_に統一推奨 |
| | Supabase Anon Key | `DEV_SUPABASE_ANON_KEY` ✅ | `PROD_SUPABASE_ANON_KEY` ✅ | MAIN_に統一推奨 |
| **Render API** | | | | |
| | API Base URL | `DEV_API_BASE_URL` ✅ | `PROD_API_BASE_URL` ✅ | MAIN_に統一推奨 |
| | 実際のURL | https://real-estate-app-rwf1.onrender.com | https://real-estate-app-1-iii4.onrender.com | |
| **Stripe** | | | | |
| | Secret Key | `DEV_STRIPE_SECRET_KEY` ✅ | `STRIPE_SECRET_KEY` ✅ | 命名規則不統一 |
| | Webhook Secret | `STRIPE_WEBHOOK_SECRET_DEV` ✅ | ❌ 未設定 | 本番用が必要 |
| | Price ID | ハードコード | ハードコード | 環境変数化推奨 |
| | Publishable Key | `VITE_STRIPE_PUBLISHABLE_KEY` ⚠️ | 同じ値を使用 | 未使用だが設定済み |
| **Google OAuth** | | | | |
| | Client ID | `VITE_GOOGLE_CLIENT_ID` ✅ | 同じ値を使用 | 環境共通 |
| **FTP (Xserver)** | | | | |
| | Host | `FTP_HOST` ✅ | 同じ値を使用 | |
| | Username | `FTP_USERNAME` ✅ | 同じ値を使用 | |
| | Password | `FTP_PASSWORD` ✅ | 同じ値を使用 | |
| | Port | `FTP_PORT` ✅ | 同じ値を使用 | |F
| **Supabase CLI** | | | | |
| | Access Token | `SUPABASE_ACCESS_TOKEN` ✅ | 同じ値を使用 | 環境共通 |

### ⚠️ 未使用・削除候補

| 環境変数名 | 状況 | 削除優先度 |
|-----------|------|-----------|
| `DEV_STRIPE_WEBHOOK_SECRET` | STRIPE_WEBHOOK_SECRET_DEVと重複 | 高 |
| `STRIPE_PRICE_ID` | どこからも参照されていない | 高 |
| `VITE_STRIPE_PUBLISHABLE_KEY` | コードで使用されていない | 中 |
| `DEV_API_BASE_URL` | api.tsでハードコード済み | 低（動作中） |

## 🎯 本番環境用に必要な環境変数

### 今すぐ必要
| 環境変数名 | 用途 | 設定値の取得元 |
|-----------|------|--------------|
| `MAIN_STRIPE_WEBHOOK_SECRET` | Stripe Webhook検証 | Stripeダッシュボード |

### 将来的に統一したい環境変数（新規作成）
| 現在の名前 | 新しい名前（本番用） | 理由 |
|-----------|-------------------|------|
| `STRIPE_SECRET_KEY` | `MAIN_STRIPE_SECRET_KEY` | 命名規則統一 |
| `STRIPE_PRICE_ID` | `MAIN_STRIPE_PRICE_ID` | 環境変数化 |

## 📝 デプロイフロー別の使用環境変数

### developブランチ → dev.ooya.tech
```yaml
使用する環境変数:
- DEV_SUPABASE_URL
- DEV_SUPABASE_ANON_KEY  
- DEV_API_BASE_URL
- FTP_HOST, FTP_USERNAME, FTP_PASSWORD, FTP_PORT
```

### mainブランチ → ooya.tech
```yaml
使用する環境変数:
- PROD_SUPABASE_URL (MAIN_SUPABASE_URLに変更推奨)
- PROD_SUPABASE_ANON_KEY (MAIN_SUPABASE_ANON_KEYに変更推奨)
- PROD_API_BASE_URL (MAIN_RENDER_API_URLに変更推奨)
- VITE_GOOGLE_CLIENT_ID
- FTP_HOST, FTP_USERNAME, FTP_PASSWORD, FTP_PORT
```

### Edge Functions デプロイ
```yaml
開発環境:
- SUPABASE_ACCESS_TOKEN
- DEV_STRIPE_SECRET_KEY
- STRIPE_WEBHOOK_SECRET_DEV

本番環境:
- SUPABASE_ACCESS_TOKEN
- STRIPE_SECRET_KEY
- (MAIN_STRIPE_WEBHOOK_SECRET) ← 要追加
```

## 🚨 重要な注意点

1. **Stripe Price ID**
   - 現在: 両環境ともハードコード `price_1RvChRR8rkVVzR7nAeDvfiur`
   - 推奨: 環境変数化して環境別に管理

2. **API URL管理の二重化**
   - GitHub Secrets: `DEV_API_BASE_URL`
   - コード内: `api.ts`でハードコード
   - 現状は`api.ts`の値が優先される

3. **命名規則の不統一**
   - 開発: `DEV_`プレフィックス
   - 本番: `PROD_`と無印が混在（現在使用中）
   - 将来的に`MAIN_`プレフィックスで統一推奨（mainブランチに合わせる）

## 📋 アクションアイテム

### リリース前（必須）
- [ ] 本番環境が正しく動作することを確認

### リリース後（推奨）
- [ ] 未使用環境変数の削除
- [ ] 本番用Stripe Webhook Secretの追加
- [ ] 命名規則の統一（余裕がある時）

---

最終更新: 2025/08/17