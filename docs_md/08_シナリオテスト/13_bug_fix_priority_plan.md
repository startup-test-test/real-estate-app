# 不具合修正優先度計画

**作成日**: 2025-08-09  
**バージョン**: 1.0.0  
**目的**: テスト不合格項目の修正優先度と進め方の定義

## 1. 修正優先度分類

### 🔴 最優先修正（ビジネスクリティカル）
**影響**: ユーザーの投資判断に直接影響する計算エラー

| 不具合ID | 概要 | テスト内容 | 実際の結果 | 期待結果 | 修正内容 | 修正工数 | ステータス | 影響範囲 |
|----------|------|----------|------------|----------|----------|----------|------------|----------|
| ~~BUG_001~~ | ~~管理手数料デフォルト値~~ | ~~【入力】月額賃料10万円で新規作成【操作】管理手数料の自動計算値を確認~~ | ~~5,000円（5%）で自動計算~~ | ~~3,000円（3%）~~ | **仕様通りのため修正不要** | - | ✅ 対応不要 | **5%が標準仕様** |
| ~~BUG_002~~ | ~~固定資産税の計算ロジック~~ | ~~【入力】物件価格3000万円で新規作成【操作】固定資産税の自動計算値を確認~~ | ~~210,000円（物件価格×0.7%）~~ | ~~210,000円固定値~~ | **仕様通りのため修正不要** | - | ✅ 対応不要 | **物件価格×0.7%が正しい仕様** |
| ~~BUG_003~~ | ~~空室率デフォルト値~~ | ~~【操作】新規作成画面で空室率の初期値確認~~ | ~~0%~~ | ~~10%~~ | **仕様通りのため修正不要** | - | ✅ 対応不要 | **0%が正しい仕様** |
| BUG_004 | 個人実効税率デフォルト | 【操作】新規作成→所有形態「個人」選択→税率確認 | 0%または空欄 | 20% | `/bolt_front/src/constants/sampleData.ts` L29<br>`effectiveTaxRate: 0 → 20` | 小(0.5h) | ✅ 修正完了 | 税引後CF、ROI計算 |
| BUG_008 | ゼロ値バリデーション | 【入力】物件価格0円、賃料0円で計算実行 | NaN%、Infinity表示<br>計算実行される | エラー表示<br>計算ブロック | `/bolt_front/src/pages/Simulator.tsx` L439-470<br>ゼロ値チェック追加 | 中(2h) | ✅ 修正完了 | 全計算処理 |
| BUG_013 | 表面利回り上限チェック | 【入力】表面利回り999%を入力 | 受付され月額賃料8.3億円に | エラーまたは上限30% | 0.1%～30%の範囲制限実装 | 中(2h) | 🔴 未着手 | 賃料自動計算 |

### 🟠 高優先度修正（ユーザビリティ重要）
**影響**: 使い勝手に大きく影響

| 不具合ID | 概要 | 理由 | 修正工数 |
|----------|------|------|----------|
| BUG_005 | 管理手数料％入力 | ユーザー要望対応 | 大(4h) |
| BUG_009 | 上限値チェック全般 | データ異常防止 | 中(3h) |
| BUG_010 | 必須項目チェック | 基本的な入力検証 | 中(2h) |
| BUG_019 | モバイル表示崩れ | モバイルユーザー対応 | 大(4h) |
| BUG_021 | APIタイムアウト | UX改善必須 | 中(2h) |

### 🟡 中優先度修正（品質向上）
**影響**: 品質・保守性の向上

| 不具合ID | 概要 | 理由 | 修正工数 |
|----------|------|------|----------|
| BUG_011 | 全角数字変換 | 入力利便性 | 小(1h) |
| BUG_012 | 未来年チェック | データ妥当性 | 小(1h) |
| BUG_015 | 自動計算タイミング | 操作性改善 | 中(3h) |
| BUG_016 | カンマ付き数値処理 | コピペ対応 | 中(2h) |
| BUG_020 | 文字数上限 | セキュリティ | 小(1h) |

### 🟢 低優先度修正（将来対応可）
**影響**: 軽微な問題

| 不具合ID | 概要 | 理由 | 修正工数 |
|----------|------|------|----------|
| BUG_004 | 個人税率初期値 | 手動変更可能 | 小(0.5h) |
| BUG_006 | 最小値での利回り計算 | エッジケース | 小(1h) |
| BUG_007 | 大数値の表示形式 | 見た目の問題 | 小(1h) |
| BUG_014 | ローン期間100年 | 非現実的ケース | 小(1h) |
| BUG_017 | 浮動小数点精度 | 影響軽微 | 中(2h) |
| BUG_018 | エラー復帰処理 | 回避策あり | 中(2h) |

## 2. 推奨修正手順

### Phase 1: 緊急修正（1日目）
```bash
# 作業ブランチ作成
git checkout -b fix/critical-defaults

# 1. BUG_003: 空室率のデフォルト値修正  
ファイル: /bolt_front/src/constants/sampleData.ts
行: 20
修正前: vacancyRate: 0,
修正後: vacancyRate: 10,

# 2. BUG_004: 個人実効税率のデフォルト値修正
ファイル: /bolt_front/src/constants/sampleData.ts
行: 29
修正前: effectiveTaxRate: 0,  // 現在の値を確認
修正後: effectiveTaxRate: 0,  // 個人の場合は0%を明示的に設定

# テスト実施
npm test
npm run dev  # 手動確認

# コミット
git add .
git commit -m "fix: デフォルト値を仕様に合わせて修正

- 管理手数料: 5% → 3%
- 空室率: 0% → 10%  
- 個人実効税率: 0%を明示的に設定

refs #BUG_001, #BUG_003, #BUG_004"

# プッシュ
git push origin fix/critical-defaults
```

### Phase 2: 計算ロジック修正（2日目）
```
1. BUG_002: 固定資産税の修正
   - 自動計算を初回のみに制限
   - デフォルト210,000円のオプション追加
   
2. BUG_008: ゼロ値バリデーション追加
   - 必須フィールドの0チェック
   - エラーメッセージ表示
   
3. BUG_013: 利回り上限チェック
   - 0.1% ～ 30% の範囲制限
   
4. 統合テスト実施
```

### Phase 3: UI/UX改善（3-4日目）
```
1. BUG_005: パーセント入力対応
   - 入力パーサー実装
   - 「3%」→ 計算値変換
   
2. BUG_019: レスポンシブ対応
   - モバイルCSS調整
   - ブレークポイント見直し
   
3. BUG_021: タイムアウト実装
   - AbortController追加
   - 30秒タイムアウト設定
```

### Phase 4: 品質向上（5日目以降）
```
1. 残りの中・低優先度バグ修正
2. 全体回帰テスト
3. パフォーマンステスト
```

## 3. テスト戦略

### 3.1 修正後の確認手順
```bash
# 1. 単体テスト実行
npm test

# 2. 該当シナリオの再テスト（修正ごとに実施）

## BUG_001修正後
- テストID: SPECIAL_DEFAULT_001
- 確認内容: 月額賃料10万円入力時、管理手数料が3,000円（3%）になる
- 期待結果: ✅ 合格に変わる

## BUG_003修正後  
- テストID: SPECIAL_DEFAULT_001
- 確認内容: 新規作成時の空室率が10%
- 期待結果: ✅ 合格に変わる

## BUG_004修正後
- テストID: SPECIAL_TAX_001
- 確認内容: 個人選択時の実効税率が0%
- 期待結果: ✅ 合格に変わる

# 3. 影響範囲テスト
- NORMAL_001: 最小値での計算が正常か
- NORMAL_002: 最大値での計算が正常か  
- NORMAL_003: 一般的な値での計算が正常か
- E2E_001: 新規作成→保存の流れが正常か

# 4. 回帰テスト
- 全32テストケースを再実行
- 新たなエラーが発生していないか確認
```

### 3.2 影響範囲分析マトリックス

| 修正箇所 | 影響を受ける機能 | 影響を受ける計算 | 確認すべきテストケース | リスクレベル |
|----------|-----------------|-----------------|----------------------|-------------|
| 管理手数料(5%→3%) | 月間収支、年間CF | ・月間支出が2%減少<br>・年間CFが改善<br>・実質利回り上昇 | NORMAL_003<br>SPECIAL_DEFAULT_001<br>E2E_001 | 高（全ユーザー影響） |
| 固定資産税 | 年間支出、利回り | ・年間固定費変動<br>・実質利回り変動<br>・ROI/CCR変動 | NORMAL_003<br>SPECIAL_001<br>CALC_002 | 高（税金計算影響） |
| 空室率(0%→10%) | 実質収入、利回り | ・実質賃料90%に<br>・全利回り低下<br>・CF悪化 | NORMAL_003<br>E2E_001<br>CALC_001 | 高（収益予測影響） |
| 個人税率(20%→0%) | 税引後CF | ・個人投資家のCF改善<br>・ROI向上 | SPECIAL_TAX_001<br>E2E_001 | 中（個人のみ影響） |
| バリデーション | 全入力処理 | ・計算可否判定<br>・エラー表示 | ERROR_001-005<br>BOUNDARY_001-003 | 中（UX影響） |
| レスポンシブ | 全画面表示 | ・表示のみ<br>・計算影響なし | UX_003<br>MOBILE_001-003 | 低（表示のみ） |

## 4. リリース判定基準

### 4.1 必須条件
- [ ] 最優先修正（🔴）が全て完了
- [ ] 正常系テスト（NORMAL_001-003）が全て合格
- [ ] 計算精度テスト（CALC_001-004）が合格
- [ ] 主要ブラウザで動作確認完了

### 4.2 推奨条件
- [ ] 高優先度修正（🟠）の80%以上完了
- [ ] モバイル対応（MOBILE_001-003）合格
- [ ] パフォーマンステスト合格

## 5. リスク管理

### 5.1 修正に伴うリスク
| リスク | 可能性 | 影響度 | 対策 |
|--------|--------|--------|------|
| 計算ロジック変更による既存データ不整合 | 高 | 高 | データ移行スクリプト準備 |
| 自動計算停止によるUX低下 | 中 | 中 | 設定で切り替え可能に |
| バリデーション強化による既存ユーザー影響 | 中 | 低 | 段階的導入 |

### 5.2 ロールバック計画
1. 各修正をfeatureブランチで実施
2. ステージング環境で十分なテスト
3. 問題発生時は即座に前バージョンへロールバック
4. ホットフィックス用のブランチ戦略準備

## 6. 実施スケジュール案

### 6.1 詳細スケジュール

| 日程 | フェーズ | 作業内容 | 修正バグID | ブランチ | プルリクエスト | 完了条件 |
|------|----------|----------|------------|----------|---------------|----------|
| Day 1 AM | Phase 1 | デフォルト値修正 | BUG_001,003,004 | fix/critical-defaults | PR#001 | 3件のテスト合格 |
| Day 1 PM | Phase 1 | 影響範囲テスト | - | - | - | 正常系全合格 |
| Day 2 AM | Phase 2 | 計算ロジック修正 | BUG_002,008,013 | fix/calculation-logic | PR#002 | バリデーション動作 |
| Day 2 PM | Phase 2 | 統合テスト | - | - | - | E2E合格 |
| Day 3 | Phase 3 | UI/UX改善 | BUG_005,019,021 | fix/ui-improvements | PR#003 | モバイル表示OK |
| Day 4 | Phase 3 | 品質向上 | BUG_011,012,015,016 | fix/quality-improvements | PR#004 | 全異常系合格 |
| Day 5 AM | - | 全体回帰テスト | - | - | - | 合格率95%以上 |
| Day 5 PM | - | リリース判定会議 | - | develop | - | Go/NoGo判定 |
| Day 6 | - | 本番リリース | - | main | - | デプロイ完了 |

### 6.2 進捗管理

```markdown
## 現在の進捗状況（2025-08-09時点）

### Phase 1: デフォルト値修正
- [ ] BUG_001: 管理手数料 (未着手)
- [ ] BUG_003: 空室率 (未着手)
- [ ] BUG_004: 個人税率 (未着手)
- [ ] テスト実施 (未着手)
- [ ] PR作成・レビュー (未着手)

### Phase 2: 計算ロジック
- [ ] BUG_002: 固定資産税 (未着手)
- [ ] BUG_008: ゼロ値チェック (未着手)
- [ ] BUG_013: 利回り上限 (未着手)

### Phase 3: UI/UX
- [ ] BUG_005: ％入力 (未着手)
- [ ] BUG_019: レスポンシブ (未着手)
- [ ] BUG_021: タイムアウト (未着手)
```

## 7. 成功指標

### 7.1 定量指標
| 指標 | 現状値 | 目標値 | 測定方法 |
|------|--------|--------|----------|
| テスト合格率 | 21.9%（7/32件） | 95%以上（30/32件以上） | シナリオテスト実行 |
| 計算精度 | 誤差あり（NaN発生） | 誤差0.01%以内 | CALC_001-004実行 |
| パフォーマンス | 未測定 | 計算時間3秒以内 | PERF_001実行 |
| エラー率 | 78.1%（25/32件） | 0.1%以下 | 本番ログ監視 |
| デフォルト値正確性 | 0%（0/4項目） | 100%（4/4項目） | SPECIAL_DEFAULT_001 |

### 7.2 定性指標
- ユーザーからのバグ報告減少
- サポート問い合わせ削減
- ユーザー満足度向上

---

## 8. GitHub管理

### 8.1 ブランチ戦略
```bash
main
  └── develop
        ├── fix/critical-defaults     (Phase 1)
        ├── fix/calculation-logic     (Phase 2)
        ├── fix/ui-improvements        (Phase 3)
        └── fix/quality-improvements   (Phase 4)
```

### 8.2 コミットメッセージ規約
```bash
fix: 管理手数料のデフォルト値を3%に修正 refs #BUG_001
fix: 空室率のデフォルト値を10%に修正 refs #BUG_003
fix: 個人実効税率のデフォルト値を0%に修正 refs #BUG_004
```

### 8.3 プルリクエストテンプレート
```markdown
## 概要
- 修正したバグ: BUG_XXX
- 修正内容: 

## テスト結果
- [ ] 該当テストケース合格
- [ ] 影響範囲テスト合格
- [ ] 回帰テストで新規エラーなし

## 影響範囲
- 影響を受ける機能:
- 影響を受けるユーザー:
```

---

**次のアクション**:
1. ✅ 優先度計画作成完了
2. 🔴 Phase 1の緊急修正を開始（BUG_001, 003, 004）
3. ⏸️ 修正完了後、該当テストケースを再実行
4. ⏸️ 結果を`11_scenario_test_management_250809.md`に記録
5. ⏸️ プルリクエスト作成・レビュー依頼