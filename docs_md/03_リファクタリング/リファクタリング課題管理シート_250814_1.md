# リファクタリング課題管理シート

**作成日**: 2025年8月14日  
**作成者**: 開発チーム  
**対象**: プロジェクトルート直下の不要ファイル整理

## 📋 概要

プロジェクトルート直下に散在している一時的なテスト・デバッグファイルを整理し、プロジェクト構造をクリーンに保つためのリファクタリング作業。

## 🎯 目的

1. プロジェクトルートの整理整頓
2. 不要なテストファイルの削除
3. メンテナンス性の向上
4. 開発環境のクリーン化

## 📊 削除対象ファイル一覧

### 第1弾：プロジェクトルート（19ファイル）【✅ 完了】

### SQLファイル（8ファイル）

| No | ファイル名 | 用途 | 作成時期 | 削除理由 | ステータス |
|----|-----------|------|----------|----------|-----------|
| 1 | `check_subscription_data.sql` | サブスクリプションデータ確認 | 8月中旬 | テスト用、不要 | ✅ 削除済 |
| 2 | `check_table_structure.sql` | テーブル構造確認 | 8月中旬 | デバッグ用、不要 | ✅ 削除済 |
| 3 | `debug_subscription.sql` | サブスクリプションデバッグ | 8月中旬 | デバッグ完了 | ✅ 削除済 |
| 4 | `fix_subscription_id.sql` | ID修正用 | 8月中旬 | 一時的な修正、完了済み | ✅ 削除済 |
| 5 | `insert_subscription.sql` | テストデータ挿入 | 8月中旬 | テスト完了 | ✅ 削除済 |
| 6 | `reset_premium_correct.sql` | プレミアム解約（修正版） | 8/14 | 本日作成、テスト完了 | ✅ 削除済 |
| 7 | `reset_premium_for_user.sql` | プレミアム解約（初版） | 8/14 | 本日作成、不要 | ✅ 削除済 |
| 8 | `update_subscription_with_real_id.sql` | ID更新 | 8月中旬 | 一時的な修正、完了済み | ✅ 削除済 |

### TypeScript/JavaScriptファイル（2ファイル）

| No | ファイル名 | 用途 | 作成時期 | 削除理由 | ステータス |
|----|-----------|------|----------|----------|-----------|
| 9 | `edge_function_debug.ts` | Edge Functionデバッグ | 8/14 | 本日作成、デバッグ完了 | ✅ 削除済 |
| 10 | `final_edge_function.ts` | Edge Function最終版 | 8/14 | 本日作成、デプロイ済み | ✅ 削除済 |

### シェルスクリプト（5ファイル）

| No | ファイル名 | 用途 | 作成時期 | 削除理由 | ステータス |
|----|-----------|------|----------|----------|-----------|
| 11 | `deploy_create_checkout_session.sh` | 個別デプロイ | 8/14 | 本日作成、一時的 | ✅ 削除済 |
| 12 | `deploy_edge_functions.sh` | Edge Functionsデプロイ | 8月中旬 | 一時的なスクリプト | ✅ 削除済 |
| 13 | `deploy_resume.sh` | resume機能デプロイ | 8月中旬 | 一時的なスクリプト | ✅ 削除済 |
| 14 | `deploy_with_env.sh` | 環境変数付きデプロイ | 8/14 | 本日作成、一時的 | ✅ 削除済 |
| 15 | `manual_deploy.sh` | 手動デプロイ | 8月中旬 | 一時的なスクリプト | ✅ 削除済 |

### その他ファイル（4ファイル）

| No | ファイル名 | 用途 | 作成時期 | 削除理由 | ステータス |
|----|-----------|------|----------|----------|-----------|
| 16 | `deploy_commands.txt` | デプロイコマンドメモ | 8月中旬 | メモ、不要 | ✅ 削除済 |
| 17 | `test_scenarios_20250810.md` | テストシナリオ | 8/10 | 古いテスト資料 | ✅ 削除済 |
| 18 | `urgent_fix_multiple_subscriptions.md` | 緊急修正メモ | 8月中旬 | 修正完了、不要 | ✅ 削除済 |
| 19 | `cleanup_analysis.md` | 本日の分析資料 | 8/14 | 本作業完了後削除 | ✅ 削除済 |

## 🔧 削除コマンド

### 一括削除コマンド

```bash
# プロジェクトルートで実行
cd /workspaces/real-estate-app

# SQLファイルの削除
rm -f check_subscription_data.sql \
      check_table_structure.sql \
      debug_subscription.sql \
      fix_subscription_id.sql \
      insert_subscription.sql \
      reset_premium_correct.sql \
      reset_premium_for_user.sql \
      update_subscription_with_real_id.sql

# TypeScript/JavaScriptファイルの削除
rm -f edge_function_debug.ts \
      final_edge_function.ts

# シェルスクリプトの削除
rm -f deploy_create_checkout_session.sh \
      deploy_edge_functions.sh \
      deploy_resume.sh \
      deploy_with_env.sh \
      manual_deploy.sh

# その他ファイルの削除
rm -f deploy_commands.txt \
      test_scenarios_20250810.md \
      urgent_fix_multiple_subscriptions.md \
      cleanup_analysis.md
```

## 📈 効果測定

### 削除前
- プロジェクトルート直下のファイル数: 約30ファイル
- 一時ファイル数: 19ファイル
- 混在率: 63%

### 削除後（予定）
- プロジェクトルート直下のファイル数: 約11ファイル
- 一時ファイル数: 0ファイル
- 整理率: 100%

## ⚠️ 注意事項

1. **Gitでの確認**
   - すべてのファイルがGitにコミット済みであることを確認
   - 必要に応じて`git stash`で一時保存

2. **バックアップ**
   - 削除前に`git status`で変更を確認
   - 削除後も`git`履歴から復元可能

3. **影響範囲**
   - これらのファイルは本番環境では使用されていない
   - 開発・テスト用の一時ファイルのみ

## 🚀 実行手順

1. **事前確認**
   ```bash
   git status  # 未コミットの変更がないか確認
   ```

2. **削除実行**
   ```bash
   # 上記の削除コマンドを実行
   ```

3. **結果確認**
   ```bash
   ls -la  # ルートディレクトリの確認
   git status  # 削除されたファイルの確認
   ```

4. **コミット**
   ```bash
   git add -A
   git commit -m "refactor: プロジェクトルート直下の不要ファイルを削除"
   ```

## 📝 備考

- 削除したファイルはGitの履歴に残るため、必要に応じて復元可能
- 今後は適切なディレクトリ（`scripts/`、`docs_md/`など）にファイルを配置する
- 一時的なテストファイルは`.gitignore`に追加を検討

---

## 第2弾：supabaseフォルダ内（11ファイル）【✅ 一部完了】

### テストファイル（即削除可能）

| No | ファイル名 | パス | 用途 | 削除理由 | ステータス |
|----|-----------|------|------|----------|-----------|
| 20 | `index.test.ts` | `functions/create-checkout-session/` | URLテスト | 本日作成、テスト完了 | ✅ 削除済 |
| 21 | `test-url-config.js` | `functions/create-checkout-session/` | URL設定テスト | 本日作成、テスト完了 | ✅ 削除済 |
| 22 | `url-config.test.js` | `functions/create-checkout-session/` | URL設定テスト | 本日作成、テスト完了 | ✅ 削除済 |
| 23 | `trigger.txt` | `functions/` | デプロイトリガー | 空ファイル、不要 | ✅ 削除済 |

### デバッグ・チェック用SQL（開発完了後削除検討）

| No | ファイル名 | パス | 用途 | 削除理由 | ステータス |
|----|-----------|------|------|----------|-----------|
| 24 | `20240812_check_tables.sql` | `migrations/` | テーブル構造確認 | デバッグ用、開発完了後不要 | ⏳ 保留 |
| 25 | `20250813_check_all_rls_status.sql` | `migrations/` | RLS状態確認 | デバッグ用、開発完了後不要 | ⏳ 保留 |
| 26 | `reset_usage_for_testing.sql` | `migrations/` | テスト用リセット | テスト専用、本番不要 | ⏳ 保留 |
| 27 | `debug_policies.sql` | `policies/` | ポリシーデバッグ | デバッグ用、本番不要 | ⏳ 保留 |

### アーカイブファイル（履歴として保持検討中）

| No | ファイル名 | パス | 用途 | 削除理由 | ステータス |
|----|-----------|------|------|----------|-----------|
| 28 | `fix_constraints.sql` | `archive/` | 過去の制約修正 | 履歴、容量小 | 📚 保持推奨 |
| 29 | `fix_rls_policies.sql` | `archive/` | 過去のRLS修正 | 履歴、容量小 | 📚 保持推奨 |
| 30 | `fix_database.sql` | `scripts/` | DB修正スクリプト | 将来使用可能性 | 📚 保持推奨 |

### 削除コマンド

#### 即削除可能（4ファイル）
```bash
cd /workspaces/real-estate-app/supabase
rm -f functions/create-checkout-session/index.test.ts \
      functions/create-checkout-session/test-url-config.js \
      functions/create-checkout-session/url-config.test.js \
      functions/trigger.txt
```

#### 開発完了後削除検討（4ファイル）
```bash
cd /workspaces/real-estate-app/supabase
rm -f migrations/20240812_check_tables.sql \
      migrations/20250813_check_all_rls_status.sql \
      migrations/reset_usage_for_testing.sql \
      policies/debug_policies.sql
```

---

## 第3弾：scriptsフォルダ内（0ファイル）【✅ 調査完了】

### 調査結果
| ファイル名 | 用途 | 判定 | 理由 |
|-----------|------|------|------|
| `apply-migrations.sh` | マイグレーション適用 | **保持** | 本番・開発環境で使用 |
| `deploy-to-xserver.sh` | Xserverデプロイ | **保持** | 本番デプロイで使用 |

**結論**: scriptsフォルダ内に削除対象ファイルなし（すべて必要なスクリプト）

---

## ✅ チェックリスト

### 第1弾（プロジェクトルート）
- [x] Gitでの変更確認
- [x] 削除対象ファイルの最終確認
- [x] 削除コマンドの実行
- [x] 削除後の動作確認
- [x] Gitへのコミット（commit: 349a38e）
- [x] チームへの共有

### 第2弾（supabaseフォルダ）
- [x] 削除対象ファイルの確認（11ファイル特定）
- [x] 即削除可能ファイル（4個）の削除実行
- [ ] 開発完了後の削除検討（4個）
- [ ] Gitへのコミット

### 第3弾（scriptsフォルダ）
- [x] 調査完了（削除対象なし）

---

**次回のアクション**: 
- 即削除可能な4ファイルの削除実行
- 開発完了後にデバッグ用SQLファイル（4個）の削除検討
- `.gitignore`の更新を検討（テストファイルのパターン追加）
- CI/CDパイプラインでの自動クリーンアップの検討

## 📊 削除統計サマリー

| カテゴリ | ファイル数 | ステータス |
|---------|-----------|-----------|
| **第1弾：プロジェクトルート** | 19個 | ✅ 削除完了 |
| **第2弾：supabase（即削除可能）** | 4個 | ✅ 削除完了 |
| **第2弾：supabase（開発後削除）** | 4個 | 📌 保留中 |
| **第2弾：supabase（保持推奨）** | 3個 | 📚 保持 |
| **第3弾：scripts** | 0個 | ✅ 削除不要 |
| **合計削除済み** | 23個 | - |
| **削除予定** | 0個 | - |
| **削除検討中** | 4個 | - |