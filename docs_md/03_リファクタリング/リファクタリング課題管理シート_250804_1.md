# リファクタリング課題管理シート 2025年8月4日

## 1. 概要

本ドキュメントは、セキュリティ対策実施前に行うべきリファクタリング作業の候補をまとめたものです。
不要なテストファイル、デバッグファイル、一時ファイルを特定し、削除優先度を設定しています。

## 2. リファクタリング対象ファイル一覧と影響範囲

### 🔴 最優先削除候補（セキュリティリスク・リポジトリサイズの観点）

| ファイルパス | サイズ/内容 | 削除理由 | 影響範囲 | アクション |
|------------|------------|---------|---------|----------|
| `/api_response.json` | 183,999トークン | 巨大なAPIレスポンステストデータ。機密情報を含む可能性あり | **影響なし** - 他ファイルからの参照なし。実はHTMLエラーページで、JSONではない | **即時削除** |
| `/api_response_debug.json` | 26行 | APIデバッグ用レスポンスデータ | **影響なし** - `check_api.py`の出力先のみ。他からの読み込み参照なし | **即時削除** |
| `/test_api.py` | APIテストスクリプト | 本番環境では不要、APIキーがハードコードされている可能性 | **影響なし** - 独立したテストスクリプト。どこからもimportされていない | **即時削除** |
| `/check_api.py` | API確認スクリプト | 本番環境では不要、APIエンドポイントが露出 | **影響なし** - 独立したスクリプト。`api_response_debug.json`へ出力するだけ | **即時削除** |

### 🟡 削除推奨候補（開発完了済みのテストファイル）

| ファイルパス | 内容 | 削除理由 | 影響範囲 | アクション |
|------------|------|---------|---------|----------|
| `/test-validation-check.html` | バリデーションテスト結果レポート | テスト完了済み、結果は記録済み | **影響なし** - 静的HTMLレポート。どこからもリンクされていない | 削除推奨 |
| `/bolt_front/test.html` | Viteサーバー動作確認用 | 開発初期の確認用、現在は不要 | **影響なし** - テスト用HTML。index.htmlやvite設定で参照なし | 削除推奨 |
| `/bolt_front/test-validation.js` | Puppeteerテストスクリプト | バリデーション実装完了済み | **影響なし** - package.jsonのscriptsに含まれず、どこからも実行されない | 削除推奨 |
| `/bolt_front/test-runner.js` | テスト分析スクリプト | テスト完了済み | **影響なし** - 単なる分析結果表示。ビルドプロセスに含まれない | 削除推奨 |
| `/bolt_front/src/TestApp.tsx` | React動作確認コンポーネント | 本番では使用しない | **影響なし** - どこからもimportされておらず、ルーティングにも含まれない | 削除推奨 |
| `/manual-validation-test.md` | 手動テストシナリオ | テスト実施完了 | **影響なし** - ドキュメントファイル。他のmdからのリンクなし | アーカイブ後削除 |

### 🟢 保持推奨（品質保証・開発環境）

| ファイルパス | 内容 | 保持理由 |
|------------|------|---------|
| `/backend/simulator-api/scenario_tests/*.py` | 計算ロジックテスト群 | 継続的な品質保証に必要 |
| `/bolt_front/src/pages/Dashboard.test.tsx` | 正式なユニットテスト | CI/CDで使用 |
| `/backend/simulator-api/streamlit_dev.py` | Streamlit開発環境 | 新機能プロトタイプ開発用 |
| `/backend/property-api/streamlit_app.py` | 不動産検索デモ | デモ・開発環境として有用 |

### 🔵 その他の確認事項

| カテゴリ | 内容 | 対応 |
|---------|------|------|
| SQLデバッグ | `/supabase/policies/debug_policies.sql` | 本番デプロイ前に削除検討 |
| 環境設定例 | `/.env.ftp.example` | ドキュメントとして保持 |
| デプロイ設定 | `/deploy-configs/` | 本番運用に必要、保持 |

## 3. セキュリティ観点での優先事項

### 即時対応が必要な項目

1. **APIレスポンスファイルの削除**
   - `api_response.json`と`api_response_debug.json`に機密情報が含まれている可能性
   - Gitの履歴からも完全に削除する必要あり

2. **APIテストスクリプトの削除**
   - `test_api.py`と`check_api.py`にAPIキーやエンドポイントがハードコードされている可能性
   - 削除前に内容を確認し、必要な情報は環境変数に移行

3. **テスト結果ファイルの削除**
   - HTMLテストレポートに内部実装の詳細が含まれている可能性

## 4. リファクタリング実施手順

### ステップ1: バックアップ作成
```bash
# 重要なファイルのバックアップ（ローカルのみ）
cp -r /workspaces/real-estate-app /tmp/backup_20250804
```

### ステップ2: 最優先ファイルの削除
```bash
# APIレスポンスファイル
rm /workspaces/real-estate-app/api_response.json
rm /workspaces/real-estate-app/api_response_debug.json

# APIテストスクリプト
rm /workspaces/real-estate-app/test_api.py
rm /workspaces/real-estate-app/check_api.py
```

### ステップ3: テストファイルの削除
```bash
# HTMLテストファイル
rm /workspaces/real-estate-app/test-validation-check.html
rm /workspaces/real-estate-app/bolt_front/test.html

# JavaScriptテストファイル
rm /workspaces/real-estate-app/bolt_front/test-validation.js
rm /workspaces/real-estate-app/bolt_front/test-runner.js

# Reactテストコンポーネント
rm /workspaces/real-estate-app/bolt_front/src/TestApp.tsx
```

### ステップ4: Gitの履歴からの削除（必要に応じて）
```bash
# 大きなファイルをGit履歴から削除
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch api_response.json" \
  --prune-empty --tag-name-filter cat -- --all
```

## 5. リファクタリング後の確認事項

### チェックリスト
- [ ] 削除ファイルがimportされていないことを確認
- [ ] ビルドが正常に通ることを確認
- [ ] テストスイートが正常に動作することを確認
- [ ] .gitignoreに適切なパターンが追加されていることを確認
- [ ] 機密情報がリポジトリに残っていないことを確認

### .gitignoreに追加すべきパターン
```
# テストデータ
**/test_*.json
**/debug_*.json
api_response*.json

# 一時テストファイル
test-*.html
test-*.js
**/TestApp.tsx

# デバッグファイル
debug_*.py
**/debug_*.sql
```

## 6. 今後の推奨事項

1. **テストファイルの命名規則統一**
   - 正式なテスト: `*.test.ts`, `*.spec.ts`
   - 一時的なテスト: `temp_*.ts`, `debug_*.ts`（.gitignoreで除外）

2. **テストデータの管理**
   - テストデータは`__tests__/fixtures/`に集約
   - 大きなテストデータは別リポジトリまたはS3に保管

3. **定期的なクリーンアップ**
   - 月次でリポジトリの不要ファイルをチェック
   - CI/CDでファイルサイズの監視を実装

## 7. 実施スケジュール

| タスク | 優先度 | 実施予定日 | 担当 | ステータス |
|-------|--------|-----------|------|----------|
| 最優先ファイルの削除 | 🔴高 | 2025/08/04 | - | 未着手 |
| テストファイルの削除 | 🟡中 | 2025/08/04 | - | 未着手 |
| .gitignore更新 | 🟡中 | 2025/08/04 | - | 未着手 |
| Git履歴のクリーンアップ | 🔵低 | 2025/08/05 | - | 未着手 |

## 8. 削除実施チェックリスト（一つずつ実行用）

### 🗑️ 削除対象ファイル一覧（実行順）

| No. | ファイル | 優先度 | 影響 | 削除コマンド | 実施済 |
|-----|---------|--------|------|-------------|--------|
| 1 | `/api_response.json` | 🔴最優先 | 影響なし | `rm /workspaces/real-estate-app/api_response.json` | ⬜ |
| 2 | `/api_response_debug.json` | 🔴最優先 | 影響なし | `rm /workspaces/real-estate-app/api_response_debug.json` | ⬜ |
| 3 | `/test_api.py` | 🔴最優先 | 影響なし | `rm /workspaces/real-estate-app/test_api.py` | ⬜ |
| 4 | `/check_api.py` | 🔴最優先 | 影響なし | `rm /workspaces/real-estate-app/check_api.py` | ⬜ |
| 5 | `/test-validation-check.html` | 🟡推奨 | 影響なし | `rm /workspaces/real-estate-app/test-validation-check.html` | ⬜ |
| 6 | `/bolt_front/test.html` | 🟡推奨 | 影響なし | `rm /workspaces/real-estate-app/bolt_front/test.html` | ⬜ |
| 7 | `/bolt_front/test-validation.js` | 🟡推奨 | 影響なし | `rm /workspaces/real-estate-app/bolt_front/test-validation.js` | ⬜ |
| 8 | `/bolt_front/test-runner.js` | 🟡推奨 | 影響なし | `rm /workspaces/real-estate-app/bolt_front/test-runner.js` | ⬜ |
| 9 | `/bolt_front/src/TestApp.tsx` | 🟡推奨 | 影響なし | `rm /workspaces/real-estate-app/bolt_front/src/TestApp.tsx` | ⬜ |
| 10 | `/manual-validation-test.md` | 🟡推奨 | 影響なし | `rm /workspaces/real-estate-app/manual-validation-test.md` | ⬜ |

### 🔧 設定ファイル更新

| No. | ファイル | アクション | 実施済 |
|-----|---------|-----------|--------|
| 11 | `.gitignore` | テストファイルパターンを追加 | ⬜ |

### 各ファイル削除後のGitコマンド例

```bash
# ファイル削除後
git add -A
git commit -m "chore: 不要なテストファイル[ファイル名]を削除"
git push origin develop
```

---
作成日: 2025年8月4日
最終更新: 2025年8月4日