# AI市場分析と公示地価検索を閉じる際の影響範囲

**作成日**: 2025-10-27
**目的**: AI市場分析機能と公示地価検索機能を完全にクローズする際の影響範囲を明確化

---

## 1. 現在の対応状況（メンテナンス中）

### ✅ 既に実装済みの対応
- メンテナンス画面の表示（MarketAnalysis.tsx, LandPrice.tsx）
- サイドメニューから非表示（Layout.tsx）
- メンテナンス案内バナー（MaintenanceNotice.tsx）
- 有料プランのアップグレード機能無効化
- LandingPageの文言修正（「シミュレーション」に焦点）

---

## 2. 完全にクローズする場合の影響範囲

### A. フロントエンド

#### 削除対象ファイル
```
bolt_front/src/pages/
├── MarketAnalysis.tsx  # AI市場分析ページ
└── LandPrice.tsx       # 公示地価検索ページ

bolt_front/src/components/
└── MaintenanceNotice.tsx  # メンテナンス案内（不要になる）
```

#### 修正対象ファイル

**1. ルーティング設定**
- `bolt_front/src/App.tsx`
  - `/market-analysis` ルートを削除
  - `/land-prices` ルートを削除

**2. ナビゲーションメニュー**
- `bolt_front/src/components/Layout.tsx`
  - コメントアウトされたメニュー項目を完全削除（既にコメントアウト済み）

**3. マイページ**
- `bolt_front/src/pages/MyPage.tsx`
  - AI市場分析カード（機能2）を削除
  - 公示地価検索カード（機能3）を削除
  - MaintenanceNoticeコンポーネントのimportと表示を削除

**4. ランディングページ**
- `bolt_front/src/pages/LandingPage.tsx`
  - MaintenanceNoticeコンポーネントのimportと表示を削除
  - 機能紹介セクション（機能1・機能3）を削除または修正
    - 01: AI市場分析 → 削除
    - 03: 公示地価検索 → 削除
    - 02: 収益シミュレーション → 残す
  - 料金プラン表からAI市場分析・公示地価検索の行を削除
  - よくある質問（Q2）の文言修正
    - 「AI市場分析・収益シミュレーション・公示地価検索の全機能」
    - → 「収益シミュレーション機能」

**5. 料金プランページ**
- `bolt_front/src/pages/PremiumPlan.tsx`
  - 料金表からAI市場分析・公示地価検索の行を削除
  - MaintenanceNoticeコンポーネントのimportと表示を削除（既に追加済み）

**6. 使用回数管理**
- `bolt_front/src/hooks/useUsageStatus.ts`
  - AI市場分析・公示地価検索のカウント処理を削除
  - 統合カウント（market_analysis + land_price + simulator）を削除
  - シミュレーターのみのカウントに変更

- `bolt_front/src/utils/usageLimit.ts`
  - feature_type: 'market_analysis', 'land_price' の処理を削除

**7. メンテナンス案内**
- `bolt_front/src/components/MaintenanceNotice.tsx`
  - 完全削除（メンテナンスではなく機能終了のため不要）

---

### B. バックエンド

#### 影響範囲
**特になし**（現時点で専用APIは実装していない）

ただし、以下を確認：
- `backend/property-api/` - 国土交通省API連携コード
  - 使用していなければ削除可能
  - 使用している場合は残す

---

### C. データベース（Supabase）

#### 影響範囲
**1. usage_records テーブル**
- `feature_type` カラムに以下の値が記録されている
  - 'market_analysis'
  - 'land_price'
  - 'simulator'
- **対応**: 過去のレコードは残してOK（削除不要）

**2. subscriptions テーブル**
- 影響なし（有料プラン自体は残るため）

---

### D. その他

#### 1. README.md
```markdown
## ⚠️ 【重要なお知らせ】機能の一時メンテナンスについて

サービス品質向上のため、以下の機能を一時的にメンテナンス中とさせていただいております。

- **AI市場分析** - メンテナンス中  ← 削除
- **公示地価検索** - メンテナンス中  ← 削除
- **有料プラン（ベーシックプラン）** - 現在無料プランのみ提供しております

※ **収益シミュレーター**は通常通りご利用いただけます
```

**修正後**:
```markdown
## ⚠️ 【重要なお知らせ】サービス内容変更について

サービス品質向上のため、以下の変更を実施しました。

- **有料プラン（ベーシックプラン）** - 現在無料プランのみ提供しております
- **収益シミュレーター**を中心としたサービスとして提供中
```

#### 2. プレスリリース・外部告知
- PR TIMES等のプレスリリースを修正（ユーザー自身で対応）
- サービス内容の変更をお知らせページに追記

#### 3. SEO対策
- sitemap.xmlから該当ページを削除
- robots.txtで該当パスをDisallow追加（必要に応じて）

---

## 3. 作業手順（推奨）

### Phase 1: ファイル削除
1. MarketAnalysis.tsx を削除
2. LandPrice.tsx を削除
3. MaintenanceNotice.tsx を削除

### Phase 2: ルーティング修正
1. App.tsx からルート定義を削除
2. 404エラーになることを確認

### Phase 3: UI修正
1. LandingPage.tsx の機能紹介セクションを修正
2. LandingPage.tsx の料金プラン表を修正
3. MyPage.tsx のカード表示を修正
4. PremiumPlan.tsx の料金プラン表を修正

### Phase 4: 使用回数管理修正
1. useUsageStatus.ts を修正（シミュレーターのみカウント）
2. usageLimit.ts を修正

### Phase 5: ドキュメント修正
1. README.md を修正
2. 外部告知の準備

### Phase 6: テスト
1. 全ページの表示確認
2. シミュレーター機能の動作確認
3. 使用回数カウントの動作確認
4. 404エラーが適切に表示されるか確認

### Phase 7: デプロイ
1. developブランチにコミット・プッシュ
2. 動作確認
3. mainブランチにマージ
4. 本番デプロイ

---

## 4. リスク評価

### 低リスク
- ✅ ファイル削除（使用されていない機能のため）
- ✅ ルーティング削除（該当ページへのアクセスが少ない）
- ✅ UI修正（視覚的な変更のみ）

### 中リスク
- ⚠️ 使用回数管理の修正（ロジック変更が必要）
  - **対策**: 十分なテストを実施

### 高リスク
- ❌ なし

---

## 5. ロールバック計画

万が一問題が発生した場合：

1. **即座のロールバック**: GitHubでPRをRevert
2. **部分的なロールバック**: メンテナンス画面に戻す
   - MarketAnalysis.tsx, LandPrice.tsx を復活
   - MaintenanceNotice.tsx を復活
   - ルーティングを復活

---

## 6. 完了後の状態

### サービス構成
- ✅ 収益シミュレーター（月5回まで無料）
- ❌ AI市場分析（機能削除）
- ❌ 公示地価検索（機能削除）
- ❌ 有料プラン（新規募集停止中）

### 法的リスク
- ✅ ほぼゼロ（無料の計算ツールのみ提供）
- ✅ 外部データ利用なし（国土交通省APIを使わない）
- ✅ 金銭的取引なし（有料会員募集停止中）

---

## 7. 参考情報

### 関連ドキュメント
- `docs_md/16_AI市場分析/AI市場分析_法的リスク評価.md`
- `docs_md/12_法務・宅建法/`
- `docs_md/本番リリースチェックリスト.md`

### 主要な変更コミット
- `feat: 有料プラン機能を一時停止し無料会員のみ提供に変更` (c618423)
- `fix: LandingPageのメインビジュアルをシミュレーション中心に変更`

---

## 8. チェックリスト

### 実装前
- [ ] 現在のユーザー利用状況を確認（該当機能の利用者数）
- [ ] 弁護士確認の結果を待つ
- [ ] プレスリリース修正内容を準備

### 実装中
- [ ] Phase 1-7の作業を順番に実施
- [ ] 各フェーズごとに動作確認

### 実装後
- [ ] 本番環境での動作確認
- [ ] プレスリリースを修正・公開
- [ ] お知らせページに変更内容を追記
- [ ] サポートチームへの周知

---

**最終更新**: 2025-10-27
**作成者**: Claude (AI Assistant)
