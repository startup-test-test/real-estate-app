# AI市場分析と公示地価検索を閉じる際の影響範囲

**作成日**: 2025-10-27
**目的**: AI市場分析機能と公示地価検索機能を完全にクローズする際の影響範囲を明確化

---

## 1. 現在の対応状況（メンテナンス中）

### ✅ 既に実装済みの対応
- メンテナンス画面の表示（MarketAnalysis.tsx, LandPrice.tsx）
- サイドメニューから非表示（Layout.tsx）
- メンテナンス案内バナー（MaintenanceNotice.tsx）
- 有料プランのアップグレード機能無効化
- LandingPageの文言修正（「シミュレーション」に焦点）

---

## 2. 完全にクローズする場合の影響範囲

### A. フロントエンド

#### 削除対象ファイル
```
bolt_front/src/pages/
├── MarketAnalysis.tsx  # AI市場分析ページ（メンテナンス画面）
└── LandPrice.tsx       # 公示地価検索ページ（メンテナンス画面）

bolt_front/src/components/
└── MaintenanceNotice.tsx  # メンテナンス案内（不要になる）
```

#### 修正対象ファイル（詳細版）

**1. ルーティング設定**
- `bolt_front/src/App.tsx`
  - Line 16: `import MarketAnalysis from './pages/MarketAnalysis';` → 削除
  - Line 17: `import LandPrice from './pages/LandPrice';` → 削除
  - Line 91: `<Route path="/market-analysis" element={<MarketAnalysis />} />` → 削除
  - Line 92: `<Route path="/land-prices" element={<LandPrice />} />` → 削除

**2. ナビゲーションメニュー**
- `bolt_front/src/components/Layout.tsx`
  - Line 75-76: コメントアウトされたメニュー項目を完全削除
    ```tsx
    // { name: 'AI市場分析', href: '/market-analysis', icon: TrendingUp, badge: 'NEW' },
    // { name: '公示地価検索', href: '/land-prices', icon: MapPin, badge: 'NEW' },
    ```

**3. マイページ**
- `bolt_front/src/pages/MyPage.tsx`
  - Line 720-730: AI市場分析カードのコメントアウトを完全削除
  - Line 735-745: 公示地価検索カードのコメントアウトを完全削除
  - Line 776-783: AI市場分析機能のコメントアウトを完全削除
  - Line 911-912: シミュレーターとAI市場分析の統合カウント処理を削除
  - MaintenanceNoticeコンポーネントのimportと表示を削除

**4. ランディングページ**
- `bolt_front/src/pages/LandingPage.tsx`
  - MaintenanceNoticeコンポーネントのimportと表示を削除
  - Line 229-281: 機能01「AI市場分析」セクション（既にコメントアウト済み）を完全削除
  - Line 343-404: 機能03「公示地価検索」セクション（既にコメントアウト済み）を完全削除
  - Line 564: 料金プラン表「AI市場分析」行を削除
  - Line 585: 料金プラン表「公示地価検索」行を削除
  - Line 630: フリープラン「AI市場分析」行を削除
  - Line 638: フリープラン「公示地価検索」行を削除
  - Line 659: ベーシックプラン「AI市場分析」行を削除
  - Line 670: ベーシックプラン「公示地価検索」行を削除
  - Line 691: プレミアムプラン「AI市場分析」行を削除
  - Line 699: プレミアムプラン「公示地価検索」行を削除
  - Line 870: よくある質問の文言修正
    - 「無料プランでは月5回まで、AI市場分析・収益シミュレーション・公示地価検索の全機能をご利用いただけます。」
    - → 「無料プランでは月5回まで収益シミュレーション機能をご利用いただけます。」
  - Line 1050: ニュースセクションの文言修正
    - 「AI市場分析と公示地価検索をリリースしました。」
    - → 削除または修正

**5. 料金プランページ**
- `bolt_front/src/pages/PremiumPlan.tsx`
  - Line 178: 「月額4,980円で収益シミュレーターとAI市場分析を無制限でご利用いただけます」→ 修正
  - Line 343: 料金プラン表「AI市場分析」行を削除
  - Line 360: 料金プラン表「公示地価検索」行を削除
  - MaintenanceNoticeコンポーネントのimportと表示を削除

**6. パンくずリスト**
- `bolt_front/src/components/Breadcrumb.tsx`
  - Line 30-33: AI市場分析・公示地価検索のパンくず処理を削除
    ```tsx
    } else if (path.includes('/market-analysis')) {
      breadcrumbs.push({ name: 'AI市場分析', path: '/market-analysis', current: true });
    } else if (path.includes('/land-prices')) {
      breadcrumbs.push({ name: '公示地価検索', path: '/land-prices', current: true });
    ```

**7. 戻るボタン**
- `bolt_front/src/components/BackButton.tsx`
  - Line 35: AI市場分析ページの戻るボタン処理を削除
    ```tsx
    if (location.pathname.includes('/market-analysis')) return 'マイページへ戻る';
    ```

**8. APIサービス**
- `bolt_front/src/services/propertyApi.ts`
  - Line 151-165: `getLandPrices()` メソッドを削除
  - Line 168-198: `generateMarketAnalysisSummary()` メソッドを削除
  - Line 201-213: `analyzeWithML()` メソッドを削除（必要に応じて）
  - Line 215-263: `simpleMLAnalysis()` メソッドを削除（必要に応じて）

**9. API設定**
- `bolt_front/src/config/api.ts`
  - Line 51: `return ${getSimulatorApiUrl()}/api/market-analysis;` を削除

**10. 型定義**
- `bolt_front/src/types/results.ts`
  - Line 36-61: `MarketAnalysisData`, `MarketAnalysis` インターフェースを削除（使用されていない場合）

**11. Supabaseフック**
- `bolt_front/src/hooks/useSupabaseData.ts`
  - Line 3: `import type { Property, Simulation, MarketAnalysis } from '../types'` から `MarketAnalysis` を削除
  - Line 334-405: `saveMarketAnalysis()` 関数を削除

**12. メンテナンス案内**
- `bolt_front/src/components/MaintenanceNotice.tsx`
  - Line 28-29: 全体を削除（ファイルごと削除）

---

### B. バックエンド

#### 影響範囲
**特になし**（現時点で専用APIは実装していない）

ただし、以下を確認：さ
- `backend/property-api/` - 国土交通省API連携コード
  - 使用していなければ削除可能
  - 使用している場合は残す

---

### C. データベース（Supabase）

#### 影響範囲
**1. usage_records テーブル**
- `feature_type` カラムに以下の値が記録されている
  - 'market_analysis'
  - 'land_price'
  - 'simulator'
- **対応**: 過去のレコードは残してOK（削除不要）

**2. subscriptions テーブル**
- 影響なし（有料プラン自体は残るため）

---

### D. その他

#### 1. README.md
```markdown
## ⚠️ 【重要なお知らせ】機能の一時メンテナンスについて

サービス品質向上のため、以下の機能を一時的にメンテナンス中とさせていただいております。

- **AI市場分析** - メンテナンス中  ← 削除
- **公示地価検索** - メンテナンス中  ← 削除
- **有料プラン（ベーシックプラン）** - 現在無料プランのみ提供しております

※ **収益シミュレーター**は通常通りご利用いただけます
```

**修正後**:
```markdown
## ⚠️ 【重要なお知らせ】サービス内容変更について

サービス品質向上のため、以下の変更を実施しました。

- **有料プラン（ベーシックプラン）** - 現在無料プランのみ提供しております
- **収益シミュレーター**を中心としたサービスとして提供中
```

#### 2. プレスリリース・外部告知
- PR TIMES等のプレスリリースを修正（ユーザー自身で対応）
- サービス内容の変更をお知らせページに追記

#### 3. SEO対策
- sitemap.xmlから該当ページを削除
- robots.txtで該当パスをDisallow追加（必要に応じて）

---

## 3. 文言修正の詳細内容

### A. LandingPage.tsx の文言修正

#### 修正1: Line 870（よくある質問 Q2の回答）
**変更前**:
```tsx
無料プランでは月5回まで、AI市場分析・収益シミュレーション・公示地価検索の全機能をご利用いただけます。
```

**変更後**:
```tsx
無料プランでは月5回まで収益シミュレーション機能をご利用いただけます。
```

#### 修正2: Line 1050（ニュースセクション）
**変更前**:
```tsx
AI市場分析と公示地価検索をリリースしました。
```

**変更後**:
```tsx
収益シミュレーターをリリースしました。
```
または削除

#### 修正3: Line 564, 585, 630, 638, 659, 670, 691, 699（料金プラン比較表）
全ての「AI市場分析」「公示地価検索」の行を削除

### B. PremiumPlan.tsx の文言修正

#### 修正1: Line 178（プラン説明文）
**変更前**:
```tsx
月額4,980円で収益シミュレーターとAI市場分析を無制限でご利用いただけます
```

**変更後**:
```tsx
月額4,980円で収益シミュレーターを無制限でご利用いただけます
```

#### 修正2: Line 343, 360（料金プラン比較表）
「AI市場分析」「公示地価検索」の行を削除

### C. README.md の文言修正

#### 修正1: メンテナンス案内セクション
**変更前**:
```markdown
## ⚠️ 【重要なお知らせ】機能の一時メンテナンスについて

サービス品質向上のため、以下の機能を一時的にメンテナンス中とさせていただいております。

- **AI市場分析** - メンテナンス中
- **公示地価検索** - メンテナンス中
- **有料プラン（ベーシックプラン）** - 現在無料プランのみ提供しております

※ **収益シミュレーター**は通常通りご利用いただけます
```

**変更後**:
```markdown
## ⚠️ 【重要なお知らせ】サービス内容について

現在、収益シミュレーターを中心としたサービスとして提供しております。

- **有料プラン（ベーシックプラン）** - 現在無料プランのみ提供しております
- **収益シミュレーター** - 無料プランで月5回までご利用いただけます
```

---

## 4. 作業手順（推奨）

### Phase 1: ファイル削除
1. `bolt_front/src/pages/MarketAnalysis.tsx` を削除
2. `bolt_front/src/pages/LandPrice.tsx` を削除
3. `bolt_front/src/components/MaintenanceNotice.tsx` を削除

### Phase 2: ルーティング修正
1. `App.tsx` からルート定義を削除（Line 16, 17, 91, 92）
2. 404エラーになることを確認

### Phase 3: コンポーネント修正
1. `Layout.tsx` - コメントアウト行を完全削除（Line 75-76）
2. `Breadcrumb.tsx` - AI市場分析・公示地価検索のパンくず処理削除（Line 30-33）
3. `BackButton.tsx` - AI市場分析の戻るボタン処理削除（Line 35）

### Phase 4: ページUI修正
1. `LandingPage.tsx` の文言修正（上記の修正1-3を実施）
2. `PremiumPlan.tsx` の文言修正（上記の修正1-2を実施）
3. `MyPage.tsx` のコメントアウト削除（Line 720-745, 776-783, 911-912）

### Phase 5: API・型定義修正
1. `propertyApi.ts` - 国土交通省API関連メソッド削除（Line 151-263）
2. `config/api.ts` - market-analysis関連削除（Line 51）
3. `types/results.ts` - MarketAnalysis型削除（Line 36-61）
4. `useSupabaseData.ts` - saveMarketAnalysis関数削除（Line 3, 334-405）

### Phase 6: ドキュメント修正
1. `README.md` を修正（上記の修正1を実施）
2. 外部告知の準備

### Phase 7: テスト
1. 全ページの表示確認
2. シミュレーター機能の動作確認
3. 使用回数カウントの動作確認
4. `/market-analysis`, `/land-prices` にアクセスして404エラー確認
5. コンソールエラーの確認

### Phase 8: デプロイ
1. developブランチにコミット・プッシュ
2. 動作確認
3. mainブランチにマージ
4. 本番デプロイ

---

## 5. リスク評価

### 低リスク
- ✅ ファイル削除（使用されていない機能のため）
- ✅ ルーティング削除（該当ページへのアクセスが少ない）
- ✅ UI修正（視覚的な変更のみ）

### 中リスク
- ⚠️ 使用回数管理の修正（ロジック変更が必要）
  - **対策**: 十分なテストを実施

### 高リスク
- ❌ なし

---

## 6. ロールバック計画

万が一問題が発生した場合：

1. **即座のロールバック**: GitHubでPRをRevert
2. **部分的なロールバック**: メンテナンス画面に戻す
   - MarketAnalysis.tsx, LandPrice.tsx を復活
   - MaintenanceNotice.tsx を復活
   - ルーティングを復活

---

## 7. 完了後の状態

### サービス構成
- ✅ 収益シミュレーター（月5回まで無料）
- ❌ AI市場分析（機能削除）
- ❌ 公示地価検索（機能削除）
- ❌ 有料プラン（新規募集停止中）

### 法的リスク
- ✅ ほぼゼロ（無料の計算ツールのみ提供）
- ✅ 外部データ利用なし（国土交通省APIを使わない）
- ✅ 金銭的取引なし（有料会員募集停止中）

---

## 8. 参考情報

### 関連ドキュメント
- `docs_md/16_AI市場分析/AI市場分析_法的リスク評価.md`
- `docs_md/12_法務・宅建法/`
- `docs_md/本番リリースチェックリスト.md`

### 主要な変更コミット
- `feat: 有料プラン機能を一時停止し無料会員のみ提供に変更` (c618423)
- `fix: LandingPageのメインビジュアルをシミュレーション中心に変更`

---

## 9. チェックリスト

### 実装前
- [ ] 現在のユーザー利用状況を確認（該当機能の利用者数）
- [ ] 弁護士確認の結果を待つ
- [ ] プレスリリース修正内容を準備

### 実装中
- [ ] Phase 1-7の作業を順番に実施
- [ ] 各フェーズごとに動作確認

### 実装後
- [ ] 本番環境での動作確認
- [ ] プレスリリースを修正・公開
- [ ] お知らせページに変更内容を追記
- [ ] サポートチームへの周知

---

**最終更新**: 2025-10-27
**作成者**: Claude (AI Assistant)
