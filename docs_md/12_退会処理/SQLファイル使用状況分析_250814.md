# SQLファイル使用状況分析レポート

**作成日**: 2025年8月14日  
**対象フォルダ**: docs_md/12_退会処理/

## 📊 SQLファイル一覧と使用状況

### 調査対象SQLファイル（7個）

| No | ファイル名 | 用途 | 使用状況 | 判定 |
|----|-----------|------|----------|------|
| 1 | `supabase_dashboard_setup.sql` | プラン解約機能のDB設定 | ドキュメントで参照なし | 🗑️ **削除可能** |
| 2 | `test_subscription_create.sql` | テスト用サブスクリプション作成（内容が不正） | ドキュメントで参照なし | 🗑️ **削除可能** |
| 3 | `test_subscription_with_user.sql` | ユーザー付きテストデータ作成 | ドキュメントで参照なし | 🗑️ **削除可能** |
| 4 | `vault_secret_setup.sql` | Vault設定（Stripeキー） | ドキュメントで参照なし | 🗑️ **削除可能** |
| 5 | `解約キャンセル.sql` | 解約キャンセル用SQL | ドキュメントで参照なし | 🗑️ **削除可能** |
| 6 | `解約キャンセル_安全版.sql` | 解約キャンセル（安全版） | ドキュメントで参照なし | 🗑️ **削除可能** |
| 7 | `解約キャンセル_簡単版.sql` | 解約キャンセル（簡単版） | ドキュメントで参照なし | 🗑️ **削除可能** |

## 🔍 調査結果

### 実際に使用されているSQLファイル

ドキュメントで参照されている本番用SQLファイル：
- `/supabase/migrations/20250813_add_cancel_subscription_fields.sql` - 本番マイグレーション
- `/supabase/migrations/20250814_add_unique_subscription_constraint.sql` - 制約追加

**重要**: これらは`supabase/migrations/`フォルダにあり、今回の調査対象外です。

### docs_md/12_退会処理/内のSQLファイル

**全7ファイルが削除可能**と判定：
- どのドキュメントからも参照されていない
- テスト・設定用の一時ファイル
- 本番環境では`supabase/migrations/`のファイルを使用
- これらはドキュメント用のサンプルコード

## ⚠️ 特記事項

### test_subscription_create.sql の内容異常

このファイルは内容が正しくありません：
```
解約が完了しました。2025/9/12まで全機能をご利用いただけます（残り30日） 3. Settings タブ
  4. Environment Variables で Add Variable
```
SQLではなくテキストメッセージが含まれています。

## 🎯 推奨アクション

### 削除推奨（全7ファイル）

```bash
cd /workspaces/real-estate-app/docs_md/12_退会処理
rm -f supabase_dashboard_setup.sql \
      test_subscription_create.sql \
      test_subscription_with_user.sql \
      vault_secret_setup.sql \
      解約キャンセル.sql \
      解約キャンセル_安全版.sql \
      解約キャンセル_簡単版.sql
```

## 📈 削除による影響

| 観点 | 評価 | 理由 |
|------|------|------|
| **本番環境への影響** | なし | 本番は`supabase/migrations/`を使用 |
| **開発環境への影響** | なし | テスト用SQLは不要 |
| **ドキュメントへの影響** | なし | どのMDファイルからも参照なし |
| **履歴価値** | 低 | サンプルコードのため価値低 |

## 💡 今後の方針

1. **SQLファイルの配置ルール**
   - 本番用: `supabase/migrations/`
   - ドキュメント内のSQLコード: MDファイル内にコードブロックで記載
   - 一時ファイル: 作業後即削除

2. **ドキュメント整理**
   - SQLファイルを別ファイルにせず、MDファイル内に埋め込む
   - 必要に応じてコードブロックで管理

## 🗑️ 削除統計

| カテゴリ | ファイル数 |
|---------|-----------|
| 削除可能 | 7個 |
| 保持必要 | 0個 |
| **合計** | **7個** |

## 結論

docs_md/12_退会処理/内の**全7個のSQLファイルは削除可能**です。これらは：
- テスト・サンプル用のファイル
- どのドキュメントからも参照されていない
- 本番環境では使用されていない
- 内容が重複または不正（test_subscription_create.sql）

削除しても影響はありません。