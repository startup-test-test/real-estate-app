# URL変更手順書

作成日: 2025年8月17日  
変更内容: トップページをランディングページに、ダッシュボードを/mypageに変更

## 📋 変更概要

### 現在のURL構成
```
/ → ダッシュボード（要ログイン）
/landing → ランディングページ（公開）
```

### 変更後のURL構成
```
/ → ランディングページ（公開）※LandingPage.tsxを表示
/mypage → マイページ（旧ダッシュボード、要ログイン）
/landing → 廃止（/にリダイレクト、または404）
```

**正確な変更内容**：
- LandingPage.tsxコンポーネントは**削除しません**
- `/landing`というURLパスを廃止し、`/`で同じコンテンツを表示
- つまり、LandingPage.tsxを`/`のルートで使用

## 🔒 セキュリティ・CORS設定への影響

### 影響なし（URL変更による修正不要）
以下の設定はドメイン名（dev.ooya.tech、ooya.tech）は変わらないため、**修正不要**です：

#### 1. バックエンド CORS設定
**📄 `/backend/simulator-api/app.py`（30行目）**
```python
# 現在の設定（修正不要）
allow_origin_regex=r"...|https://dev\.ooya\.tech|https://ooya\.tech)$"
```
→ ドメインは変わらないので修正不要

#### 2. フロントエンド環境判定
**📄 `/bolt_front/src/config/environment.ts`（21、26行目）**
```typescript
// 現在の設定（修正不要）
if (hostname === 'ooya.tech') { return Environment.PRODUCTION; }
if (hostname === 'dev.ooya.tech') { return Environment.DEVELOPMENT; }
```
→ ドメインは変わらないので修正不要

#### 3. Supabase Edge Functions
**📄 `/supabase/functions/create-checkout-session/index.ts`（31-32行目）**
```typescript
// 現在の設定（修正不要）
'ooya.tech',          // 本番
'staging.ooya.tech',  // ステージング（未使用）
```
→ ドメインは変わらないので修正不要

#### 4. Basic認証設定
**📄 `/server-configs/dev/.htaccess`（46行目）**
```apache
# 現在の設定（修正不要）
AuthUserFile /home/xs565244/ooya.tech/public_html/dev.ooya.tech/.htpasswd
```
→ サーバー側の設定は変わらない

#### 5. GitHub Actions デプロイパス
**📄 `/.github/workflows/deploy-to-xserver-dev.yml`（73、88、98行目）**
```yaml
# 現在の設定（修正不要）
server-dir: /ooya.tech/public_html/dev.ooya.tech/
```
→ サーバーのディレクトリ構造は変わらない

## ⚠️ 追加で発見された影響箇所

### windowオブジェクト関連
#### 📄 `/bolt_front/src/pages/Dashboard.tsx`
```typescript
// windowオブジェクトのプロパティ名（132, 133, 139, 232, 237行目）
(window as any).dashboardDataRefreshed
(window as any).lastDashboardUpdate
↓
// MyPageに変更後
(window as any).mypageDataRefreshed
(window as any).lastMypageUpdate
```

### バックボタンのラベル
#### 📄 `/bolt_front/src/components/BackButton.tsx`
```typescript
// 変更箇所（32-38行目）
// 現在「マイページへ戻る」となっているが、そのままで問題なし
// （URLが/mypageに変わっても表記は適切）
```

### ナビゲーションメニュー
#### 📄 `/bolt_front/src/components/Layout.tsx`
```typescript
// 変更箇所（64行目）
{ name: 'マイページ', href: '/', icon: Home },
↓
{ name: 'マイページ', href: '/mypage', icon: Home },
```

## 🔧 変更が必要なファイル一覧（完全版）

### 1. ルーティング設定

#### 📄 `/bolt_front/src/App.tsx`
```typescript
// 変更前（64行目〜）
<Route path="/" element={
  <ProtectedRoute>
    <Layout />
  </ProtectedRoute>
}>
  <Route index element={<Dashboard />} />

// 変更後
<Route path="/" element={<LandingPage />} />
<Route path="/mypage" element={
  <ProtectedRoute>
    <Layout />
  </ProtectedRoute>
}>
  <Route index element={<MyPage />} />
```

### 2. ページコンポーネント

#### 📄 `/bolt_front/src/pages/Dashboard.tsx`
```typescript
// ファイル名変更
Dashboard.tsx → MyPage.tsx

// コンポーネント名変更
const Dashboard: React.FC = () => {
↓
const MyPage: React.FC = () => {

// エクスポート変更（1114行目）
export default Dashboard;
↓
export default MyPage;
```

#### 📄 `/bolt_front/src/pages/index.ts`
```typescript
// 変更前（13行目）
export { default as Dashboard } from './Dashboard';

// 変更後
export { default as MyPage } from './MyPage';
```

### 3. ログイン後のリダイレクト

#### 📄 `/bolt_front/src/pages/Login.tsx`
```typescript
// 変更箇所（117, 135, 184, 202行目）
navigate('/');
↓
navigate('/mypage');
```

#### 📄 `/bolt_front/src/pages/AuthCallback.tsx`
```typescript
// 変更箇所（44, 73, 100行目）
navigate('/', { replace: true });
↓
navigate('/mypage', { replace: true });
```

#### 📄 `/bolt_front/src/pages/PaymentResult.tsx`
```typescript
// 変更箇所（66, 70行目）
navigate('/dashboard');
↓
navigate('/mypage');

// 変更箇所（178, 201行目）
onClick={() => navigate('/dashboard')}
↓
onClick={() => navigate('/mypage')}
```

### 4. ナビゲーション

#### 📄 `/bolt_front/src/components/Layout.tsx`
```typescript
// 変更箇所（123行目）
<Link to="/" className="block">
↓
<Link to="/mypage" className="block">
```

#### 📄 `/bolt_front/src/components/Breadcrumb.tsx`
```typescript
// 変更箇所（23行目）
const breadcrumbs: BreadcrumbItem[] = [
  { label: 'ホーム', path: '/' },
↓
const breadcrumbs: BreadcrumbItem[] = [
  { label: 'マイページ', path: '/mypage' },
```

### 5. 認証保護ロジック

#### 📄 `/bolt_front/src/App.tsx`
```typescript
// ProtectedRouteコンポーネント（25〜46行目）
// 変更前
const ProtectedRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  // ... 
  if (!user) {
    return <Navigate to="/login" />;
  }
  // ...
}

// 変更後（必要に応じて）
// ログイン済みユーザーがトップページ（/）にアクセスした場合の処理を追加
const ProtectedRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  // ... 
  if (!user) {
    return <Navigate to="/login" />;
  }
  // ...
}
```

### 6. インポート文の修正

#### 📄 `/bolt_front/src/App.tsx`
```typescript
// 変更前（9行目）
import Dashboard from './pages/Dashboard';

// 変更後
import MyPage from './pages/MyPage';
```

### 7. テストファイル

#### 📄 `/bolt_front/src/tests/security-scenarios.test.tsx`
```typescript
// 変更前（6行目）
import Dashboard from '../pages/Dashboard';

// 変更後
import MyPage from '../pages/MyPage';

// 変更前（101, 122行目）
renderWithRouter(<Dashboard />);

// 変更後
renderWithRouter(<MyPage />);
```

### 8. その他のファイル

#### 📄 `/bolt_front/src/README.md`
```markdown
// 変更前（19行目）
- **メイン機能**: Dashboard, PropertyDetail

// 変更後
- **メイン機能**: MyPage, PropertyDetail
```

## 📝 実装手順

### Step 1: ファイルリネーム
```bash
cd bolt_front/src/pages
mv Dashboard.tsx MyPage.tsx
```

### Step 2: コード内の変更
1. MyPage.tsx内のコンポーネント名変更
2. MyPage.tsx内のwindowオブジェクトプロパティ名変更（5箇所）
3. index.tsのエクスポート変更
4. App.tsxのインポートとルーティング変更

### Step 3: リダイレクト先の変更
1. Login.tsx（4箇所）
2. AuthCallback.tsx（3箇所）
3. PaymentResult.tsx（4箇所）

### Step 4: ナビゲーション修正
1. Layout.tsx（ロゴクリック）
2. Breadcrumb.tsx（ホーム表記）

### Step 5: テスト
```bash
# ローカルで動作確認
npm run dev

# テスト実行
npm test
```

## ⚠️ 注意事項

### 影響範囲
- **ブックマーク**: 既存ユーザーのブックマーク（/）が変わる
- **SEO**: トップページのコンテンツが変わる
- **アナリティクス**: トラッキング設定の見直しが必要

### 移行対応
```typescript
// App.tsxに一時的なリダイレクトを追加（オプション）
<Route path="/dashboard" element={<Navigate to="/mypage" replace />} />
<Route path="/landing" element={<Navigate to="/" replace />} />
```

### ログイン済みユーザーの扱い
ログイン済みユーザーがトップページ（/）にアクセスした場合：
- **オプション1**: そのままランディングページを表示（推奨）
- **オプション2**: 自動的に/mypageにリダイレクト

## ✅ チェックリスト

### 実装前
- [ ] バックアップ作成
- [ ] 現在の動作確認

### 実装中
- [ ] Dashboard.tsx → MyPage.tsxにリネーム
- [ ] コンポーネント名をMyPageに変更
- [ ] windowオブジェクトプロパティ名変更（5箇所）
- [ ] App.tsxのルーティング変更
- [ ] Login.tsxのリダイレクト先変更（4箇所）
- [ ] AuthCallback.tsxのリダイレクト先変更（3箇所）
- [ ] PaymentResult.tsxのリダイレクト先変更（4箇所）
- [ ] Layout.tsxのロゴリンク変更
- [ ] Layout.tsxのナビゲーションメニュー変更
- [ ] Breadcrumb.tsxのホーム表記変更
- [ ] BackButton.tsxのデフォルトパス変更
- [ ] index.tsのエクスポート変更
- [ ] テストファイルの修正

### 実装後
- [ ] ローカルで動作確認
- [ ] 各ページへのアクセス確認
- [ ] ログインフロー確認
- [ ] ナビゲーション動作確認
- [ ] テスト実行（npm test）

## 🚀 デプロイ

### 開発環境
```bash
git add .
git commit -m "feat: トップページをランディングに変更、ダッシュボードを/mypageに移動"
git push origin develop
```

### 本番環境
```bash
git checkout main
git merge develop
git push origin main
```

## 📊 変更の影響度

| 項目 | 影響度 | 説明 |
|------|--------|------|
| **ユーザー体験** | 高 | トップページが変わる |
| **SEO** | 高 | インデックスされるページが変わる |
| **既存機能** | 低 | 機能自体は変わらない |
| **パフォーマンス** | なし | 変更なし |

---

作成: 2025/08/17  
実施予定日: ___________  
実施者: ___________