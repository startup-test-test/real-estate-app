# Stripeæ±ºæ¸ˆ UIä»•æ§˜æ›¸

ä½œæˆæ—¥: 2025å¹´8æœˆ12æ—¥  
ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0 (MVPç‰ˆ)

## 1. æ¦‚è¦

Stripeæ±ºæ¸ˆæ©Ÿèƒ½ã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®UIè¦ç´ ã®ä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æœ€å„ªå…ˆã«ã€ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

## 2. UIæ§‹æˆè¦ç´ 

### 2.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ˜ãƒƒãƒ€ãƒ¼                         â”‚
â”‚ â”œâ”€ ãƒ­ã‚´                         â”‚
â”‚ â””â”€ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒƒã‚¸ï¼ˆä¼šå“¡ã®ã¿ï¼‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ©ç”¨çŠ¶æ³ãƒãƒ¼                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„                  â”‚
â”‚ â”œâ”€ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼                â”‚
â”‚ â””â”€ å®Ÿè¡Œãƒœã‚¿ãƒ³ï¼ˆçŠ¶æ…‹å¤‰åŒ–ï¼‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå¿…è¦æ™‚ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°è¨­è¨ˆ

### 3.1 åˆ©ç”¨çŠ¶æ³è¡¨ç¤ºãƒãƒ¼ (UsageStatusBar)

#### 3.1.1 ç„¡æ–™ãƒ—ãƒ©ãƒ³ - é€šå¸¸çŠ¶æ…‹

```typescript
// components/UsageStatusBar.tsx
export const UsageStatusBar: React.FC = () => {
  const { usage } = useUsageStatus();
  
  if (usage.isSubscribed) return <PremiumStatusBar />;
  
  const remaining = usage.limit - usage.currentCount;
  const percentage = (usage.currentCount / usage.limit) * 100;
  
  return (
    <div className="bg-white border-b border-gray-200 px-4 py-3">
      <div className="max-w-7xl mx-auto flex items-center justify-between">
        <div className="flex items-center gap-4">
          {/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */}
          <div className="flex items-center gap-2">
            <span className="text-sm text-gray-600">åˆ©ç”¨çŠ¶æ³:</span>
            <div className="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
              <div 
                className={`h-full transition-all ${
                  percentage >= 80 ? 'bg-red-500' : 
                  percentage >= 60 ? 'bg-yellow-500' : 
                  'bg-blue-500'
                }`}
                style={{ width: `${percentage}%` }}
              />
            </div>
            <span className="text-sm font-medium">
              {usage.currentCount}/{usage.limit}å›
            </span>
          </div>
          
          {/* ãƒªã‚»ãƒƒãƒˆæ—¥è¡¨ç¤º */}
          <div className="flex items-center gap-1 text-sm text-gray-500">
            <Calendar className="h-4 w-4" />
            <span>
              æ¬¡å›ãƒªã‚»ãƒƒãƒˆ: {formatDate(usage.periodEndDate)} 
              ï¼ˆã‚ã¨{usage.daysLeft}æ—¥ï¼‰
            </span>
          </div>
        </div>
        
        {/* ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰CTAï¼ˆæ®‹ã‚Š2å›ä»¥ä¸‹ã§è¡¨ç¤ºï¼‰ */}
        {remaining <= 2 && (
          <button 
            onClick={openUpgradeModal}
            className="text-sm text-blue-600 hover:text-blue-700 font-medium"
          >
            ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§ç„¡åˆ¶é™åˆ©ç”¨ â†’
          </button>
        )}
      </div>
    </div>
  );
};
```

#### 3.1.2 ç„¡æ–™ãƒ—ãƒ©ãƒ³ - è­¦å‘ŠçŠ¶æ…‹ï¼ˆæ®‹ã‚Š1-2å›ï¼‰

```typescript
// è­¦å‘ŠãƒãƒŠãƒ¼è¡¨ç¤º
<div className="bg-yellow-50 border-b border-yellow-200 px-4 py-3">
  <div className="max-w-7xl mx-auto flex items-center justify-between">
    <div className="flex items-center gap-2">
      <AlertTriangle className="h-5 w-5 text-yellow-600" />
      <p className="text-sm font-medium text-yellow-800">
        åˆ©ç”¨å¯èƒ½å›æ•°ãŒæ®‹ã‚Š{remaining}å›ã§ã™
      </p>
    </div>
    <button className="px-4 py-1.5 bg-yellow-600 text-white text-sm 
                     rounded-md hover:bg-yellow-700">
      ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
    </button>
  </div>
</div>
```

#### 3.1.3 ç„¡æ–™ãƒ—ãƒ©ãƒ³ - ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ï¼ˆåˆ©ç”¨åˆ¶é™åˆ°é”ï¼‰

```typescript
// ã‚¨ãƒ©ãƒ¼ãƒãƒŠãƒ¼è¡¨ç¤º
<div className="bg-red-50 border-b border-red-200 px-4 py-3">
  <div className="max-w-7xl mx-auto flex items-center justify-between">
    <div className="flex items-center gap-2">
      <XCircle className="h-5 w-5 text-red-600" />
      <div>
        <p className="text-sm font-medium text-red-800">
          ä»Šæœˆã®ç„¡æ–™åˆ©ç”¨æ ã‚’ä½¿ã„åˆ‡ã‚Šã¾ã—ãŸ
        </p>
        <p className="text-xs text-red-600">
          ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§å¼•ãç¶šãã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™
        </p>
      </div>
    </div>
    <button className="px-4 py-2 bg-red-600 text-white rounded-md 
                     hover:bg-red-700 flex items-center gap-2">
      <CreditCard className="h-4 w-4" />
      ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ç¶šã‘ã‚‹
    </button>
  </div>
</div>
```

#### 3.1.4 ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡è¡¨ç¤º

```typescript
// ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼
<div className="bg-gradient-to-r from-purple-50 to-blue-50 border-b 
              border-purple-200 px-4 py-3">
  <div className="max-w-7xl mx-auto flex items-center justify-between">
    <div className="flex items-center gap-3">
      <div className="flex items-center gap-2">
        <Star className="h-5 w-5 text-yellow-500 fill-current" />
        <span className="text-sm font-medium text-purple-800">
          ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³
        </span>
      </div>
      <span className="text-sm text-gray-600">
        å…¨æ©Ÿèƒ½ãŒç„¡åˆ¶é™ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™
      </span>
    </div>
    <Link 
      to="/account/billing" 
      className="text-sm text-purple-600 hover:text-purple-700"
    >
      ãƒ—ãƒ©ãƒ³ç®¡ç† â†’
    </Link>
  </div>
</div>
```

### 3.2 ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè¡Œãƒœã‚¿ãƒ³

#### 3.2.1 ãƒœã‚¿ãƒ³çŠ¶æ…‹ç®¡ç†

```typescript
// components/SimulatorExecuteButton.tsx
interface ButtonProps {
  onExecute: () => void;
  isLoading?: boolean;
}

export const SimulatorExecuteButton: React.FC<ButtonProps> = ({ 
  onExecute, 
  isLoading 
}) => {
  const { usage } = useUsageStatus();
  const [showUpgradeModal, setShowUpgradeModal] = useState(false);
  
  const handleClick = async () => {
    // åˆ©ç”¨åˆ¶é™ãƒã‚§ãƒƒã‚¯
    if (!usage.canUse && !usage.isSubscribed) {
      setShowUpgradeModal(true);
      return;
    }
    
    // å®Ÿè¡Œå‡¦ç†
    await onExecute();
    
    // ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®å ´åˆã€åˆ©ç”¨å›æ•°ã‚’å¢—ã‚„ã™
    if (!usage.isSubscribed) {
      await incrementUsage(user.id, 'simulator');
      // åˆ©ç”¨çŠ¶æ³ã‚’å†å–å¾—
      await refetchUsage();
    }
  };
  
  // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡
  if (usage.isSubscribed) {
    return (
      <button
        onClick={handleClick}
        disabled={isLoading}
        className="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 
                 text-white font-medium rounded-lg hover:opacity-90
                 disabled:opacity-50 disabled:cursor-not-allowed
                 flex items-center justify-center gap-2"
      >
        {isLoading ? (
          <Loader2 className="h-5 w-5 animate-spin" />
        ) : (
          <>
            <Star className="h-5 w-5" />
            <span>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</span>
          </>
        )}
      </button>
    );
  }
  
  // ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆåˆ©ç”¨å¯èƒ½ï¼‰
  if (usage.canUse) {
    return (
      <>
        <button
          onClick={handleClick}
          disabled={isLoading}
          className="w-full px-6 py-3 bg-blue-600 text-white font-medium 
                   rounded-lg hover:bg-blue-700 disabled:opacity-50
                   flex items-center justify-center gap-2"
        >
          {isLoading ? (
            <Loader2 className="h-5 w-5 animate-spin" />
          ) : (
            <>
              <PlayCircle className="h-5 w-5" />
              <span>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</span>
              <span className="text-xs opacity-80">
                ï¼ˆæ®‹ã‚Š{usage.limit - usage.currentCount}å›ï¼‰
              </span>
            </>
          )}
        </button>
        
        {/* æ®‹ã‚Šå›æ•°ãŒå°‘ãªã„å ´åˆã®æ³¨æ„è¡¨ç¤º */}
        {usage.limit - usage.currentCount <= 2 && (
          <p className="mt-2 text-xs text-gray-500 text-center">
            ğŸ’¡ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§ç„¡åˆ¶é™åˆ©ç”¨ãŒå¯èƒ½ã§ã™
          </p>
        )}
      </>
    );
  }
  
  // ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆåˆ¶é™åˆ°é”ï¼‰
  return (
    <>
      <button
        onClick={() => setShowUpgradeModal(true)}
        className="w-full px-6 py-3 bg-gray-400 text-white font-medium 
                 rounded-lg cursor-not-allowed flex items-center 
                 justify-center gap-2"
      >
        <Lock className="h-5 w-5" />
        <span>åˆ©ç”¨åˆ¶é™ã«åˆ°é”</span>
      </button>
      
      <UpgradeModal 
        isOpen={showUpgradeModal}
        onClose={() => setShowUpgradeModal(false)}
      />
    </>
  );
};
```

### 3.3 ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«

#### 3.3.1 ãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£…

```typescript
// components/UpgradeModal.tsx
import { loadStripe } from '@stripe/stripe-js';

const stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY);

export const UpgradeModal: React.FC<ModalProps> = ({ isOpen, onClose }) => {
  const [isLoading, setIsLoading] = useState(false);
  const { user } = useAuthContext();
  
  const handleUpgrade = async () => {
    setIsLoading(true);
    
    try {
      // Checkout Sessionä½œæˆ
      const { data, error } = await supabase.functions.invoke(
        'create-checkout-session',
        {
          body: { 
            priceId: import.meta.env.VITE_STRIPE_PRICE_ID,
            userId: user.id 
          }
        }
      );
      
      if (error) throw error;
      
      // Stripeã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      const stripe = await stripePromise;
      await stripe?.redirectToCheckout({ 
        sessionId: data.sessionId 
      });
    } catch (error) {
      console.error('Upgrade error:', error);
      toast.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } finally {
      setIsLoading(false);
    }
  };
  
  if (!isOpen) return null;
  
  return (
    <div className="fixed inset-0 bg-black/50 flex items-center 
                  justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] 
                    overflow-y-auto">
        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
        <div className="p-6 border-b border-gray-200">
          <div className="flex items-center justify-between">
            <h2 className="text-xl font-bold text-gray-900">
              ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
            </h2>
            <button
              onClick={onClose}
              className="p-1 hover:bg-gray-100 rounded-lg"
            >
              <X className="h-5 w-5 text-gray-500" />
            </button>
          </div>
        </div>
        
        {/* ã‚¢ãƒ©ãƒ¼ãƒˆ */}
        <div className="mx-6 mt-6 p-4 bg-amber-50 border border-amber-200 
                      rounded-lg">
          <div className="flex gap-3">
            <AlertCircle className="h-5 w-5 text-amber-600 flex-shrink-0" />
            <div>
              <p className="text-sm font-medium text-amber-800">
                ä»Šæœˆã®ç„¡æ–™åˆ©ç”¨æ ï¼ˆ5å›ï¼‰ã‚’ä½¿ã„åˆ‡ã‚Šã¾ã—ãŸ
              </p>
              <p className="text-xs text-amber-600 mt-1">
                ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã§å…¨æ©Ÿèƒ½ã‚’ç„¡åˆ¶é™ã«ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™
              </p>
            </div>
          </div>
        </div>
        
        {/* ãƒ—ãƒ©ãƒ³è©³ç´° */}
        <div className="p-6">
          <div className="border-2 border-purple-200 rounded-lg p-6 
                        bg-gradient-to-br from-purple-50 to-blue-50">
            {/* ä¾¡æ ¼ */}
            <div className="flex items-end justify-between mb-6">
              <div>
                <p className="text-sm text-gray-600">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³</p>
                <div className="flex items-baseline gap-1 mt-1">
                  <span className="text-3xl font-bold text-gray-900">
                    Â¥2,980
                  </span>
                  <span className="text-gray-500">/æœˆ</span>
                </div>
              </div>
              <div className="px-3 py-1 bg-purple-600 text-white text-xs 
                            font-medium rounded-full">
                ãŠã™ã™ã‚
              </div>
            </div>
            
            {/* ç‰¹å…¸ãƒªã‚¹ãƒˆ */}
            <div className="space-y-3">
              <div className="flex items-start gap-3">
                <Check className="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-gray-900">
                    å…¨æ©Ÿèƒ½ãŒç„¡åˆ¶é™ã§åˆ©ç”¨å¯èƒ½
                  </p>
                  <p className="text-xs text-gray-500">
                    ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€åˆ†ææ©Ÿèƒ½ãªã©
                  </p>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <Check className="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-gray-900">
                    å„ªå…ˆã‚µãƒãƒ¼ãƒˆ
                  </p>
                  <p className="text-xs text-gray-500">
                    ãƒ¡ãƒ¼ãƒ«ã§ã®è¿…é€Ÿãªå¯¾å¿œ
                  </p>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <Check className="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-gray-900">
                    æ–°æ©Ÿèƒ½ã¸ã®æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹
                  </p>
                  <p className="text-xs text-gray-500">
                    é–‹ç™ºä¸­ã®æ©Ÿèƒ½ã‚’å…ˆè¡Œåˆ©ç”¨
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}
        <div className="p-6 border-t border-gray-200 space-y-3">
          <button
            onClick={handleUpgrade}
            disabled={isLoading}
            className="w-full px-6 py-3 bg-gradient-to-r from-blue-600 
                     to-purple-600 text-white font-medium rounded-lg
                     hover:opacity-90 disabled:opacity-50 
                     disabled:cursor-not-allowed flex items-center 
                     justify-center gap-2"
          >
            {isLoading ? (
              <>
                <Loader2 className="h-5 w-5 animate-spin" />
                <span>å‡¦ç†ä¸­...</span>
              </>
            ) : (
              <>
                <CreditCard className="h-5 w-5" />
                <span>ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</span>
              </>
            )}
          </button>
          
          <button
            onClick={onClose}
            disabled={isLoading}
            className="w-full px-6 py-2 text-gray-600 hover:text-gray-800 
                     disabled:opacity-50"
          >
            å¾Œã§æ±ºã‚ã‚‹
          </button>
        </div>
        
        {/* ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¡¨ç¤º */}
        <div className="px-6 pb-6">
          <div className="flex items-center justify-center gap-4 text-xs 
                        text-gray-500">
            <div className="flex items-center gap-1">
              <Shield className="h-4 w-4" />
              <span>SSLæš—å·åŒ–é€šä¿¡</span>
            </div>
            <div className="flex items-center gap-1">
              <CreditCard className="h-4 w-4" />
              <span>Powered by Stripe</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
```

### 3.4 ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒšãƒ¼ã‚¸

#### 3.4.1 èª²é‡‘ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³

```typescript
// components/BillingSettings.tsx
export const BillingSettings: React.FC = () => {
  const { usage, subscription } = useSubscriptionStatus();
  const [isLoading, setIsLoading] = useState(false);
  
  const handleManageSubscription = async () => {
    setIsLoading(true);
    
    try {
      // Stripe Customer Portalã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      const { data } = await supabase.functions.invoke(
        'create-portal-session',
        { body: { returnUrl: window.location.href } }
      );
      
      window.location.href = data.url;
    } catch (error) {
      toast.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <div className="bg-white rounded-lg shadow">
      <div className="p-6 border-b border-gray-200">
        <h3 className="text-lg font-medium text-gray-900">
          ãƒ—ãƒ©ãƒ³ãƒ»ãŠæ”¯æ‰•ã„
        </h3>
      </div>
      
      <div className="p-6 space-y-6">
        {/* ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ */}
        <div>
          <label className="text-sm font-medium text-gray-700">
            ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³
          </label>
          <div className="mt-2 p-4 bg-gray-50 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                {subscription?.status === 'active' ? (
                  <>
                    <Star className="h-6 w-6 text-yellow-500 fill-current" />
                    <div>
                      <p className="font-medium text-gray-900">
                        ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³
                      </p>
                      <p className="text-sm text-gray-500">
                        Â¥2,980/æœˆï¼ˆç¨è¾¼ï¼‰
                      </p>
                    </div>
                  </>
                ) : (
                  <>
                    <User className="h-6 w-6 text-gray-400" />
                    <div>
                      <p className="font-medium text-gray-900">
                        ç„¡æ–™ãƒ—ãƒ©ãƒ³
                      </p>
                      <p className="text-sm text-gray-500">
                        æœˆ5å›ã¾ã§åˆ©ç”¨å¯èƒ½
                      </p>
                    </div>
                  </>
                )}
              </div>
              
              {subscription?.status === 'active' ? (
                <button
                  onClick={handleManageSubscription}
                  disabled={isLoading}
                  className="px-4 py-2 text-sm text-blue-600 hover:text-blue-700 
                           font-medium disabled:opacity-50"
                >
                  ãƒ—ãƒ©ãƒ³ç®¡ç†
                </button>
              ) : (
                <button
                  onClick={() => setShowUpgradeModal(true)}
                  className="px-4 py-2 text-sm bg-blue-600 text-white 
                           rounded-md hover:bg-blue-700"
                >
                  ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                </button>
              )}
            </div>
          </div>
        </div>
        
        {/* åˆ©ç”¨çŠ¶æ³ */}
        {!subscription?.status && (
          <div>
            <label className="text-sm font-medium text-gray-700">
              ä»Šæœˆã®åˆ©ç”¨çŠ¶æ³
            </label>
            <div className="mt-2">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-gray-600">
                  {usage.currentCount} / {usage.limit} å›ä½¿ç”¨
                </span>
                <span className="text-sm text-gray-500">
                  {Math.round((usage.currentCount / usage.limit) * 100)}%
                </span>
              </div>
              <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-blue-600 transition-all"
                  style={{ width: `${(usage.currentCount / usage.limit) * 100}%` }}
                />
              </div>
              <p className="mt-2 text-xs text-gray-500">
                æ¬¡å›ãƒªã‚»ãƒƒãƒˆ: {formatDate(usage.periodEndDate)}
              </p>
            </div>
          </div>
        )}
        
        {/* æ¬¡å›è«‹æ±‚æ—¥ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡ã®ã¿ï¼‰ */}
        {subscription?.current_period_end && (
          <div>
            <label className="text-sm font-medium text-gray-700">
              æ¬¡å›è«‹æ±‚æ—¥
            </label>
            <p className="mt-1 text-gray-900">
              {formatDate(subscription.current_period_end)}
            </p>
          </div>
        )}
      </div>
    </div>
  );
};
```

## 4. ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ

### 4.1 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

```typescript
// ãƒ¢ãƒã‚¤ãƒ«ç”¨åˆ©ç”¨çŠ¶æ³è¡¨ç¤ºï¼ˆç”»é¢ä¸‹éƒ¨å›ºå®šï¼‰
const MobileUsageBar: React.FC = () => {
  const { usage } = useUsageStatus();
  
  if (usage.isSubscribed) return null;
  
  const remaining = usage.limit - usage.currentCount;
  
  return (
    <div className="fixed bottom-0 left-0 right-0 bg-white border-t 
                  border-gray-200 p-3 md:hidden z-40">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <div className="w-24 h-1.5 bg-gray-200 rounded-full overflow-hidden">
            <div 
              className="h-full bg-blue-600"
              style={{ width: `${(usage.currentCount / usage.limit) * 100}%` }}
            />
          </div>
          <span className="text-xs text-gray-600">
            æ®‹ã‚Š{remaining}å›
          </span>
        </div>
        {remaining <= 2 && (
          <button className="text-xs text-blue-600 font-medium">
            ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
          </button>
        )}
      </div>
    </div>
  );
};
```

## 5. çŠ¶æ…‹ç®¡ç†

### 5.1 ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

```typescript
// hooks/useUsageStatus.ts
export const useUsageStatus = () => {
  const { user } = useAuthContext();
  const [usage, setUsage] = useState<UsageStatus | null>(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    if (user) {
      loadUsageStatus();
    }
  }, [user]);
  
  const loadUsageStatus = async () => {
    try {
      const status = await checkUsageLimit(user.id);
      setUsage(status);
    } catch (error) {
      console.error('Failed to load usage status:', error);
    } finally {
      setLoading(false);
    }
  };
  
  const refetch = () => loadUsageStatus();
  
  return { usage, loading, refetch };
};
```

## 6. ã‚¨ãƒ©ãƒ¼å‡¦ç†

### 6.1 ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
toast.error('æ±ºæ¸ˆå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');

// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚
toast.error('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');

// èªè¨¼ã‚¨ãƒ©ãƒ¼æ™‚
toast.error('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚');
```

## 7. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### 7.1 ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

```css
/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.progress-bar {
  transition: width 0.3s ease-in-out;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.modal-enter {
  animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
```

## 8. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

### 8.1 ARIAå±æ€§

```typescript
<button
  aria-label="ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰"
  aria-describedby="upgrade-benefits"
  role="button"
>
  ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
</button>

<div role="alert" aria-live="polite">
  åˆ©ç”¨åˆ¶é™ã«åˆ°é”ã—ã¾ã—ãŸ
</div>
```

## 9. ãƒ†ã‚¹ãƒˆé …ç›®

### 9.1 UIãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

- [ ] ç„¡æ–™ãƒ—ãƒ©ãƒ³: åˆ©ç”¨å›æ•°ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ç„¡æ–™ãƒ—ãƒ©ãƒ³: æ®‹ã‚Šå›æ•°ã«å¿œã˜ã¦è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ç„¡æ–™ãƒ—ãƒ©ãƒ³: åˆ¶é™åˆ°é”æ™‚ã«ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡: ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡: åˆ©ç”¨åˆ¶é™ãŒè¡¨ç¤ºã•ã‚Œãªã„
- [ ] ãƒ¢ãƒ¼ãƒ€ãƒ«: æ­£ã—ãé–‹é–‰ã™ã‚‹
- [ ] ãƒ¢ãƒã‚¤ãƒ«: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¡¨ç¤ºãŒæ­£ã—ã„

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 10.1 æœ€é©åŒ–é …ç›®

```typescript
// åˆ©ç”¨çŠ¶æ³ã®å®šæœŸæ›´æ–°ï¼ˆ5åˆ†ã”ã¨ï¼‰
useEffect(() => {
  const interval = setInterval(() => {
    refetchUsage();
  }, 5 * 60 * 1000);
  
  return () => clearInterval(interval);
}, []);

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¡ãƒ¢åŒ–
const UsageStatusBar = React.memo(UsageStatusBarComponent);
```

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: ã“ã®UIä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦å®Ÿè£…ã‚’é€²ã‚ã‚‹