# ドキュメント統合プラン - 有料課金システム

**作成日**: 2025年8月14日  
**対象**: docs_md/11_stripe_有料課金 と docs_md/12_退会処理

## 📊 現状分析

### 11_stripe_有料課金（8ファイル）
- 料金プラン・Stripe実装関連
- 基本的な課金システムの仕様

### 12_退会処理（21ファイル）
- ダウングレード・解約機能
- 二重決済防止
- 退会はメールのみ（実際の削除なし）

**問題点**：
- 両フォルダに関連ドキュメントが分散
- 重複する内容が多い
- ファイル数が多すぎて見通しが悪い

## 🎯 統合方針

### 新フォルダ構成案

```
docs_md/
└── 11_サブスクリプション管理/    # 統合フォルダ
    ├── 01_仕様書/
    │   ├── 料金プラン仕様書.md
    │   ├── Stripe連携仕様書.md
    │   ├── ダウングレード仕様書.md
    │   └── 二重決済防止仕様書.md
    │
    ├── 02_実装ガイド/
    │   ├── 環境構築ガイド.md
    │   ├── Edge_Functions実装ガイド.md
    │   ├── フロントエンド実装ガイド.md
    │   └── データベース設計.md
    │
    ├── 03_運用手順/
    │   ├── デプロイ手順書.md
    │   ├── テスト手順書.md
    │   └── トラブルシューティング.md
    │
    ├── 04_テスト・検証/
    │   ├── テストシナリオ.md
    │   ├── テスト実施記録.md
    │   └── エラー対応履歴.md
    │
    └── README.md    # インデックス
```

## 📋 統合マッピング

### 統合後のファイル構成（案）

| 新ファイル | 統合元ファイル | 内容 |
|-----------|---------------|------|
| **01_仕様書/料金プラン仕様書.md** | 11/01_料金プラン仕様書.md | 料金体系 |
| **01_仕様書/Stripe連携仕様書.md** | 11/02_Stripe実装仕様書.md<br>12/Stripe連携実装手順.md | Stripe統合 |
| **01_仕様書/ダウングレード仕様書.md** | 12/01_ダウングレード機能仕様書.md<br>12/03_退会機能仕様書.md<br>12/統合実装仕様書_プラン解約機能.md | 解約・ダウングレード |
| **01_仕様書/二重決済防止仕様書.md** | 12/二重決済防止システム仕様書.md | 重複課金防止 |
| **02_実装ガイド/環境構築ガイド.md** | 11/05_環境変数設定ガイド.md<br>12/環境変数設定.md<br>12/簡単設定ガイド.md | 環境設定統合 |
| **02_実装ガイド/Edge_Functions実装ガイド.md** | 12/Edge_Function_デプロイ手順.md<br>12/Edge_Functions_デプロイ手順_二重決済防止.md | Edge Functions |
| **02_実装ガイド/フロントエンド実装ガイド.md** | 11/04_UI仕様書.md<br>11/実装仕様書_最新版.md | UI実装 |
| **03_運用手順/デプロイ手順書.md** | 11/03_実装手順書.md<br>12/即座実行用_設定手順.md | デプロイ |
| **03_運用手順/テスト手順書.md** | 12/テストシナリオ.md<br>12/ローカルテスト手順_二重決済防止.md<br>12/Stripe_テスト用サブスクリプション作成.md | テスト |
| **03_運用手順/トラブルシューティング.md** | 11/エラー内容.md<br>12/エラー.md<br>12/エラー内容.md | エラー対応 |
| **04_テスト・検証/テスト実施記録.md** | 12/シナリオテスト実施記録.md<br>12/実装完了報告書.md<br>12/実装完了証明書.md | 実施記録 |
| **システムアーキテクチャ.md** | 11/システムアーキテクチャ図.md<br>12/有料課金システムアーキテクチャ.md | 全体構成 |

## 🔄 統合手順

### Phase 1: 準備（現状維持）
1. 現在のファイルをバックアップ
2. 内容の重複確認
3. 統合計画の最終確認

### Phase 2: 新構造作成
1. `11_サブスクリプション管理`フォルダ作成
2. サブフォルダ構造の作成
3. READMEインデックス作成

### Phase 3: 内容統合
1. 重複内容をマージ
2. 章立てを統一
3. 相互参照を整理

### Phase 4: 移行
1. 新フォルダへファイル配置
2. 旧フォルダをアーカイブ化
3. 参照パスの更新

## 📈 メリット

1. **一元管理**
   - サブスクリプション関連が1箇所に
   - 課金・解約・ダウングレードの流れが明確

2. **重複削除**
   - 29ファイル → 約12ファイルに削減
   - 内容の重複を解消

3. **保守性向上**
   - カテゴリ別の整理
   - 更新箇所の明確化

4. **検索性向上**
   - 論理的な階層構造
   - 目的別のフォルダ分け

## ⚠️ 注意事項

1. **既存の参照**
   - コード内のドキュメントパス参照を確認
   - CI/CDスクリプトの更新

2. **履歴保持**
   - Gitの履歴は保持
   - 旧フォルダは一定期間アーカイブ

3. **段階的移行**
   - 一度に全て移行せず段階的に
   - 動作確認を都度実施

## 🎯 推奨アクション

### 即座に実施
1. このプランのレビュー
2. 統合対象の最終確認

### 次のステップ
1. 新フォルダ構造の作成
2. 最重要ドキュメントから統合開始
3. 段階的な移行実施

## 代替案

### 案A: 最小限の統合
- 12_退会処理 → 11_stripe_有料課金 に移動
- フォルダ名を「11_サブスクリプション管理」に変更
- 重複ファイルのみ統合

### 案B: 機能別分離
```
11_課金システム/     # アップグレード関連
12_解約システム/     # ダウングレード・解約関連
13_システム共通/     # 環境設定・アーキテクチャ
```

## 結論

**推奨**: 「11_サブスクリプション管理」への統合
- 課金・解約を一体管理
- ファイル数を60%削減
- 4階層の明確な構造化

これにより、サブスクリプション関連のドキュメントが体系的に整理され、保守性が大幅に向上します。