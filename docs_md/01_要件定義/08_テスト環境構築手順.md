# ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰æ‰‹é †

## ğŸ¯ æ¦‚è¦

å€‹äººé–‹ç™ºå‘ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãª2æ®µéšç’°å¢ƒæ§‹æˆï¼ˆdevelopãƒ»mainï¼‰ã‚’æ§‹ç¯‰ã—ã€GitHub Actions + Xserverè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã™ã‚‹æ‰‹é †æ›¸ã§ã™ã€‚

## ğŸ“‹ ç’°å¢ƒæ§‹æˆ

### ãƒ–ãƒ©ãƒ³ãƒæ§‹æˆ
```
main     ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
â”œâ”€â”€ develop ï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰
â””â”€â”€ feature/xxx ï¼ˆæ©Ÿèƒ½é–‹ç™ºï¼‰â€»å¿…è¦æ™‚ã®ã¿
```

### ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ
```
ğŸ—„ï¸ Supabaseç’°å¢ƒ
æœ¬ç•ªï¼šooya-dx-production
ãƒ†ã‚¹ãƒˆï¼šooya-dx-test

ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ
develop â†’ Vercel Preview (ãƒ†ã‚¹ãƒˆ)
main â†’ Xserver (æœ¬ç•ª) â€»GitHub Actionsè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

## ğŸš€ æ§‹ç¯‰æ‰‹é †

### 1. GitHubãƒ–ãƒ©ãƒ³ãƒæ§‹æˆå¤‰æ›´

#### 1.1 ç¾åœ¨ã®mainã‚’developã«å¤‰æ›´
```bash
# ç¾åœ¨ã®mainã‚’developã«ãƒªãƒãƒ¼ãƒ 
git branch -m main develop
git push -u origin develop

# æ–°ã—ã„mainä½œæˆï¼ˆæœ¬ç•ªç”¨ï¼‰
git checkout -b main
git push -u origin main
```

#### 1.2 GitHubè¨­å®šå¤‰æ›´
1. GitHub ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã¸ã‚¢ã‚¯ã‚»ã‚¹
2. Settings â†’ Branches
3. Default branch ã‚’ `main` ã«å¤‰æ›´
4. Branch protection rules è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - `main` ãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥pushã‚’åˆ¶é™
   - Pull request required

### 2. Supabaseç’°å¢ƒåˆ†é›¢

#### 2.1 ãƒ†ã‚¹ãƒˆç”¨Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
1. [Supabase.com](https://supabase.com) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€ŒNew Projectã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼š`ooya-dx-test`
4. ç¾åœ¨ã®æœ¬ç•ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜ã‚¹ã‚­ãƒ¼ãƒã‚’é©ç”¨

#### 2.2 æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªãƒãƒ¼ãƒ 
1. ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ `ooya-dx-production` ã«å¤‰æ›´
2. æœ¬ç•ªç”¨ã¨ã—ã¦æ˜ç¢ºã«åŒºåˆ¥

#### 2.3 ç’°å¢ƒå¤‰æ•°è¨­å®š

**developç”¨ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env.local`ï¼‰**
```env
VITE_SUPABASE_URL=https://xxx-test.supabase.co
VITE_SUPABASE_ANON_KEY=test_anon_key_here
```

**mainç”¨ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env.production`ï¼‰**
```env
VITE_SUPABASE_URL=https://xxx-production.supabase.co
VITE_SUPABASE_ANON_KEY=production_anon_key_here
```

### 3. Vercelè¨­å®šï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰

#### 3.1 Vercelãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€£æº
1. [Vercel.com](https://vercel.com) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’é€£æº
3. `develop` ãƒ–ãƒ©ãƒ³ãƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–

#### 3.2 Vercelç’°å¢ƒå¤‰æ•°è¨­å®š
1. Vercel Dashboard â†’ Settings â†’ Environment Variables
2. `develop` ãƒ–ãƒ©ãƒ³ãƒç”¨ã«ãƒ†ã‚¹ãƒˆç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
3. `main` ãƒ–ãƒ©ãƒ³ãƒç”¨ã«æœ¬ç•ªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

### 4. Xserverè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

#### 4.1 FTPæƒ…å ±å–å¾—
1. Xserverã‚µãƒ¼ãƒãƒ¼ãƒ‘ãƒãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³
2. FTPã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã‹ã‚‰ä»¥ä¸‹ã‚’ç¢ºèªï¼š
   - FTPã‚µãƒ¼ãƒãƒ¼åï¼ˆä¾‹ï¼šsv12345.xserver.jpï¼‰
   - FTPãƒ¦ãƒ¼ã‚¶ãƒ¼å
   - FTPãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

#### 4.2 GitHub Secretsè¨­å®š
1. GitHub ãƒªãƒã‚¸ãƒˆãƒª â†’ Settings â†’ Secrets and variables â†’ Actions
2. ä»¥ä¸‹ã®Secretsã‚’è¿½åŠ ï¼š
   ```
   FTP_SERVER: sv12345.xserver.jp
   FTP_USERNAME: your-ftp-user
   FTP_PASSWORD: your-ftp-password
   ```

#### 4.3 GitHub Actionsè¨­å®š

**`.github/workflows/deploy.yml`** ã‚’ä½œæˆï¼š
```yaml
name: Deploy to Xserver

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Build
      run: npm run build
      
    - name: Deploy to FTP
      uses: SamKirkland/FTP-Deploy-Action@4.3.3
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./dist/
        server-dir: /public_html/
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
```

## ğŸ”„ é‹ç”¨ãƒ•ãƒ­ãƒ¼

### æ—¥å¸¸ã®é–‹ç™ºãƒ•ãƒ­ãƒ¼
```bash
# 1. æ–°æ©Ÿèƒ½é–‹ç™º
git checkout develop
git checkout -b feature/æ–°æ©Ÿèƒ½å
# é–‹ç™ºä½œæ¥­...
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½è¿½åŠ "

# 2. developã«ãƒãƒ¼ã‚¸
git checkout develop
git merge feature/æ–°æ©Ÿèƒ½å
git push origin develop
# â†’ Vercelã§è‡ªå‹•ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤

# 3. ãƒ†ã‚¹ãƒˆç¢ºèªå¾Œã€æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹
git checkout main
git merge develop
git push origin main
# â†’ GitHub Actionsã§Xserverã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

### ç·Šæ€¥æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
```bash
# å‰ã®commitã«æˆ»ã™
git checkout main
git reset --hard HEAD~1
git push --force-with-lease origin main
# â†’ è‡ªå‹•çš„ã«å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹
```

## âœ… å‹•ä½œç¢ºèª

### 1. developç’°å¢ƒãƒ†ã‚¹ãƒˆ
1. `develop` ãƒ–ãƒ©ãƒ³ãƒã«push
2. Vercelãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªãƒ³ã‚¯ã§å‹•ä½œç¢ºèª
3. Supabase test DBã§ãƒ‡ãƒ¼ã‚¿ç¢ºèª

### 2. mainç’°å¢ƒãƒ†ã‚¹ãƒˆ
1. `main` ãƒ–ãƒ©ãƒ³ãƒã«push
2. GitHub Actionsã®å®Ÿè¡Œãƒ­ã‚°ç¢ºèª
3. Xserverã®URLã§å‹•ä½œç¢ºèª
4. Supabase production DBã§ãƒ‡ãƒ¼ã‚¿ç¢ºèª

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ç’°å¢ƒå¤‰æ•°ç®¡ç†
- âœ… æœ¬ç•ªã¨ãƒ†ã‚¹ãƒˆã§å®Œå…¨ã«åˆ†é›¢
- âœ… GitHub Secretsã§æ©Ÿå¯†æƒ…å ±ä¿è­·
- âœ… `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«è¿½åŠ 

### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- âœ… ãƒ†ã‚¹ãƒˆç’°å¢ƒã¯é–‹ç™ºè€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹
- âœ… æœ¬ç•ªç’°å¢ƒã¯é©åˆ‡ãªèªè¨¼å®Ÿè£…
- âœ… Supabase RLSï¼ˆRow Level Securityï¼‰è¨­å®š

## ğŸ“Š ãƒ¡ãƒªãƒƒãƒˆ

### é–‹ç™ºåŠ¹ç‡
- âœ… **è‡ªå‹•åŒ–**ï¼špushã™ã‚‹ã ã‘ã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
- âœ… **å®‰å…¨æ€§**ï¼šãƒ†ã‚¹ãƒˆç’°å¢ƒã§äº‹å‰ç¢ºèª
- âœ… **è¿½è·¡æ€§**ï¼šå…¨å¤‰æ›´ãŒGitã§ç®¡ç†
- âœ… **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**ï¼šå•é¡Œæ™‚ã®å³åº§å¾©æ—§

### å“è³ªå‘ä¸Š
- âœ… **æ®µéšçš„ãƒªãƒªãƒ¼ã‚¹**ï¼šdevelop â†’ main ã®å“è³ªã‚²ãƒ¼ãƒˆ
- âœ… **ãƒ‡ãƒ¼ã‚¿ä¿è­·**ï¼šæœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿ãªã—
- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**ï¼šç’°å¢ƒåˆ†é›¢ã§ç›¸äº’å½±éŸ¿ãªã—

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### GitHub Actionsã‚¨ãƒ©ãƒ¼
```bash
# ãƒ­ã‚°ç¢ºèª
GitHub â†’ Actions ã‚¿ãƒ– â†’ å¤±æ•—ã—ãŸWorkflow

# ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼
- FTPèªè¨¼å¤±æ•— â†’ Secretsè¨­å®šç¢ºèª
- ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ â†’ package.jsonã®ä¾å­˜é–¢ä¿‚ç¢ºèª
- ãƒ‘ã‚¹æŒ‡å®šãƒŸã‚¹ â†’ server-dirã®ãƒ‘ã‚¹ç¢ºèª
```

### Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# ç’°å¢ƒå¤‰æ•°ç¢ºèª
console.log(import.meta.env.VITE_SUPABASE_URL)

# ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼
- URLãƒŸã‚¹ â†’ Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèª
- APIã‚­ãƒ¼ãƒŸã‚¹ â†’ anon keyã®å†ç”Ÿæˆ
- CORSè¨­å®š â†’ Supabaseã§è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ 
```

## ğŸ“ ä»Šå¾Œã®æ”¹å–„æ¡ˆ

### CI/CDå¼·åŒ–
- [ ] ãƒ†ã‚¹ãƒˆè‡ªå‹•å®Ÿè¡Œï¼ˆJest, Playwrightï¼‰
- [ ] ãƒªãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè‡ªå‹•åŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- [ ] ã‚¨ãƒ©ãƒ¼ç›£è¦–ï¼ˆSentryï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- [ ] ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ç›£è¦–
- [ ] Slacké€šçŸ¥é€£æº

---

**ä½œæˆæ—¥**: 2025-01-07  
**æ›´æ–°æ—¥**: 2025-01-07  
**ä½œæˆè€…**: Claude Code Assistant