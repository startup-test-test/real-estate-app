# ハードコーディング修正計画

## 1. 修正対象と優先度

### 優先度：高（今すぐ修正）
| ファイル | 行 | 現在の値 | 修正方法 |
|---------|-----|---------|---------|
| `src/pages/Simulator.tsx` | 791 | `'https://real-estate-app-rwf1.onrender.com'` | `'http://localhost:8000'`に変更 |
| `src/hooks/useApiCall.ts` | 42 | `'https://real-estate-app-1-iii4.onrender.com'` | 削除または環境変数から取得 |

### 優先度：中（Stripe実装時に修正）
| ファイル | 行 | 現在の値 | 修正方法 |
|---------|-----|---------|---------|
| `src/pages/PremiumPlan.tsx` | 324 | `'price_1RvChRR8rkVVzR7nAeDvfiur'` | エラーハンドリング追加 |
| `src/components/UpgradeModal.tsx` | 56 | `'price_1RvChRR8rkVVzR7nAeDvfiur'` | エラーハンドリング追加 |

### 優先度：低（削除対象）
| ファイル | 行 | 現在の値 | 修正方法 |
|---------|-----|---------|---------|
| `src/config/api.config.ts` | 9, 12 | プレースホルダーURL | ファイル全体を見直し |

## 2. 修正手順

### Step 1: Simulator.tsxの修正
```javascript
// 変更前（791行目）
const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://real-estate-app-rwf1.onrender.com';

// 変更後
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';
```

### Step 2: useApiCall.tsの確認と修正
```javascript
// 42行目を確認
// この関数が使われているか確認
// 使われていない場合は削除
// 使われている場合は環境変数から取得
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';
```

### Step 3: GitHub Secretsの確認
```yaml
# 必要なSecrets
DEV_API_URL_BACKEND = https://real-estate-app-rwf1.onrender.com
```

### Step 4: GitHub Actionsの更新
```yaml
# .github/workflows/deploy-to-xserver-dev.yml
echo "VITE_API_URL=${{ secrets.DEV_API_URL_BACKEND }}" >> .env.production
```

## 3. テスト計画

### ローカルテスト
- [ ] 環境変数なしで`npm run dev`実行
- [ ] localhost:8000に接続されることを確認
- [ ] 環境変数ありで本番APIに接続されることを確認

### デプロイテスト
- [ ] developブランチにプッシュ
- [ ] GitHub Actionsが成功することを確認
- [ ] dev.ooya.techで動作確認

## 4. リスクと対策

### リスク
- 環境変数の設定忘れで本番APIに接続できない

### 対策
- GitHub Actionsで必ず環境変数を設定
- エラーメッセージを分かりやすくする
- ドキュメントに明記

## 5. 実装順序

1. **即座に実施**
   - Simulator.tsxの修正
   - useApiCall.tsの確認

2. **環境変数整理と同時**
   - GitHub Secretsの追加
   - GitHub Actionsの更新

3. **Stripe実装時**
   - PremiumPlan.tsxの修正
   - UpgradeModal.tsxの修正